LIB_Logger.warn('Time taken to complete readRelation request in milliseconds: ' & TOSTRING(($end - $before)));
   Return $response;
End]]></definition>
        </method>
        <method name="readRelationIDV" userId="pezzi" uuid="00000000-2e7a-a3a9-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'readRelation'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction readRelationIDV(String $accountId, String $useCase := '', CMN_ClientLifecycleData $clientLifeCycleData := null, CMN_BusinessRelationship $cmnBusinessRelationship := null) : INT_SILReadAccountResponse Begin
   Long $before := TIMESTAMP();
   /***************************************** GENERAL FIELDS **************************************/
   INT_SILReadAccountResponse $response := NewObject(INT_SILReadAccountResponse);
   SIL_ACCOUNTaccount $silAccount;
   INT_HttpResponseWrapper $httpResponse;
   String $responseBody;
   CMN_SilIds $silIds;
   Try
      If $clientLifeCycleData == null Then
         $silIds := NEW(CMN_SilIds);
      Else
         $silIds := $clientLifeCycleData.getSILIDs($accountId);
         If $silIds == null Then
            $silIds := NEW(CMN_SilIds);
         End
      End
      /***************************************** READ ACCOUNT DETAILS ********************************/
      $httpResponse := INT_SILHttpClient.getAccountIdDetails($accountId);
      $response.addServiceStatusFromHttpResponseWrapper($httpResponse);
      If $response.getLastCallHasSucceededAndHasContent() Then
         $response.silAccountDetails := TranslateFrom($httpResponse.responseBody, 'SIL_ACCOUNTaccount', 'json');
         /*If EQUAL($response.silAccountDetails.clientNature, 'Joint Entity Client') Then
            $useCase := 'joint';
         End*/
      Else
         LIB_Logger.integrationError('[Integration] Read Acount response is empty: ' & TOSTRING($response));
         Return $response;
      End
      /***************************************** GET RELATIONSHIP ID's = CONNECTED PARTIES IDs ******/
      If $response.silAccountDetails.relationships != null && $response.silAccountDetails.relationships.size() > 0 Then
         SIL_GROUPrelationship $rel;
         ForEach $rel In $response.silAccountDetails.relationships Do
            Record $newSilParty := NewObject(Record);
            If EMPTY($rel.id) Then
               LIB_Logger.integrationError('Party id is null: ' & TOSTRING($rel));
            Else
               $newSilParty.setValue('id', $rel.id);
               $newSilParty.setValue('relationshipRole', $rel.type);
               String $cmnRole := LIST($rel.type, 'CMN_BRRoles', 'id', 'sil_Id');
               If NotEmpty($cmnRole) Then
                  $response.silParties.addElement($newSilParty);
               Else
                  $response.addServiceStatusFromMessage('The mapping for the role ' & $rel.type & ' was not found for the Customer Type ' & $useCase);
               End
               /* ElseIf $useCase != 'joint' and $rel.type != 'Registered Owner' Then
                  $response.addServiceStatusFromMessage('The mapping for the role ' & $rel.type & ' was not found for the Customer Type ' & $useCase);
               End*/
            End
         End
      End
      /***************************************** READ ACCOUNT RELATION *****************************/
      /* $httpResponse := INT_SILHttpClient.getAccountIdEmployee($accountId);
      $response.addServiceStatusFromHttpResponseWrapper($httpResponse);
      If $response.getLastCallHasSucceededAndHasContent() Then
         $response.silEmployeeDetails := TranslateFrom($httpResponse.responseBody, 'SIL_INVOLVEDPARTYemployeeRole:indexed', 'json');
         /***************************************** READ ACCOUNT EMPLOYEE DETAILS **********************/
      /*ForEach SIL_INVOLVEDPARTYemployeeRole $employeeRole In $response.silEmployeeDetails Do
         
            $httpResponse := INT_SILHttpClient.getInvolvedPartyEmployeeIdDetails($partyId);
            $response.addServiceStatusFromHttpResponseWrapper($httpResponse);
            If $response.getLastCallHasSucceededAndHasContent() Then
               $employeeRole := TranslateFrom($httpResponse.responseBody, 'SIL_INVOLVEDPARTYemployeeRole', 'json');
            End
         End
      End*/
      /***************************************** MAP RESULT ****************************************/
      $response.businessRelationship := $cmnBusinessRelationship;
      $response.businessRelationship := INT_SILMappingSILtoCMN.convertSILReadRelationToPEDRClientLifeCycleData($response, $clientLifeCycleData);
      $response.businessRelationship.useCase := $useCase;
   Catch
      LIB_Logger.integrationError('Error while reading account ' & $accountId & ': ' & TOSTRING($exception) & ', ' & TOSTRING(ExceptionRootCause($exception)));
      $response.addServiceStatusFromException($exception);
   End
   Long $end := TIMESTAMP();
   LIB_Logger.warn('Time taken to complete readRelation request in milliseconds: ' & TOSTRING(($end - $before)));
   Return $response;
End]]></definition>
        </method>
        <method name="readRelationOfPerson" userId="pezzi" uuid="ffffffff-8578-ebde-0000-000000000000">
            <definition><![CDATA[/**
  Retrieve the account of the given party.
  @param $partyId Id representing the party to be retrieve 
  @return       Business Relationship Instance containing the account of the party defined
*/
StaticFunction readRelationOfPerson(String $partyId) : INT_SILReadAccountSummaryList Begin
   Long $before := TIMESTAMP();
   INT_SILReadAccountSummaryList $silResponse := NewObject(INT_SILReadAccountSummaryList);
   INT_HttpResponseWrapper $httpResponse;
   $silResponse.businessRelationships := NewIndexed(CMN_BusinessRelationship);
   Try
      /*********************** RETRIEVE ACCOUNT FROM GIVEN ID *********************************/
      $httpResponse := INT_SILHttpClient.getInvolvedPartyIdAccountSummaryList($partyId);
      $silResponse.addServiceStatusFromHttpResponseWrapper($httpResponse);
      If $silResponse.getLastCallHasSucceededAndHasContent() Then
         /*********************** DESERIALIZE ***************************************************/
         $silResponse.silAccounts := TranslateFrom($httpResponse.responseBody, 'SIL_ACCOUNTaccount:indexed', 'json');
         /*********************** MAPPING TO BUSINESS RELATIONSHIP ******************************/
         INT_SILMappingSILtoCMN.convertSILAccountSummaryListToCMNBusinessRelationshipList($silResponse, $partyId);
      End
   Catch
      $silResponse.addServiceStatusFromException($exception);
   End
   Long $end := TIMESTAMP();
   LIB_Logger.warn('Time taken to complete readRelationOfPerson request in milliseconds: ' & TOSTRING(($end - $before)));
   Return $silResponse;
End]]></definition>
        </method>
        <method name="riskRatingClient" userId="odoherty" uuid="00000000-3c1b-2837-0000-000000000000">
            <definition><![CDATA[/*
	Risk Rate a party associated to given business relationship.
    @param $cmnParty represents the evaluated party
    @param $cmnBusinessRelationship represents the associated business relationship
    @return Wrapper object containing the calculated risk value and the status message
*/
StaticFunction riskRatingClient(CMN_Party $cmnParty, CMN_BusinessRelationship $cmnBusinessRelationship) : INT_SILFCCRiskRatingResponse Begin
   /********************* VARIABLES **********************************/
   INT_SILFCCRiskRatingResponse $result := new INT_SILFCCRiskRatingResponse;
   INT_HttpResponseWrapper $httpResponse;
   String $requestBody;
   /********************* SERIALISE **********************************/
   $result.cmnBusinessRelationship := $cmnBusinessRelationship;
   $result.cmnParty := $cmnParty;
   If ISA($cmnParty, CMN_PhysicalPerson) Then
      $result.fccRiskRating := CAST(CMN_PhysicalPerson, $cmnParty).FCCRiskRating;
   Else
      $result.fccRiskRating := CAST(CMN_LegalEntity, $cmnParty).FCCRiskRating;
   End
   $result.silInvolvedParty := INT_SILMappingFCCRAM.convertCMNPartyToSILInvolvedPartyFCCRAM($result.cmnParty, $result.cmnBusinessRelationship);
   $requestBody := TranslateTo($result.silInvolvedParty, 'json');
   /********************* CALLING ***********************************/
   $httpResponse := INT_SILHttpClient.postInvolvedpartyFccRam($requestBody);
   $result.addServiceStatusFromHttpResponseWrapper($httpResponse);
   /********************* DESERIALISE *******************************/
   If $result.getLastServiceStatus().hasSucceded() Then
      Try
         If $result.getLastServiceStatus().hasContent() Then
            $result.silFccram := TranslateFrom($httpResponse.responseBody, 'SIL_CUSTOMERCLASSIFICATIONfccram', 'json');
            INT_SILMappingFCCRAM.convertSILFCCRAMToCMNPartyFCCRiskRating($result);
         End
      Catch
         $result.addServiceStatusFromException($exception);
      End
   End
   Return $result;
End]]></definition>
        </method>
        <method name="rollbackOrder" userId="pezzi" uuid="ffffffff-ba89-46ca-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createOrder'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction rollbackOrder(String $id, String $type, INT_SILTransaction $transaction) : INT_SILTransaction Begin
   Long $before := TIMESTAMP();
   INT_ServiceResponse $response;
   String $requestBody;
   INT_HttpResponseWrapper $httpResponse;
   If $transaction != null && NotEmpty($transaction.transactionId) && not $transaction.isRollbackState() Then
      $transaction.addRollbackTransactionHeader();
      If $type == 'account' Then
         /********* BP ORDER ***********/
         $requestBody := TranslateTo(CAST(SIL_ACCOUNTaccount, CreateSkeletonDataClass(SIL_ACCOUNTaccount)), 'json');
         $httpResponse := INT_SILHttpClient.putAcccount($id, $requestBody, $transaction.getHeaders());
      Else
         /********* PARTY ORDER ***********/
         If $type == 'physical' Then
            $requestBody := TranslateTo(CAST(SIL_INVOLVEDPARTYindividual, CreateSkeletonDataClass(SIL_INVOLVEDPARTYindividual)), 'json');
         ElseIf $type == 'trust' Then
            $requestBody := TranslateTo(CAST(SIL_INVOLVEDPARTYtrust, CreateSkeletonDataClass(SIL_INVOLVEDPARTYtrust)), 'json');
         Else
            $requestBody := TranslateTo(CAST(SIL_INVOLVEDPARTYorganization, CreateSkeletonDataClass(SIL_INVOLVEDPARTYorganization)), 'json');
         End
         $httpResponse := INT_SILHttpClient.putInvolvedParty($id, $requestBody, $transaction.getHeaders());
      End
      $transaction.serviceResponse.addServiceStatusFromHttpResponseWrapper($httpResponse);
   End
   Return $transaction;
End]]></definition>
        </method>
        <method name="searchAccount" userId="pezzi" uuid="00000000-084b-8f65-0000-000000000000">
            <definition><![CDATA[/**
  Search for account using SIL_SearchAccount search parameters (use INT_Utils)
  @param $search Created Search parameters
  @param $maxCount is the max count of results loaded
  @return       Array of CMN_Party 
*/
StaticFunction searchAccount(SIL_TOOLSsearchAccount $search, String $type, Integer $maxCount) : INT_SILSearchAccountResponse Begin
   Long $before := TIMESTAMP();
   INT_SILSearchAccountResponse $silResponse := NewObject(INT_SILSearchAccountResponse);
   $silResponse.accountList := NewIndexed(CMN_SearchedBusinessRelationship);
   Named String $queryParameters := NewNamed(String);
   INT_HttpResponseWrapper $httpResponse;
   SIL_ACCOUNTaccount $silAccount;
   String $requestBody;
   /*********************** HANDLE SEARCH PARAMETERS *************************************/
   // Type needs to be defined before the call to fill the type parameter in the URL query parameter
   Try
      IF($search == null, FAIL('Missing search parameters'));
      $silResponse.search := $search;
   Catch
      LIB_Logger.integrationError('[INT_SILProxyClient]: ' & $exception.getMessage());
      $silResponse.addServiceStatusFromException($exception);
      Return $silResponse;
   End
   /*********************** PERFORM CALL  ************************************************/
   $queryParameters['maxCount'] := TOSTRING($maxCount);
   $queryParameters['type'] := $type;
   $requestBody := TranslateTo($search, 'json');
   $httpResponse := INT_SILHttpClient.postAccountSearch($queryParameters, $requestBody);
   $silResponse.addServiceStatusFromHttpResponseWrapper($httpResponse);
   If not $silResponse.getLastCallHasSucceededAndHasContent() Then
      Return $silResponse;
   End
   /*********************** DESERIALIZE RESULT *******************************************/
   Try
      $silResponse.silAccountList := TranslateFrom($httpResponse.responseBody, 'SIL_ACCOUNTaccount:indexed', 'json');
   Catch
      LIB_Logger.integrationError('[INT_SILProxyClient]: Error in conversion of search results collection - ' & $exception.getMessage());
      $silResponse.addServiceStatusFromException($exception);
      Return $silResponse;
   End
   /*********************** READ LIST OF PARTIES ****************************************/
   Try
      INT_SILMappingSILtoCMN.convertSILSearchResultsToCMNBusinessRelationship($silResponse);
   Catch
      LIB_Logger.integrationError('[INT_SILProxyClient]: Error in conversion of search results collection - ' & $exception.getMessage());
      $silResponse.addServiceStatusFromException($exception);
   End
   Long $end := TIMESTAMP();
   LIB_Logger.warn('Time taken to complete searchPerson request in milliseconds: ' & TOSTRING(($end - $before)));
   Return $silResponse;
End]]></definition>
        </method>
        <method name="searchPerson" userId="gurcay" uuid="00000000-013a-0f1d-0000-000000000000">
            <definition><![CDATA[/**
  Search for person using SIL_SearchInvolvedParty search parameters (use INT_Utils)
  @param $search Created Search parameters
  @param $maxCount is the max count of results loaded
  @return       Array of CMN_Party 
*/
StaticFunction searchPerson(SIL_TOOLSsearchInvolvedParty $search, String $type, Integer $maxCount := LIB_ConfigHelper.getMaxCountQueries(), String $partyTypeID := '') : INT_SILSearchInvolvedPartyResponse Begin
   Long $before := TIMESTAMP();
   INT_SILSearchInvolvedPartyResponse $silResponse := NewObject(INT_SILSearchInvolvedPartyResponse);
   $silResponse.partyList := NewIndexed(CMN_SearchedParty);
   Named String $queryParameters := NewNamed(String);
   INT_HttpResponseWrapper $httpResponse;
   SIL_INVOLVEDPARTYinvolvedParty $silInvolvedParty;
   String $requestBody;
   /*********************** HANDLE SEARCH PARAMETERS *************************************/
   // Type needs to be defined before the call to fill the type parameter in the URL query parameter
   Try
      IF($search == null, FAIL('Missing search parameters'));
      $silResponse.search := $search;
      /*If ISA($search, 'SIL_SearchIndividual') Then
         $type := 'Individual';
      ElseIf ISA($search, 'SIL_SearchOrganization') Then
         $type := 'Organization';
      Else
         FAIL('Unknown Search Type');
      End*/
   Catch
      LIB_Logger.integrationError('[INT_SILProxyClient]: ' & $exception.getMessage());
      $silResponse.addServiceStatusFromException($exception);
      Return $silResponse;
   End
   /*********************** PERFORM CALL  ************************************************/
   $queryParameters['maxCount'] := TOSTRING($maxCount);
   $queryParameters['type'] := $type;
   $requestBody := TranslateTo($search, 'json');
   $httpResponse := INT_SILHttpClient.postInvolvedPartySearch($queryParameters, $requestBody);
   $silResponse.addServiceStatusFromHttpResponseWrapper($httpResponse);
   If not $silResponse.getLastCallHasSucceededAndHasContent() Then
      Return $silResponse;
   End
   /*********************** DESERIALIZE RESULT *******************************************/
   Try
      $silResponse.silInvolvedPartyList := TranslateFrom($httpResponse.responseBody, 'SIL_INVOLVEDPARTYinvolvedParty:indexed', 'json');
   Catch
      LIB_Logger.integrationError('[INT_SILProxyClient]: Error in conversion of search results collection - ' & $exception.getMessage());
      $silResponse.addServiceStatusFromException($exception);
      Return $silResponse;
   End
   /*********************** READ LIST OF PARTIES ****************************************/
   Try
      // Check for valid type if legal entity
      //IF(EMPTY($partyTypeID) && ISA($search, 'SIL_SearchOrganization'), FAIL('Missing partyTypeId fÃ¼r legalEntity search'));
      $silResponse.legalEntityType := $partyTypeID;
      INT_SILMappingSILtoCMN.convertSILSearchResultsToCMNPartyList($silResponse);
   Catch
      LIB_Logger.integrationError('[INT_SILProxyClient]: Error in conversion of search results collection - ' & $exception.getMessage());
      $silResponse.addServiceStatusFromException($exception);
   End
   Long $end := TIMESTAMP();
   LIB_Logger.warn('Time taken to complete searchPerson request in milliseconds: ' & TOSTRING(($end - $before)));
   Return $silResponse;
End]]></definition>
        </method>
        <method name="storeDocument" userId="bernard" uuid="ffffffff-af6f-bd1c-0000-000000000000">
            <definition><![CDATA[/**
  Store document to FileNet throw SIL.
  @param $silDocument SIL_CMSdocument.
  @return       True if successful, false if not.
*/
StaticFunction storeDocument(CMN_BusinessRelationship $businessRelationship, CMN_Party $party, CMN_DocumentTrackerManagerItemAdditional $documentTrackerItem) : INT_SILStoreDocumentResponse Begin
   //Response INT_SILCMSDocumentResponse To define
   //$documentTrackerItem
   SIL_CMSdocument $silDocument := INT_SILMappingCMNtoSIL.createSILDocumentFromBusinessRelationshipParty($businessRelationship, $party, $documentTrackerItem);
   INT_SILStoreDocumentResponse $silResponse := NewObject(INT_SILStoreDocumentResponse);
   INT_HttpResponseWrapper $httpResponse;
   String $requestBody;
   Long $before := TIMESTAMP();
   //Need to 'Prebook Document'
   If $silDocument.id == null Then
      $requestBody := TranslateTo($silDocument, 'json');
      $httpResponse := INT_SILHttpClient.postDocument($requestBody);
      $silResponse.addServiceStatusFromHttpResponseWrapper($httpResponse);
      If $silResponse.hasSucceded() Then
         Try
            //Retrieve Document ID
            If $silResponse.getLastCallHasSucceededAndHasContent() Then
               $silResponse.silDocument := TranslateFrom($httpResponse.requestBody, 'SIL_CMSdocument', 'json');
               $silDocument.id := $silResponse.silDocument.id;
            Else
               Long $end := TIMESTAMP();
               LIB_Logger.warn('FAIL Time taken to store CMS Document request in milliseconds: ' & TOSTRING(($end - $before)));
            End
         Catch
            LIB_Logger.integrationError('[INT_SILProxyClient]: Error while deserializing:  ' & $exception.getMessage());
            $silResponse.addServiceStatusFromException($exception);
         End
      End
   End
   //Document has an Id or Prebook document succeed
   If $silDocument.id != null || $silResponse.hasSucceded() Then
      //Upload document content
      //Get path of file to be sent
      String $filePath := $documentTrackerItem.documentFile.httpFileUpload.filePath;
      Named String $data := NewNamed(String);
      Named String $headers := NewNamed(String);
      $headers['Accept'] := LIB_ConfigHelper.getSILDocumentContentACCEPT();
      $headers['Content-Type'] := LIB_ConfigHelper.getSILDocumentContentType();
      $data['PostRequestHeaders'] := TOSTRING($headers);
      $data['PostBodyFile'] := $filePath;
      //Process post call
      $httpResponse := INT_SILHttpClient.putDocumentDocumentId($silDocument.id, TOSTRING($data), null);
      $silResponse.addServiceStatusFromHttpResponseWrapper($httpResponse);
   End
   Return $silResponse;
End]]></definition>
        </method>
        <method name="storePdfAuditTrails" userId="pezzi" uuid="ffffffff-aeed-b9d7-0000-000000000000">
            <definition><![CDATA[/**
  Store the PDF Audit Trails on the shared folder
  @return true if successfull, false if not 
*/
StaticFunction storePdfAuditTrails(CMN_AuditTrailPdf $pdf) : Boolean Begin
   String $targetFile := ABSOLUTEPATH(INT_SILProxyClientBKP._getAuditTrailSharedFolderPath());
   $targetFile := $targetFile & '/' & $pdf.getProcessType() & '_' & DATEFORMAT($pdf.createdAt, 'yyyyMMddHHmmss') & '_' & $pdf.processInstanceId & '.zip';
   Return EQUAL(Zip($pdf.path, $targetFile), 3);
End]]></definition>
        </method>
        <method name="storeValueStoreToXML" userId="pezzi" uuid="ffffffff-b7f2-c06b-0000-000000000000">
            <definition><![CDATA[/**
  Store Value Store with client life cycle into a file. 
  @param $root CMN_Root object 
  @return       True if successful and false if not.
*/
StaticFunction storeValueStoreToXML(CMN_Root $root) : Boolean Begin
   LIB_Logger.integrationDebug('[INT_SILProxyClient]: Storing Lifecycle data from value store to XML file');
   Try
      If $root != null && $root.getCMNClientLifecycleData() != null Then
         String $dump := SERIALIZE($root.getCMNClientLifecycleData(), true, false);
         String $path := INT_SILProxyClientBKP._getValueStoreXMLFolderPath();
         String $fileName := ABSOLUTEPATH($path) & '/' & 'ClientLifeCycleData_' & $root.processInstance.processInstanceId & '_' & DATEFORMAT(NOW(), 'yyyyMMdd_hhmmss') & '.xml';
         WRITETEXTFILE($fileName, $dump);
         If FILEEXISTS($fileName) Then
            Return true;
         Else
            FAIL('Missing generated file for value store dump');
         End
      Else
         FAIL('Missing Lifecycle data');
      End
   Catch
      LIB_Logger.integrationError('[INT_SILProxyClient]: ' & $exception.getMessage());
      Return false;
   End
End]]></definition>
        </method>
    </methods>
</class>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    1,860,332,0
<?xml version="1.0" encoding="UTF-8"?>
<object xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="object.xsd">
    <id>COB_US27IRABrokerage__US</id>
    <uuid>22918dfa-62b4-414d-8838-fd4d8f35dc71</uuid>
    <type>Document</type>
    <name/>
    <description/>
    <creator>pbgbtestuser101</creator>
    <creationTime>1473246943986</creationTime>
    <modifier>pbgbtestuser101</modifier>
    <modificationTime>1473246966660</modificationTime>
    <active>true</active>
    <versionUuid>5e760706-8e8e-4f5a-859a-1fef1b8cd27d</versionUuid>
    <parentVersionUuid/>
    <timestamp>1475260129806</timestamp>
    <systemId>HSBC COB US DEV</systemId>
    <copyOfUuid>82004d52-148b-4d0a-8578-ad2469fc7ad1</copyOfUuid>
    <committed>true</committed>
    <deleted>false</deleted>
    <userId>magloire</userId>
    <metaData/>
</object>

<?xml version="1.0" encoding="UTF-8"?>
<document version="1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="document.xsd">
    <objectrefs>
        <objectref>
            <type>PdfOutput</type>
            <id>COB_US27IRABrokerage__US</id>
        </objectref>
    </objectrefs>
</document>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          INDX( 	 /8QE           (   0  è       4                     ù    ¨ ’     ¿y    rRTÔñØÑ­%XÔñØÑÄLXÔñØÑrRTÔñØÑ 0      §%              ( 4 0 4 a 6 8 9 3 - a b 4 f - 4 5 2 a - b 3 8 0 - c d 7 9 8 f 2 3 9 a 8 e . t x t       ì    ¨ ’     ¿y    m×@ŠHÒøLAŠHÒ‚`AŠHÒm×@ŠHÒ @      Z2              ( 8 2 6 8 1 b b 5 - 2 d b 9 - 4 a 8 8 - b 8 e a - f e c 3 c 9 4 4 b 1 f c . t x t       Áy    ¨ ’     ¿y    •g¢çÕÑ )õÌ*ÆÑô(Â ÜÕÑ•g¢çÕÑ 0      °%              ( f 3 6 9 a 8 b 4 - 9 8 5 6 -  6 e 6 - 9 1 c 7 - b 8 f 1 b a 3 8 d 7 8 5 . t x t                     ¿y    •g¢çÕÑ )õÌ*ÆÑô(Â ÜÕÑ•g¢çÕÑ 0      °%              ( f 3 6 9 a 8 b 4 - 9 8 5 6 - 4 6 e 6 - 9 1 c 7 - b 8 f 1 b a 3 8 d 7 8 5 . t x t                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            1,924,11950,0
<?xml version="1.0" encoding="UTF-8"?>
<object xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="object.xsd">
    <id>CMN_IncludeOptionDetailsGeneralPledgeThird__CH</id>
    <uuid>c6e36189-1717-4bb1-b8c5-a128806439a2</uuid>
    <type>Screen</type>
    <name/>
    <description/>
    <creator>ratti</creator>
    <creationTime>1436430311435</creationTime>
    <modifier>foo</modifier>
    <modificationTime>1472785833200</modificationTime>
    <active>true</active>
    <versionUuid>82681bb5-2db9-4a88-b8ea-fec3c944b1fc</versionUuid>
    <parentVersionUuid>9a80f145-426b-4aee-b72d-47d67d705296</parentVersionUuid>
    <timestamp>1475260129806</timestamp>
    <systemId>h-global-predev.appway.com</systemId>
    <copyOfUuid>59579e0b-5b83-44eb-a213-da373435bc68</copyOfUuid>
    <committed>true</committed>
    <deleted>false</deleted>
    <userId>magloire</userId>
    <metaData/>
</object>

<?xml version="1.0" encoding="UTF-8"?>
<screen version="1.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="screen.xsd">
    <parameterDefinitions>
        <parameterDefinition collectionType="none" defaultExpression="" description="" mode="assigned" type="CMN_BusinessRelationship" variable="businessRelationship"/>
        <parameterDefinition collectionType="none" defaultExpression="" description="" mode="assigned" type="String" variable="optionID"/>
        <parameterDefinition collectionType="none" defaultExpression="CAST(CMN_OptionalServiceThirdPartyPledge, $businessRelationship.optionalServices.getOptionalService($optionID))" description="" mode="local" type="CMN_OptionalServiceThirdPartyPledge" variable="optionalService"/>
    </parameterDefinitions>
    <view class="com.nm.sdk.data.pages.views.components.View" id="0">
        <customContainer adapterName="ComponentExtension" class="com.nm.sdk.data.pages.views.components.CustomContainer" componentClass="com.nm.extensions.widgets.adaptiveflowlayout.AdaptiveFlowLayout" id="11">
            <customContainer adapterName="ComponentExtension" class="com.nm.sdk.data.pages.views.components.CustomContainer" componentClass="com.nm.extensions.widgets.adaptiveflowlayout.AdaptiveFlowLayoutGroup" id="17">
                <customContainer adapterName="ComponentExtension" class="com.nm.sdk.data.pages.views.components.CustomContainer" componentClass="com.nm.extensions.widgets.adaptiveflowlayout.AdaptiveFlowLayoutElement" id="42">
                    <component class="com.nm.sdk.data.pages.views.components.Infobox" id="15" label="[LABEL:CMN_IncludeOptionDetailsPledgeThird.surname.corporate.name]" orientation="vertical">
                        <component binding="$optionalService.surname" class="com.nm.sdk.data.pages.views.components.TextField" id="16" inputType="text"/>
                    </component>
                </customContainer>
                <customContainer adapterName="ComponentExtension" class="com.nm.sdk.data.pages.views.components.CustomContainer" componentClass="com.nm.extensions.widgets.adaptiveflowlayout.AdaptiveFlowLayoutElement" id="43">
                    <component class="com.nm.sdk.data.pages.views.components.Template" id="59" screenId="CMN_TemplateValidationBox">
                        <component class="com.nm.sdk.data.pages.views.components.TemplateArea" id="60" name="CONTENT">
                            <component class="com.nm.sdk.data.pages.views.components.Infobox" id="19" label="[LABEL:CMN_IncludeOptionDetailsPledgeThird.first.name]" orientation="vertical">
                                <component binding="$optionalService.firstNames" class="com.nm.sdk.data.pages.views.components.TextField" id="20" inputType="text"/>
                            </component>
                        </component>
                        <parameterAssignments>
                            <parameterAssignment expression="$optionalService.firstNames" variable="gsFieldValue"/>
                            <parameterAssignment expression="'5115'" variable="gsFieldId"/>
                        </parameterAssignments>
                    </component>
                </customContainer>
                <customContainer adapterName="ComponentExtension" class="com.nm.sdk.data.pages.views.components.CustomContainer" componentClass="com.nm.extensions.widgets.adaptiveflowlayout.AdaptiveFlowLayoutElement" id="44">
                    <component class="com.nm.sdk.data.pages.views.components.Template" id="57" screenId="CMN_TemplateValidationBox">
                        <component class="com.nm.sdk.data.pages.views.components.TemplateArea" id="58" name="CONTENT">
                            <component class="com.nm.sdk.data.pages.views.components.Infobox" id="23" label="[LABEL:CMN_IncludeOptionDetailsPledgeThird.heading.of.account]" orientation="vertical">
                                <component binding="$optionalService.headingOfAccount" class="com.nm.sdk.data.pages.views.components.TextField" id="24" inputType="text"/>
                            </component>
                        </component>
                        <parameterAssignments>
                            <parameterAssignment expression="$optionalService.headingOfAccount" variable="gsFieldValue"/>
                            <parameterAssignment expression="'5116'" variable="gsFieldId"/>
                        </parameterAssignments>
                    </component>
                </customContainer>
                <customContainer adapterName="ComponentExtension" class="com.nm.sdk.data.pages.views.components.CustomContainer" componentClass="com.nm.extensions.widgets.adaptiveflowlayout.AdaptiveFlowLayoutElement" id="47">
                    <component class="com.nm.sdk.data.pages.views.components.Template" id="55" screenId="CMN_TemplateValidationBox">
                        <component class="com.nm.sdk.data.pages.views.components.TemplateArea" id="56" name="CONTENT">
                            <component class="com.nm.sdk.data.pages.views.components.Infobox" id="26" label="[LABEL:CMN_IncludeOptionDetailsPledgeThird.client.id]" orientation="vertical">
                                <component binding="$optionalService.clientId" class="com.nm.sdk.data.pages.views.components.TextField" id="27" inputType="text"/>
                            </component>
                        </component>
                        <parameterAssignments>
                            <parameterAssignment expression="$optionalService.clientId" variable="gsFieldValue"/>
                            <parameterAssignment expression="'5117'" variable="gsFieldId"/>
                        </parameterAssignments>
                    </component>
                </customContainer>
                <customContainer adapterName="ComponentExtension" class="com.nm.sdk.data.pages.views.components.CustomContainer" componentClass="com.nm.extensions.widgets.adaptiveflowlayout.AdaptiveFlowLayoutElement" id="35">
                    <component class="com.nm.sdk.data.pages.views.components.Template" id="53" screenId="CMN_TemplateValidationBox">
                        <component class="com.nm.sdk.data.pages.views.components.TemplateArea" id="54" name="CONTENT">
                            <component class="com.nm.sdk.data.pages.views.components.Infobox" id="30" label="[LABEL:CMN_IncludeOptionDetailsPledgeThird.not.exceeding.amount.of] [LABEL:CMN_IncludeOptionDetailsPledgeThird.amount.deemed.unlimited]" orientation="vertical">
                                <component binding="$optionalService.maxAmount" class="com.nm.sdk.data.pages.views.components.TextField" id="31" inputType="text"/>
                            </component>
                        </component>
                        <parameterAssignments>
                            <parameterAssignment expression="$optionalService.maxAmount" variable="gsFieldValue"/>
                            <parameterAssignment expression="'5118'" variable="gsFieldId"/>
                        </parameterAssignments>
                    </component>
                </customContainer>
                <customContainer adapterName="ComponentExtension" class="com.nm.sdk.data.pages.views.components.CustomContainer" componentClass="com.nm.extensions.widgets.adaptiveflowlayout.AdaptiveFlowLayoutGroup" id="28">
                    <customContainer adapterName="ComponentExtension" class="com.nm.sdk.data.pages.views.components.CustomContainer" componentClass="com.nm.extensions.widgets.adaptiveflowlayout.AdaptiveFlowLayoutElement" id="36">
                        <component class="com.nm.sdk.data.pages.views.components.Infobox" id="49" label="[LABEL:CMN_IncludeOptionDetailsPledgeThird.currency]" orientation="vertical">
                            <component binding="$optionalService.currency" class="com.nm.sdk.data.pages.views.components.DropdownList" id="50" select2AllowClear="false" select2DynamicUrl="" select2IsEnabled="true" select2QueryParameterName="q" select2Width="resolve" select2WidthOther="50%"
                                select2minimumInputLength="0" selectText="[LABEL:dropdown.select]" showSelect="true" textIfDisabledDisplay="__SELECT_TEXT__">
                                <dataSource class="com.nm.sdk.data.pages.views.options.ExpressionDataSource" collection="RECORDS('CMN_Currencies__selector')" collectionType="none" id="TOSTRING($item.getValue('id'))"
                                    label="TOSTRING($item.getValue('fullName')) &amp; ' (' &amp; TOSTRING($item.getValue('shortName')) &amp; ')'" type="Record" variable="item"/>
                            </component>
                        </component>
                    </customContainer>
                    <property name="groupHasLayout" value="false"/>
                    <property name="groupTitle"/>
                    <property name="inheritAllParentProperties" value="true"/>
                    <property name="labelWidthPercentage"/>
                    <property name="labelWidthPixels"/>
                    <property name="labelWidthType"/>
                    <property name="maxElementPixelWidth"/>
                    <property name="maxElementsPerRow"/>
                    <property name="targetElementPixelWidth"/>
                    <property name="topLabelCutoff"/>
                    <property name="validationExpression"/>
                    <property name="validationMessage"/>
                </customContainer>
                <customContainer adapterName="ComponentExtension" class="com.nm.sdk.data.pages.views.components.CustomContainer" componentClass="com.nm.extensions.widgets.adaptiveflowlayout.AdaptiveFlowLayoutFullWidthElement" id="38">
                    <component class="com.nm.sdk.data.pages.views.components.Template" id="51" screenId="CMN_TemplateValidationBox">
                        <component class="com.nm.sdk.data.pages.views.components.TemplateArea" id="52" name="CONTENT">
                            <component class="com.nm.sdk.data.pages.views.components.Infobox" id="39" label="[LABEL:CMN_IncludeOptionDetailsPledgeThird.reason.of.pledge]" orientation="vertical">
                                <component binding="$optionalService.reasonOfPledge" class="com.nm.sdk.data.pages.views.components.TextArea" id="41"/>
                            </component>
                        </component>
                        <parameterAssignments>
                            <parameterAssignment expression="$optionalService.reasonOfPledge" variable="gsFieldValue"/>
                            <parameterAssignment expression="'5120'" variable="gsFieldId"/>
                        </parameterAssignments>
                    </component>
                </customContainer>
                <property name="groupHasLayout" value="true"/>
                <property name="groupTitle" value="Amount of pledge - Identity of the Borrower"/>
                <property name="inheritAllParentProperties" value="true"/>
                <property name="labelWidthPercentage"/>
                <property name="labelWidthPixels"/>
                <property name="labelWidthType"/>
                <property name="maxElementPixelWidth"/>
                <property name="maxElementsPerRow"/>
                <property name="targetElementPixelWidth"/>
                <property name="topLabelCutoff"/>
                <property name="validationExpression"/>
                <property name="validationMessage"/>
            </customContainer>
            <property name="labelWidthPercentage"/>
            <property name="labelWidthPixels"/>
            <property name="labelWidthType"/>
            <property name="maxElementPixelWidth"/>
            <property name="maxElementsPerRow"/>
            <property name="targetElementPixelWidth"/>
            <property name="topLabelCutoff"/>
        </customContainer>
    </view>
</screen>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      1,911,303513,0
<?xml version="1.0" encoding="UTF-8"?>
<object xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="object.xsd">
    <id>INT_SILMappingSILtoCMN</id>
    <uuid>c65194ee-432a-4a96-b73b-404e3d1d84b2</uuid>
    <type>DataStructure</type>
    <name/>
    <description/>
    <creator>mathieu</creator>
    <creationTime>1437579924026</creationTime>
    <modifier>pezzi</modifier>
    <modificationTime>1474615608062</modificationTime>
    <active>true</active>
    <versionUuid>672a0184-29a9-4faa-bc8a-87814a90f65a</versionUuid>
    <parentVersionUuid>b4ef1496-a7ba-43eb-9893-eec13fbf180f</parentVersionUuid>
    <timestamp>1475260129806</timestamp>
    <systemId>h-global-predev.appway.com</systemId>
    <copyOfUuid>80e5b363-6951-4153-8f36-6e64e88c7288</copyOfUuid>
    <committed>true</committed>
    <deleted>false</deleted>
    <userId>magloire</userId>
    <metaData/>
</object>

<?xml version="1.0" encoding="UTF-8"?>
<class dname="" name="INT_SILMappingSILtoCMN" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="dataitemclass.xsd">
    <superclasses>
        <superclass class="INT_Mapping"/>
    </superclasses>
    <properties/>
    <methods>
        <method name="_createCMNPartyRole" userId="gurcay" uuid="00000000-06d0-1d53-0000-000000000000">
            <definition><![CDATA[/**
  Description of function '_createCMNPartyRole'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction _createCMNPartyRole(CMN_PartyRoleManager $roleManager, String $cmnRole) : CMN_ApplicablePartyRole Begin
   CMN_BusinessRelationship $businessRelationship := $roleManager._businessRelationship;
   CMN_Party $party := $roleManager._party;
   ForEach CMN_AssignedRole $inContextOfRole In $party.getAssignedRoles() Do
      // Match SIL Roles
      //String $roleString := LIST($cmnRole, 'SIL_PartyRoles__selector', 'id', 'sil_id');
      Indexed Action $actions := EVALUATERULE('CMN_ApplicablePartyRoles__selector');
      ForEach Action $roleAction In $actions Do
         // Create Fake Rule result to build custom role
         If EQUAL($roleAction.params['roleID'], $cmnRole) Then
            /*Action $roleAction := NEW(Action);
   $roleAction.params := NewNamed(String);
   $roleAction.params['roleID'] := $roleString;
   //$roleAction.params['allowedPartyTypes'] := $allowedPartyTypes;
   $roleAction.params['kycLevel'] := CMN_KYCLevel.full();
   $roleAction.params['maxParties'] := '10';
   $roleAction.params['minParties'] := '1';
   $roleAction.params['isCustomerRole'] := LIST($cmnRole, 'SIL_BusinessRelationshipRoles__selector', 'isCustomerRole', 'id');*/
            // Create Rule
            CMN_ApplicablePartyRole $role := NewObject(CMN_ApplicablePartyRole, $roleAction, $roleManager);
            Return $role;
         End
      End
   End
   //End
   Return null;
End]]></definition>
        </method>
        <method name="_createCMNRole" userId="pezzi" uuid="00000000-5415-253f-0000-000000000000">
            <definition><![CDATA[/**
  Description of function '_createCMNRole'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
//StaticFunction _createCMNRole(CMN_BusinessRelationship $businessRelationship, String $silRole, String $allowedPartyTypes, String $kycLevel, Integer $maxParties := 30, Integer $minParties := 1) : CMN_ApplicableBRRole Begin
StaticFunction _createCMNRole(CMN_BusinessRelationship $businessRelationship, String $cmnRole, String $cmnPartyType) : CMN_ApplicableBRRole Begin
   // Match SIL Roles
   //String $roleString := LIST($silRole, 'SIL_BusinessRelationshipRoles__selector', 'id', 'sil_id');
   Indexed Action $actions := EVALUATERULE('CMN_ApplicableBRRoles__selector');
   ForEach Action $roleAction In $actions Do
      // Create Fake Rule result to build custom role
      If EQUAL($roleAction.params['roleID'], $cmnRole) and CONTAINS($roleAction.params['allowedPartyTypes'], $cmnPartyType) Then
         /*Action $roleAction := NEW(Action);
         $roleAction.params := NewNamed(String);
         $roleAction.params['roleID'] := $roleString;
         $roleAction.params['allowedPartyTypes'] := $allowedPartyTypes;
         $roleAction.params['kycLevel'] := $kycLevel;
         $roleAction.params['maxParties'] := TOSTRING($maxParties);
         $roleAction.params['minParties'] := TOSTRING($minParties);*/
         $roleAction.params['isCustomerRole'] := LIST($cmnRole, 'CMN_BRRoles', 'isCustomerRole', 'id');
         // Create Rule
         CMN_ApplicableBRRole $role := NewObject(CMN_ApplicableBRRole, $roleAction, $businessRelationship.getRoleManager());
         Return $role;
      End
      //End
   End
   Return null;
End]]></definition>
        </method>
        <method name="convertSILAccountActivityToCMNKYTActualAccountActivity" userId="bellanca" uuid="ffffffff-9424-b078-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'convertSILAccountActivityToCMNKYTActualAccountActivity'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction convertSILAccountActivityToCMNKYTActualAccountActivity(INT_SILReadAccountActivityResponse $response) : Nothing Begin
   Try
      /************************************* TOP LEVEL STRUCTURE ******************************/
      If LIB_Validator.validateNotEmptyIndexed($response.silKycAccountActivity) Then
         If $response.kytActualAccountActivity == null Then
            $response.kytActualAccountActivity := NewObject(CMN_KYTActualAccountActivity);
         End
         For Integer $i := 1 Condition $i <= $response.silKycAccountActivity.size() Step $i := $i + 1 Do
            SIL_KYCaccountActivity $silAccActivity := $response.silKycAccountActivity[$i];
            /************ transfers In *******************/
            $response.kytActualAccountActivity.transfersIn[$i] := NEW(CMN_KYTTransferActivity);
            $response.kytActualAccountActivity.transfersIn[$i].cashTransNumber := $silAccActivity.numberCashCreditTransaction;
            $response.kytActualAccountActivity.transfersIn[$i].cashTotalAmount := $silAccActivity.valueCashCreditTransaction;
            $response.kytActualAccountActivity.transfersIn[$i].wireTransfersTransNumber := $silAccActivity.numberIntWireCreditPayment;
            $response.kytActualAccountActivity.transfersIn[$i].wireTransfersTotalAmount := $silAccActivity.valueIntWireCreditPayment;
            $response.kytActualAccountActivity.transfersIn[$i].wireHrjTransfersTotalNumber := $silAccActivity.numberIntWireHrjCreditPayment;
            $response.kytActualAccountActivity.transfersIn[$i].wireHrjTransfersTotalAmount := $silAccActivity.valueIntWireHrjCreditPayment;
            /************ transfers Out *******************/
            $response.kytActualAccountActivity.transfersOut[$i] := NEW(CMN_KYTTransferActivity);
            $response.kytActualAccountActivity.transfersOut[$i].cashTransNumber := $silAccActivity.numberCashDebitTransaction;
            $response.kytActualAccountActivity.transfersOut[$i].cashTotalAmount := $silAccActivity.valueCashDebitTransaction;
            $response.kytActualAccountActivity.transfersOut[$i].wireTransfersTransNumber := $silAccActivity.numberIntWireDebitPayment;
            $response.kytActualAccountActivity.transfersOut[$i].wireTransfersTotalAmount := $silAccActivity.valueIntWireDebitPayment;
            $response.kytActualAccountActivity.transfersOut[$i].wireHrjTransfersTotalNumber := $silAccActivity.numberIntWireHrjDebitPayment;
            $response.kytActualAccountActivity.transfersOut[$i].wireHrjTransfersTotalAmount := $silAccActivity.valueIntWireHrjDebitPayment;
         End
      Else
         $response.kytActualAccountActivity := NEW(CMN_KYTActualAccountActivity);
         $response.kytActualAccountActivity.clearTwelveMonthsActivities();
      End
   Catch
      LIB_Logger.integrationError($exception.getMessage());
   End
End]]></definition>
        </method>
        <method name="convertSILAccountObjectIdsToCMNBusinesRelationnshipObjectIds" userId="pezzi" uuid="00000000-7cfb-0a04-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'convertSILAccountObjectIdsToCMNBusinesRelationnshipObjectIds'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction convertSILAccountObjectIdsToCMNBusinesRelationnshipObjectIds(INT_SILStoreRelationResponse $response, CMN_BusinessRelationship $cmnBusinessRelationship) : Nothing Begin
   IF($response.silAccountFunding != null && NotEmpty($response.silAccountFunding.id), $cmnBusinessRelationship.kytProfile.initialFunding.setSILID($response.silAccountFunding.id));
   If LIB_Validator.validateNotEmptyIndexed($response.silKycAccountTransferActivity) Then
      ForEach SIL_KYCaccountTransferActivity $silKycAccountTransferActivity In $response.silKycAccountTransferActivity Do
         If $silKycAccountTransferActivity != null && NotEmpty($silKycAccountTransferActivity.transferType) Then
            If ISA($silKycAccountTransferActivity, SIL_KYCaccountTransferInActivity) Then
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.silIds[$silKycAccountTransferActivity.transferType] := $silKycAccountTransferActivity.id;
            ElseIf ISA($silKycAccountTransferActivity, SIL_KYCaccountTransferOutActivity) Then
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.silIds[$silKycAccountTransferActivity.transferType] := $silKycAccountTransferActivity.id;
            End
         End
      End
   End
   If LIB_Validator.validateNotEmptyIndexed($response.silOrderTrasnfer) Then
      Integer $chequeIndex := 1;
      Integer $wireIndex := 1;
      Integer $securitiesIndex := 1;
      ForEach SIL_ORDERtransfer $accountFundingTransfer In $response.silOrderTrasnfer Do
         If $accountFundingTransfer.type == '5' Then
            $cmnBusinessRelationship.kytProfile.initialFunding.cheque[$chequeIndex].setSILID($accountFundingTransfer.id);
            $chequeIndex := $chequeIndex + 1;
         ElseIf $accountFundingTransfer.type == '3' Then
            $cmnBusinessRelationship.kytProfile.initialFunding.wireTransfers[$wireIndex].setSILID($accountFundingTransfer.id);
            $wireIndex := $wireIndex + 1;
         ElseIf $accountFundingTransfer.type == '4' Then
            $cmnBusinessRelationship.kytProfile.initialFunding.securities[$securitiesIndex].setSILID($accountFundingTransfer.id);
            $securitiesIndex := $securitiesIndex + 1;
         ElseIf $accountFundingTransfer.type == '6' Then
            $cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsCashAmountId := $accountFundingTransfer.id;
         ElseIf $accountFundingTransfer.type == '8' Then
            $cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsPreciousMetalAmountId := $accountFundingTransfer.id;
         ElseIf $accountFundingTransfer.type == '9' Then
            $cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsSecuritiesAmountId := $accountFundingTransfer.id;
         End
      End
   End
End]]></definition>
        </method>
        <method name="convertSILAccountSummaryListToCMNBusinessRelationshipList" userId="pezzi" uuid="00000000-006a-4265-0000-000000000000">
            <definition><![CDATA[StaticFunction convertSILAccountSummaryListToCMNBusinessRelationshipList(INT_SILReadAccountSummaryList $response, String $customerId := '') : Nothing Begin
   // Add the Account Summarys to the BusinessRelationships
   If LIB_Validator.validateNotEmptyIndexed($response.silAccounts) Then
      ForEach SIL_ACCOUNTaccount $silAccount In $response.silAccounts Do
         If EMPTY($customerId) Then
            $response.businessRelationships.addElement(INT_SILMappingSILtoCMN.createCMNBusinessRelationshipFromSILAccount(null, $silAccount));
         Else
            If LIB_Validator.validateNotEmptyIndexed($silAccount.accountHolders) Then
               ForEach SIL_INVOLVEDPARTYRELATIONaccountHolders $accountHolder In $silAccount.accountHolders Do
                  ForEach SIL_INVOLVEDPARTYRELATIONaccountHolderRelation $ah In $accountHolder.accountHolderRelations Do
                     /*or EQUAL($ah.relationType, 'Beneficial Owner')*/
                     /*If EQUAL($ah.relationType, 'Registered Owner') or EQUAL($ah.relationType, 'Account Owner') Then
                        Boolean $addAccountTolist := true;
                        ForEach CMN_BusinessRelationship $businessRelationShip In $response.businessRelationships Do
                           If $businessRelationShip.getSILID() == $silAccount.accountId Then
                              $addAccountTolist := false;
                              Break;
                           End
                        End
                        If $addAccountTolist Then
                           $response.businessRelationships.addElement(INT_SILMappingSILtoCMN.createCMNBusinessRelationshipFromSILAccount(null, $silAccount));
                        End
                     End*/
                     If EQUAL($ah.relationType, 'ah') Then
                        $response.businessRelationships.addElement(INT_SILMappingSILtoCMN_v2.createCMNBusinessRelationshipFromSILAccount(null, $silAccount));
                     End
                  End
               End
            End
         End
      End
   End
End]]></definition>
        </method>
        <method name="convertSILInvolvedPartyIDVToCMNParty" userId="pezzi" uuid="00000000-417b-c39c-0000-000000000000">
            <definition><![CDATA[StaticFunction convertSILInvolvedPartyIDVToCMNParty(INT_SILReadPartyResponse $response) : Nothing Begin
   /************************************* TOP LEVEL STRUCTURE ******************************/
   // PARTY DETAILS
   CMN_Party $party := INT_SILMappingSILtoCMN.createCMNPartyFromSILInvolvedPartyIDV($response.party, $response.silInvolvedPartyDetails);
   If $party == null Then
      Return null;
   End
   $response.party := $party;
   $response.party.hasRelationshipHSBCGroup := INT_SILMappingSILtoCMN._mapBoolean($response.party.hasRelationshipHSBCGroup, $response.silInvolvedPartyDetails.existingCustomerIndicator);
   $response.party.isTakenFromSIL := true;
End]]></definition>
        </method>
        <method name="convertSILInvolvedPartyToCMNParty" userId="pezzi" uuid="ffffffff-f493-8739-0000-000000000000">
            <definition><![CDATA[StaticFunction convertSILInvolvedPartyToCMNParty(INT_SILReadPartyResponse $response) : Nothing Begin
   Try
      If $response.party != null Then
         If $response.party.type.isStaticType() Then
            If $response.party.type.isLegalEntity() Then
               // Nature of Business & Source of Wealth
               $response.party := INT_SILMappingSILtoCMN.createCMNPartyFromSILBusinessOrganization($response.party, $response.silBusinessOrganization);
               // PARTY AFFILIATES (Organization) 
               $response.party := INT_SILMappingSILtoCMN.createCMNPartyFromSILAffiliates($response.party, $response.silAffiliate);
               $response.party := INT_SILMappingSILtoCMN.createCMNPartyFromSILEstimatedNetWorth($response.party, $response.silEstimatedNetWorth);
            ElseIf $response.party.type.isPhysicalPerson() Then
               //PARTY SOW
               $response.party := INT_SILMappingSILtoCMN.createCMNPartyFromSILSourceOfWealth($response.party, $response.silSOW);
               $response.party := INT_SILMappingSILtoCMN.createCMNPartyFromSILOverallNetWorth($response.party, $response.silEstimatedNetWorth);
            End
            // PARTY SCC
            If LIB_Validator.validateNotEmptyIndexed($response.silSCC) Then
               $response.party := INT_SILMappingSILtoCMN.createCMNPartyFromSILSCC($response.party, $response.silSCC);
            End
            //PARTY SCREENING
            $response.party := INT_SILMappingSILtoCMN.createCMNPartyFromSILScreeningScreening($response.party, $response.silScreening);
            //PARTY FINDINGS
            $response.party := INT_SILMappingSILtoCMN.createCMNPartyFromSILFindings($response.party, $response.silFindings);
            // PARTY TAX INFORMATION
            $response.party := INT_SILMappingSILtoCMN.createCMNPartyFromSILTaxInformation($response.party, $response.silTaxInformation);
            // PARTY ACCOUNT DETAIL
            If LIB_Validator.validateNotEmptyIndexed($response.silAccountSummaryList) Then
               $response.party := INT_SILMappingSILtoCMN.createCMNPartyFromSILAccounts($response.party, $response.silAccountSummaryList);
            End
            // Connected Party
            If LIB_Validator.validateNotEmptyIndexed($response.silParties) Then
               $response.party := INT_SILMappingSILtoCMN.convertSILRelationshipToCMNConnectedParties($response.party, $response.silParties);
            End
            // PARTY CONTACT ACTIVITY
            /*If LIB_Validator.validateNotEmptyIndexed($response.silContactActivity) Then
         $response.party := INT_SILMappingSILtoCMN.createCMNPartyFromSILContactActivities($response.party, $response.silContactActivity);
      End*/
         End
      End
   Catch
      LIB_Logger.integrationError($exception.getMessage());
   End
End]]></definition>
        </method>
        <method name="convertSILPartyObjectIdsToCMNPartyObjectIds" userId="pezzi" uuid="00000000-4bc5-7446-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'convertSILPartyObjectIdsToCMNPartyObjectIds'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction convertSILPartyObjectIdsToCMNPartyObjectIds(INT_SILStorePartyResponse $response, CMN_Party $cmnParty, CMN_SilIds $silIds) : Nothing Begin
   If $cmnParty == null Then
      Return null;
   End
   If $silIds == null Then
      $silIds := NEW(CMN_SilIds);
   End
   If $cmnParty.type.isLegalEntity() Then
      If $response.silBusinessOrganization != null Then
         CAST(CMN_LegalEntity, $cmnParty).getKYCProfile().sourceOfWealth.setSILID($response.silBusinessOrganization.id);
      End
      If LIB_Validator.validateNotEmptyIndexed($response.silAffiliate) Then
         For Integer $i := 1 Condition $i <= TOINTEGER(MIN($response.silAffiliate.size(), LIB_ConfigHelper.getMaximumNumberOfAffiliate())) Step $i := $i + 1 Do
            SIL_INVOLVEDPARTYorganization $silAffiliate := $response.silAffiliate[$i];
            If $silAffiliate != null Then
               CAST(CMN_LegalEntity, $cmnParty).getKYCProfile().sourceOfWealth.affiliate[$i].setSILID($silAffiliate.id);
            End
         End
      End
      If LIB_Validator.validateNotEmptyIndexed($response.silAffiliatesDeleted) Then
         ForEach String $silAffiliatesDeleted In $response.silAffiliatesDeleted Do
            $silIds.silAffiliate.removeElement($silAffiliatesDeleted);
         End
      End
      If $response.silEstimatedNetWorth != null Then
         CAST(CMN_LegalEntity, $cmnParty).getKYCProfile().financialInformation.setSILID($response.silEstimatedNetWorth.id);
      End
      If $response.silTaxInfomation != null Then
         CAST(CMN_LegalEntity, $cmnParty).regulatoryProfile.setSILID($response.silTaxInfomation.id);
      End
   ElseIf $cmnParty.type.isPhysicalPerson() Then
      If LIB_Validator.validateNotEmptyIndexed($response.silIndividualSourceOfWealth) Then
         ForEach SIL_SOWindividualSourceOfWealth $silSOW In $response.silIndividualSourceOfWealth Do
            CAST(CMN_PhysicalPerson, $cmnParty).getKYCProfile().sourceOfWealth.setSILID($silSOW.id);
            Break;
         End
      End
      If LIB_Validator.validateNotEmptyIndexed($response.silProfessionalActivity) Then
         For Integer $i := 1 Condition $i <= TOINTEGER(MIN($response.silProfessionalActivity.size(), LIB_ConfigHelper.getMaximumNumberOfSOW())) Step $i := $i + 1 Do
            SIL_INVOLVEDPARTYemployeeRole $silEmployeeRole := $response.silProfessionalActivity[$i];
            CAST(CMN_PhysicalPerson, $cmnParty).getKYCProfile().sourceOfWealth.sowEmployment[$i].setSILID($silEmployeeRole.id);
         End
      End
      If LIB_Validator.validateNotEmptyIndexed($response.silProfessionalActivityDeleted) Then
         ForEach String $silEmployeeToDelete In $response.silProfessionalActivityDeleted Do
            $silIds.silProfessionalActivity.removeElement($silEmployeeToDelete);
         End
      End
      If LIB_Validator.validateNotEmptyIndexed($response.silOwnedBusiness) Then
         For Integer $i := 1 Condition $i <= TOINTEGER(MIN($response.silOwnedBusiness.size(), LIB_ConfigHelper.getMaximumNumberOfSOW())) Step $i := $i + 1 Do
            SIL_INVOLVEDPARTYbusinessOwner $silBusinessOwner := $response.silOwnedBusiness[$i];
            CAST(CMN_PhysicalPerson, $cmnParty).getKYCProfile().sourceOfWealth.sowBusinessOwner[$i].setSILID($silBusinessOwner.id);
         End
      End
      If LIB_Validator.validateNotEmptyIndexed($response.silOwnedBusinessDeleted) Then
         ForEach String $silOwnedBusinessToDelete In $response.silOwnedBusinessDeleted Do
            $silIds.silOwnedBusiness.removeElement($silOwnedBusinessToDelete);
         End
      End
      If $response.silEstimatedNetWorth != null Then
         CAST(CMN_PhysicalPerson, $cmnParty).getKYCProfile().overallNetWorthAndIncome.setSILID($response.silEstimatedNetWorth.id);
      End
      If $response.silTaxInfomation != null Then
         CAST(CMN_PhysicalPerson, $cmnParty).regulatoryProfile.setSILID($response.silTaxInfomation.id);
      End
   End
   If LIB_Validator.validateNotEmptyIndexed($response.silEstimatedNetWorthDeleted) Then
      ForEach String $silEstimatedNetWorthDeleted In $response.silEstimatedNetWorthDeleted Do
         $silIds.silEstimatedNetWorth.removeElement($silEstimatedNetWorthDeleted);
      End
   End
   If $response.silSpecialCategoryCustomer != null Then
      $cmnParty.kycProfile.pepSCCDetails.setSILID($response.silSpecialCategoryCustomer.id);
   End
   /**** FINDINGS ***/
   If LIB_Validator.validateNotEmptyIndexed($response.silFindings) Then
      For Integer $i := 1 Condition $i <= $response.silFindings.size() Step $i := $i + 1 Do
         SIL_INVOLVEDPARTYSCREENINGfinding $silFinding := $response.silFindings[$i];
         $cmnParty.kycProfile.screening.connectedPartyNegativeNews[$i].setSILID($silFinding.id);
      End
   End
   If LIB_Validator.validateNotEmptyIndexed($response.silFindingsDeleted) Then
      ForEach String $silFindingToDelete In $response.silFindingsDeleted Do
         $silIds.silFindings.removeElement($silFindingToDelete);
      End
   End
End]]></definition>
        </method>
        <method name="convertSILReadRelationToPEDRClientLifeCycleData" userId="pezzi" uuid="ffffffff-8072-b6f6-0000-000000000000">
            <definition><![CDATA[StaticFunction convertSILReadRelationToPEDRClientLifeCycleData(INT_SILReadAccountResponse $response, CMN_ClientLifecycleData $clientLifeCycleData := null) : CMN_BusinessRelationship Begin
   CMN_BusinessRelationship $businessRelationship := $response.businessRelationship;
   /******************************* BUILD CLIENT LIFE CYCLE DATA *****************************************/
   If $clientLifeCycleData == null Then
      $clientLifeCycleData := NewObject(CMN_ClientLifecycleData);
   End
   If $businessRelationship == null Then
      $businessRelationship := CMN_BusinessRelationshipFactory__selector($clientLifeCycleData);
   Else
      $businessRelationship.setClientLifecycleData($clientLifeCycleData);
   End
   $clientLifeCycleData.businessRelationships.addElement($businessRelationship);
   /****************************** READ BUSINESS RELATIONSHIP FROM THE SIL ACCOUNT ***********************/
   //
   $businessRelationship := INT_SILMappingSILtoCMN.createCMNBusinessRelationshipFromSILAccount($businessRelationship, $response.silAccountDetails);
   //
   $businessRelationship := INT_SILMappingSILtoCMN.createCMNBusinessRelationshipFromSILAccountFunding($businessRelationship, $response.silAccountFunding);
   //
   $businessRelationship := INT_SILMappingSILtoCMN.createCMNBusinessRelationshipFromSILAccountFundingTransfer($businessRelationship, $response.silAccountFundingTransfer);
   //
   $businessRelationship := INT_SILMappingSILtoCMN.createCMNBusinessRelationshipFromSILAccountTransferActivity($businessRelationship, $response.silKycAccountTransferActivity);
   //
   $businessRelationship := INT_SILMappingSILtoCMN.createCMNBusinessRelationshipFromSILAccountActivity($businessRelationship, $response.silKycAccountActivity);
   //
   $businessRelationship := INT_SILMappingSILtoCMN.createCMNBusinessRelationshipFromSILAccountTaxInformation($businessRelationship, $response.silTaxInformation);
   //
   $businessRelationship := INT_SILMappingSILtoCMN.createCMNBusinessRelationshipFromSILSubAccount($businessRelationship, $response.silSubAccount);
   // Parties already mapped using their own mapping functions
   // Require to set the business relationship id to valid
   $businessRelationship.numberCheckedFromAppway := true;
   /******************************* STORE RESULT IN RESPONSE *******************************************/
   // Store BusinessRelationship 
   $response.pedrClientLifeCycleData := $clientLifeCycleData;
   Return $businessRelationship;
End]]></definition>
        </method>
        <method name="convertSILRelationshipToCMNConnectedParties" userId="pezzi" uuid="ffffffff-ab66-f069-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'convertSILRelationshipToCMNConnectedParties'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction convertSILRelationshipToCMNConnectedParties(CMN_Party $cmnParty, Indexed Record $connectedPartyRecords) : CMN_Party Begin
   If $cmnParty != null && $cmnParty.type != null && ($cmnParty.type.isPhysicalPerson() or $cmnParty.type.isCommercialOperatingBusiness()) Then
      $cmnParty.kycProfile.connectedParties.connectedParty.clear();
      CMN_ConnectedParty $cmnConnectedParty;
      ForEach $connectedPartyRecord In $connectedPartyRecords Do
         String $relationshipType := TOSTRING($connectedPartyRecord.getValue('relationshipType'));
         //String $relationshipRole := TOSTRING($connectedPartyRecord.getValue('relationshipRole'));
         //String $relationshipSubType := TOSTRING($connectedPartyRecord.getValue('relationshipSubType'));
         IF($relationshipType == null, $relationshipType := '');
         //IF($relationshipRole == null, $relationshipRole := '');
         //IF($relationshipSubType == null, $relationshipSubType := '');
         //ForEach Record $relationTypeRecord In RECORDS('CMN_KYCPartyRelationType') Do
         /*If TOSTRING($relationTypeRecord.getValue('relationshipType')) == $relationshipType && TOSTRING($relationTypeRecord.getValue('relationshipRole')) == $relationshipRole && TOSTRING($relationTypeRecord.getValue('relationshipSubType')) == $relationshipSubType Then
               $typeRelationship := TOSTRING($relationTypeRecord.getValue('id'));
            End*/
         String $typeRelationship := LIST($relationshipType, 'CMN_KYCPartyRelationType', 'id', 'sil_Id');
         If NotEmpty($typeRelationship) Then
            SIL_INVOLVEDPARTYinvolvedParty $silParty := CAST(SIL_INVOLVEDPARTYinvolvedParty, $connectedPartyRecord.getValue('silParty'));
            $cmnConnectedParty := NewObject(CMN_ConnectedParty);
            $cmnConnectedParty.typeRelationship := INT_SILMappingSILtoCMN._mapString($cmnConnectedParty.typeRelationship, $typeRelationship);
            $cmnConnectedParty.idCRM := INT_SILMappingSILtoCMN._mapString($cmnConnectedParty.idCRM, $silParty.id);
            $cmnConnectedParty.setSILID(INT_SILMappingSILtoCMN._mapString($cmnConnectedParty.getSILID(), TOSTRING($connectedPartyRecord.getValue('SILID'))));
            If ISA($silParty, SIL_INVOLVEDPARTYorganization) Then
               $cmnConnectedParty.setType(CMN_ConnectedParty.typeOrganization());
               If ISA($silParty, SIL_INVOLVEDPARTYtrust) and LIB_Validator.validateNotEmptyIndexed($silParty.names) && ISA($silParty.names[1], SIL_INVOLVEDPARTYtrustName) Then
                  $cmnConnectedParty.fullName := CAST(SIL_INVOLVEDPARTYtrustName, $silParty.names[1]).fullName;
               ElseIf LIB_Validator.validateNotEmptyIndexed($silParty.names) && ISA($silParty.names[1], SIL_INVOLVEDPARTYorganizationName) Then
                  $cmnConnectedParty.fullName := CAST(SIL_INVOLVEDPARTYorganizationName, $silParty.names[1]).fullName;
               End
            ElseIf ISA($silParty, SIL_INVOLVEDPARTYindividual) Then
               $cmnConnectedParty.setType(CMN_ConnectedParty.typeIndividual());
               If LIB_Validator.validateNotEmptyIndexed($silParty.names) && ISA($silParty.names[1], SIL_INVOLVEDPARTYindividualName) Then
                  $cmnConnectedParty.fullName := CAST(SIL_INVOLVEDPARTYindividualName, $silParty.names[1]).fullName;
               End
            End
            $connectedPartyRecords.removeElement($connectedPartyRecords);
            $cmnParty.kycProfile.connectedParties.connectedParty.addElement($cmnConnectedParty);
         End
         //End
      End
      $cmnParty.kycProfile.connectedParties.hasOtherConnectedParty := LIB_Validator.validateNotEmptyIndexed($cmnParty.kycProfile.connectedParties.connectedParty);
   End
   Return $cmnParty;
End]]></definition>
        </method>
        <method name="convertSILSearchResultsToCMNBusinessRelationship" userId="pezzi" uuid="00000000-7f30-4af6-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'convertSILSearchResultsToCMNBusinessRelationship'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction convertSILSearchResultsToCMNBusinessRelationship(INT_SILSearchAccountResponse $silResponse) : Nothing Begin
   SIL_ACCOUNTaccount $silAccount;
   If LIB_Validator.validateNotEmptyIndexed($silResponse.silAccountList) Then
      ForEach $silAccount In $silResponse.silAccountList Do
         Try
            $silResponse.accountList.addElement(INT_SILMappingSILtoCMN.createCMNSearchedAccountFromSILAccount(null, $silAccount));
         Catch
            LIB_Logger.integrationError('[INT_SILMappingSILtoCMN]: Exception during mapping of Account: ' & $exception.getMessage() & ', ' & TOSTRING(ExceptionRootCause($exception)));
         End
      End
   End
End]]></definition>
        </method>
        <method name="convertSILSearchResultsToCMNPartyList" userId="pezzi" uuid="ffffffff-a91e-da86-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'convertSILSearchResultsToCMNPartyList'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction convertSILSearchResultsToCMNPartyList(INT_SILSearchInvolvedPartyResponse $silResponse) : Nothing Begin
   SIL_INVOLVEDPARTYinvolvedParty $silInvolvedParty;
   SIL_INVOLVEDPARTYindividual $silIndividual;
   SIL_INVOLVEDPARTYorganization $silOrganization;
   String $silLegalType := INT_SILMatchingTools.matchCMNIdToSILFCCRAMCustomerTypesDescription($silResponse.legalEntityType);
   If LIB_Validator.validateNotEmptyIndexed($silResponse.silInvolvedPartyList) Then
      ForEach $silInvolvedParty In $silResponse.silInvolvedPartyList Do
         If ISA($silResponse.search, SIL_TOOLSsearchInvolvedParty) && ISA($silInvolvedParty, SIL_INVOLVEDPARTYindividual) Then
            // Search for Physical Person
            $silIndividual := CAST(SIL_INVOLVEDPARTYindividual, $silInvolvedParty);
            $silResponse.partyList.addElement(INT_SILMappingSILtoCMN.createCMNSearchedPartyFromSILInvolvedParty(null, $silIndividual));
         ElseIf ISA($silResponse.search, SIL_TOOLSsearchInvolvedParty) && ISA($silInvolvedParty, SIL_INVOLVEDPARTYtrust) Then
            // Search for Organization
            $silOrganization := CAST(SIL_INVOLVEDPARTYtrust, $silInvolvedParty);
            $silResponse.partyList.addElement(INT_SILMappingSILtoCMN.createCMNSearchedPartyFromSILInvolvedParty(null, $silOrganization));
         ElseIf ISA($silResponse.search, SIL_TOOLSsearchInvolvedParty) && ISA($silInvolvedParty, SIL_INVOLVEDPARTYorganization) Then
            // Search for Organization
            $silOrganization := CAST(SIL_INVOLVEDPARTYorganization, $silInvolvedParty);
            If EQUAL($silOrganization.entityType, $silLegalType) or EQUAL(LIST(ERROR($silOrganization.businessTypes[1], '0'), 'SIL_BusinessType', 'entityType', 'id'), $silLegalType) Then
               $silResponse.partyList.addElement(INT_SILMappingSILtoCMN.createCMNSearchedPartyFromSILInvolvedParty(null, $silOrganization));
               /*CMN_Party $cmnParty := INT_SILMappingSILtoCMN.createCMNPartyFromSILInvolvedParty(null, $silOrganization);
               If $cmnParty != null Then
                  $silResponse.partyList.addElement($cmnParty);
               End*/
            Else
               $silResponse.unvalidPartyList.addElement(INT_SILMappingSILtoCMN.createCMNSearchedPartyFromSILInvolvedParty(null, $silOrganization));
               LIB_Logger.integrationError('[INT_SILMappingSILtoCMN]: Unknown type 1: ' & TOSTRING(TypeOf($silInvolvedParty, true)) & ', ' & $silResponse.legalEntityType);
            End
         Else
            $silResponse.unvalidPartyList.addElement(INT_SILMappingSILtoCMN.createCMNSearchedPartyFromSILInvolvedParty(null, $silOrganization));
            LIB_Logger.integrationError('[INT_SILMappingSILtoCMN]: Unknown type 2: ' & TOSTRING(TypeOf($silInvolvedParty, true)) & ', ' & $silResponse.legalEntityType);
         End
      End
   End
End]]></definition>
        </method>
        <method name="createCMNBusinessRelationship" userId="NM" uuid="ffffffff-a156-2ce0-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNBusinessRelationship(SIL_ACCOUNTAccount $silAccount) : CMN_BusinessRelationship Begin
   Return INT_SILMappingSILtoCMN.createCMNBusinessRelationshipFromSILAccount(null, $silAccount);
End]]></definition>
        </method>
        <method name="createCMNBusinessRelationshipFromSILAccount" userId="pezzi" uuid="00000000-0cb3-c4c1-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNBusinessRelationshipFromSILAccount(CMN_BusinessRelationship $cmnBusinessRelationship, SIL_ACCOUNTaccount $silAccount) : CMN_BusinessRelationship Begin
   If $cmnBusinessRelationship == null Then
      $cmnBusinessRelationship := CMN_BusinessRelationshipFactory__selector(NewObject(CMN_ClientLifecycleData));
   End
   /********************************** FIELDS from SIL_Account ****************************************/
   If $silAccount != null Then
      $cmnBusinessRelationship.setSILID($silAccount.accountId);
      $cmnBusinessRelationship.number := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.number, $silAccount.number);
      $cmnBusinessRelationship.openingDate := INT_SILMappingSILtoCMN._mapDate($cmnBusinessRelationship.openingDate, $silAccount.openingDate);
      If LIB_Validator.validateNotEmptyIndexed($silAccount.relationships) Then
         $cmnBusinessRelationship.relationshipCode := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.relationshipCode, $silAccount.relationships[1].id);
         $cmnBusinessRelationship.kytProfile.purposeOfAccount.actualRelationshipSize := INT_SILMappingSILtoCMN._mapLong($cmnBusinessRelationship.kytProfile.purposeOfAccount.actualRelationshipSize, TOLONG($silAccount.relationships[1].expectedAUM));
      End
      $cmnBusinessRelationship.bookingCenter := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.bookingCenter, LIST($silAccount.society, 'CMN_BookingCenter__selector', 'id', 'sil_Id'));
      If $silAccount.openningTeam != null Then
         $cmnBusinessRelationship.openingTeamGroup := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.openingTeamGroup, $silAccount.openningTeam.costCenterId);
         If $silAccount.openningTeam.isRelatedToUnit != null && ISA($silAccount.openningTeam.isRelatedToUnit, SIL_INVOLVEDPARTYdepartment) Then
            SIL_INVOLVEDPARTYdepartment $silDepartment := CAST(SIL_INVOLVEDPARTYdepartment, $silAccount.openningTeam.isRelatedToUnit);
            $cmnBusinessRelationship.bookingCenter := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.bookingCenter, $silDepartment.bookingCenter);
         End
      End
      IF($silAccount.accountMarketPurityCountry != null, $cmnBusinessRelationship.relationshipCountry := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.relationshipCountry, $silAccount.accountMarketPurityCountry.code));
      $cmnBusinessRelationship.kytProfile.generalInformation.accountHeadingType := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.accountHeadingType, LIST($silAccount.accountHeadingType, 'COB_AccountHeadingTypes', 'id', 'sil_Id'));
      $cmnBusinessRelationship.kytProfile.generalInformation.dormantCode := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.dormantCode, $silAccount.status);
      $cmnBusinessRelationship.kytProfile.generalInformation.isCoreMarket := INT_SILMappingSILtoCMN._mapBoolean($cmnBusinessRelationship.kytProfile.generalInformation.isCoreMarket, $silAccount.accountInCoreMarketIndicator);
      $cmnBusinessRelationship.kytProfile.generalInformation.descriptionCoreMarket := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.descriptionCoreMarket, $silAccount.nonCoreMarketApprovalDescription);
      $cmnBusinessRelationship.kytProfile.purposeOfAccount.hasPCM := INT_SILMappingSILtoCMN._mapBoolean($cmnBusinessRelationship.kytProfile.purposeOfAccount.hasPCM, $silAccount.pcmProductIndicator);
      $cmnBusinessRelationship.kytProfile.purposeOfAccount.PCMId := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.purposeOfAccount.PCMId, $silAccount.pcmProductReferenceId);
      IF($cmnBusinessRelationship.regulatoryProfile.cies != null, $cmnBusinessRelationship.regulatoryProfile.cies.hasCies := INT_SILMappingSILtoCMN._mapBoolean($cmnBusinessRelationship.regulatoryProfile.cies.hasCies, $silAccount.subjectToCIESIndicator));
      // MATCHING CLIENT TYPE @STODO NEEDS MORE CODES CURRENTLY ONLY ONE
      String $clientType := LIST($silAccount.clientCode, 'SIL_ClientCode', 'cmn_id', 'sil_id');
      If ! EMPTY($clientType) Then
         $cmnBusinessRelationship.clientType := $clientType;
      Else
         LIB_Logger.integrationError('[INT_SILMappingCMNToSIL]: Client Category Value does not exist in mapping table ( ' & $silAccount.clientCategory & ')');
      End
      // MATCHING USE CASE @STODO NEEDS MORE CODES CURRENTLY ONLY ONE
      /*String $useCase := LIST($silAccount.clientCategory, 'SIL_ClientCategory', 'cmn_id', 'sil_id');
      If ! EMPTY($useCase) Then
         $cmnBusinessRelationship.useCase := $useCase;
      Else
         LIB_Logger.integrationError('[INT_SILMappingCMNToSIL]: Use Case Value does not exist in mapping table ( ' & $silAccount.clientCode & ')');
      End*/
      If $silAccount.defaultCurrency != null Then
         $cmnBusinessRelationship.currency := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.currency, $silAccount.defaultCurrency.code);
      End
      /******** KYT - General Information ************/
      If LIB_Validator.validateNotEmptyIndexed($silAccount.accountEmployees) Then
         ForEach SIL_INVOLVEDPARTYRELATIONemployeeContractRelation $relation In $silAccount.accountEmployees Do
            SIL_INVOLVEDPARTYemployeeRole $silEmployeeRole := $relation.employeeRole;
            If ISA($silEmployeeRole, SIL_INVOLVEDPARTYaccountOfficer) Then
               SIL_INVOLVEDPARTYaccountOfficer $silINVOLVEDPARTYrelationshipManager := CAST(SIL_INVOLVEDPARTYaccountOfficer, $silEmployeeRole);
               String $silManagerType := LIST($relation.employeeRole.type, 'CMN_KYTAccountManager__selector', 'id', 'sil_id');
               If NotEmpty($silManagerType) Then
                  $cmnBusinessRelationship.kytProfile.generalInformation.accountManager := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.accountManager, $silManagerType);
                  If ISA($silEmployeeRole.inContext, SIL_INVOLVEDPARTYorganization) Then
                     SIL_INVOLVEDPARTYorganization $silDepartment := CAST(SIL_INVOLVEDPARTYorganization, $silEmployeeRole.inContext);
                     If LIB_Validator.validateNotEmptyIndexed($silDepartment.documentationItems) Then
                        ForEach SIL_INVOLVEDPARTYdocumentationItem $silDocumentationItem In $silDepartment.documentationItems Do
                           If ISA($silDocumentationItem, SIL_INVOLVEDPARTYincorporation) Then
                              SIL_INVOLVEDPARTYincorporation $silIncorporation := CAST(SIL_INVOLVEDPARTYincorporation, $silDocumentationItem);
                              If $silIncorporation.incorporateCountry != null && NotEmpty($silIncorporation.incorporateCountry.code) Then
                                 $cmnBusinessRelationship.kytProfile.generalInformation.country := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.country, $silIncorporation.incorporateCountry.code);
                              End
                           End
                        End
                     End
                  End
                  If EQUAL($cmnBusinessRelationship.kytProfile.generalInformation.accountManager, 'grou') Then
                     //$silDepartment.id
                     If ISA($silEmployeeRole.party, SIL_INVOLVEDPARTYorganization) Then
                        //business	
                        SIL_INVOLVEDPARTYorganization $silOrganization := CAST(SIL_INVOLVEDPARTYorganization, $silEmployeeRole.party);
                        If LIB_Validator.validateNotEmptyIndexed($silOrganization.names) Then
                           If ISA($silOrganization.names[1], SIL_INVOLVEDPARTYorganizationName) Then
                              $cmnBusinessRelationship.kytProfile.generalInformation.companyName := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.companyName, CAST(SIL_INVOLVEDPARTYorganizationName, $silOrganization.names[1]).businessName);
                           End
                        End
                     End
                  Else
                     If $silEmployeeRole.party != null Then
                        $cmnBusinessRelationship.kytProfile.generalInformation.id := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.id, $silEmployeeRole.party.id);
                        If ISA($silEmployeeRole.party, SIL_INVOLVEDPARTYorganization) Then
                           //business	
                           SIL_INVOLVEDPARTYorganization $silOrganization := CAST(SIL_INVOLVEDPARTYorganization, $silEmployeeRole.party);
                           If LIB_Validator.validateNotEmptyIndexed($silOrganization.names) Then
                              If ISA($silOrganization.names[1], SIL_INVOLVEDPARTYorganizationName) Then
                                 $cmnBusinessRelationship.kytProfile.generalInformation.companyName := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.companyName, CAST(SIL_INVOLVEDPARTYorganizationName, $silOrganization.names[1]).businessName);
                              End
                           End
                        Else
                           //individual
                           SIL_INVOLVEDPARTYindividual $silIndividual := CAST(SIL_INVOLVEDPARTYindividual, $silEmployeeRole.party);
                           If LIB_Validator.validateNotEmptyIndexed($silIndividual.names) Then
                              If ISA($silIndividual.names[1], SIL_INVOLVEDPARTYindividualName) Then
                                 $cmnBusinessRelationship.kytProfile.generalInformation.firstName := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.firstName, CAST(SIL_INVOLVEDPARTYindividualName, $silIndividual.names[1]).firstName);
                                 $cmnBusinessRelationship.kytProfile.generalInformation.lastName := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.lastName, CAST(SIL_INVOLVEDPARTYindividualName, $silIndividual.names[1]).lastName);
                              End
                           End
                        End
                     End
                     If $silINVOLVEDPARTYrelationshipManager.secondary != null Then
                        SIL_INVOLVEDPARTYaccountOfficer $silINVOLVEDPARTYSecondrelationshipManager := $silINVOLVEDPARTYrelationshipManager.secondary;
                        $cmnBusinessRelationship.kytProfile.generalInformation.id2nd := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.id2nd, $silINVOLVEDPARTYSecondrelationshipManager.party.id);
                        If ISA($silINVOLVEDPARTYSecondrelationshipManager.inContext, SIL_INVOLVEDPARTYorganization) Then
                           SIL_INVOLVEDPARTYorganization $silDepartment := CAST(SIL_INVOLVEDPARTYorganization, $silINVOLVEDPARTYSecondrelationshipManager.inContext);
                           If LIB_Validator.validateNotEmptyIndexed($silDepartment.documentationItems) Then
                              ForEach SIL_INVOLVEDPARTYdocumentationItem $silDocumentationItem In $silDepartment.documentationItems Do
                                 If ISA($silDocumentationItem, SIL_INVOLVEDPARTYincorporation) Then
                                    SIL_INVOLVEDPARTYincorporation $silIncorporation := CAST(SIL_INVOLVEDPARTYincorporation, $silDocumentationItem);
                                    If $silIncorporation.incorporateCountry != null && NotEmpty($silIncorporation.incorporateCountry.code) Then
                                       $cmnBusinessRelationship.kytProfile.generalInformation.country2nd := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.country2nd, $silIncorporation.incorporateCountry.code);
                                    End
                                 End
                              End
                           End
                        End
                        //individual
                        SIL_INVOLVEDPARTYindividual $silIndividual := CAST(SIL_INVOLVEDPARTYindividual, $silINVOLVEDPARTYSecondrelationshipManager.party);
                        If LIB_Validator.validateNotEmptyIndexed($silIndividual.names) Then
                           If ISA($silIndividual.names[1], SIL_INVOLVEDPARTYindividualName) Then
                              $cmnBusinessRelationship.kytProfile.generalInformation.firstName2nd := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.firstName2nd, CAST(SIL_INVOLVEDPARTYindividualName, $silIndividual.names[1]).firstName);
                              $cmnBusinessRelationship.kytProfile.generalInformation.lastName2nd := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.lastName2nd, CAST(SIL_INVOLVEDPARTYindividualName, $silIndividual.names[1]).lastName);
                           End
                        End
                     End
                  End
               End
            ElseIf ISA($relation.employeeRole, SIL_INVOLVEDPARTYemployeeRole) Then
               $cmnBusinessRelationship.kytProfile.generalInformation.businessAreaDeskHead := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.businessAreaDeskHead, $relation.employeeRole.id);
            End
         End
      End
      //$cmnBusinessRelationship.kytProfile.generalInformation.fccrmCustomerType := INT_SILMatchingTools.matchSILFCCRAMCustomerTypesIdToCMNId($silAccount.accountType);
      //Default the accountManager to RM
      //$cmnBusinessRelationship.kytProfile.generalInformation.accountManager := INT_SILMatchingTools.matchSILAccountManagerIdToCMNId('01');
      //RM Id - is the people soft Id which is the LDAP User
      /*  If NotEmpty($silAccount.internalAccountOfficer) Then
         LIB_User $user := NEW(LIB_User, $silAccount.internalAccountOfficer);
         If $user.exist() and $user.isRelationshipManager() Then
            $cmnBusinessRelationship.kytProfile.generalInformation.firstName := $user.getUser().getFirstName();
            $cmnBusinessRelationship.kytProfile.generalInformation.lastName := $user.getUser().getLastName();
            If EMPTY($cmnBusinessRelationship.kytProfile.generalInformation.country) Then
               $cmnBusinessRelationship.kytProfile.generalInformation.country := GetActiveVariationID();
            End
            $cmnBusinessRelationship.kytProfile.generalInformation.id := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.id, $silAccount.internalAccountOfficer);
         End
      End*/
      //@STODO - extract from LDAP, the RM First Name, RM Last Name 
      // $cmnBusinessRelationship.kytProfile.generalInformation.firstName := CAST(SIL_IndividualName, $silEmployeeDetails.party.names[1]).firstName;
      // $cmnBusinessRelationship.kytProfile.generalInformation.lastName := CAST(SIL_IndividualName, $silEmployeeDetails.party.names[1]).lastName;
      // RM Country @STODO - to be extracted from somewhere - 
      // $cmnBusinessRelationship.kytProfile.generalInformation.country := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.country, CAST(SIL_CountryAddress, $addresses[1]).country.code);
      $cmnBusinessRelationship.name := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.name, $silAccount.longName);
      /*************** Purpose of account **************/
      $cmnBusinessRelationship.kytProfile.purposeOfAccount.reasonAccountOpened := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.purposeOfAccount.reasonAccountOpened, $silAccount.openingReason);
      
      $cmnBusinessRelationship.kytProfile.purposeOfAccount.purposeSelection.clear();
      SIL_ACCOUNTaccountPurpose $silAccountPurpose;
      ForEach $silAccountPurpose In $silAccount.accountPurposes Do
         If $silAccountPurpose != null Then
            String $cmnAccountPurpose := INT_SILMatchingTools.matchSILAccountPurposeIdToCMNId($silAccountPurpose.purposeType);
            If NotEmpty($cmnAccountPurpose) Then
               $cmnBusinessRelationship.kytProfile.purposeOfAccount.purposeSelection.addElement($cmnAccountPurpose);
               If $cmnAccountPurpose == 'others' Then
                  $cmnBusinessRelationship.kytProfile.purposeOfAccount.otherPurpose := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.purposeOfAccount.otherPurpose, $silAccountPurpose.description);
               End
            End
         End
      End
      /*******Aount Investment && NBCE *****/
      INT_SILMappingSILtoCMNVariationFactory__selector().createCMNBusinessRelationshipFromSILAccount($cmnBusinessRelationship, $silAccount);
      /*************** Account Profile **************/
      $cmnBusinessRelationship := INT_SILMappingSILtoCMN.createCMNBusinessRelationshipFromSILAccountProfile($cmnBusinessRelationship, $silAccount);
      /*************** Visitation **************/
      $cmnBusinessRelationship := INT_SILMappingSILtoCMN.createCMNBusinessRelationshipFromSILAccountInitialVisit($cmnBusinessRelationship, $silAccount);
      /*************** Referral **************/
      $cmnBusinessRelationship := INT_SILMappingSILtoCMN.createCMNBusinessRelationshipFromSILAccountReferrals($cmnBusinessRelationship, $silAccount);
   End
   $cmnBusinessRelationship.isTakenFromSIL := true;
   Return $cmnBusinessRelationship;
End]]></definition>
        </method>
        <method name="createCMNBusinessRelationshipFromSILAccountActivity" userId="pezzi" uuid="00000000-776d-caf0-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNBusinessRelationshipFromSILAccountActivity(CMN_BusinessRelationship $cmnBusinessRelationship, Indexed SIL_KYCaccountActivity $silKycAccountActivity) : CMN_BusinessRelationship Begin
   If $cmnBusinessRelationship == null Then
      $cmnBusinessRelationship := CMN_BusinessRelationshipFactory__selector(NewObject(CMN_ClientLifecycleData));
   End
   /********************************** FIELDS from SIL_accountActivity ****************************************/
   If LIB_Validator.validateNotEmptyIndexed($silKycAccountActivity) Then
      //$cmnBusinessRelationship.kytProfile.expectedAccountActivity.hasExpectedInflowsOrOutflows := true;
      For Integer $i := 1 Condition $i <= $silKycAccountActivity.size() Step $i := $i + 1 Do
         SIL_KYCaccountActivity $silAccActivity := $silKycAccountActivity[$i];
         /************ transfers In *******************/
         $cmnBusinessRelationship.kytProfile.actualAccountActivity.transfersIn[$i] := NEW(CMN_KYTTransferActivity);
         $cmnBusinessRelationship.kytProfile.actualAccountActivity.transfersIn[$i].cashTransNumber := $silAccActivity.numberCashCreditTransaction;
         $cmnBusinessRelationship.kytProfile.actualAccountActivity.transfersIn[$i].cashTotalAmount := $silAccActivity.valueCashCreditTransaction;
         $cmnBusinessRelationship.kytProfile.actualAccountActivity.transfersIn[$i].wireTransfersTransNumber := $silAccActivity.numberIntWireCreditPayment;
         $cmnBusinessRelationship.kytProfile.actualAccountActivity.transfersIn[$i].wireTransfersTotalAmount := $silAccActivity.valueIntWireCreditPayment;
         $cmnBusinessRelationship.kytProfile.actualAccountActivity.transfersIn[$i].wireHrjTransfersTotalNumber := $silAccActivity.numberIntWireHrjCreditPayment;
         $cmnBusinessRelationship.kytProfile.actualAccountActivity.transfersIn[$i].wireHrjTransfersTotalAmount := $silAccActivity.valueIntWireHrjCreditPayment;
         /************ transfers Out *******************/
         $cmnBusinessRelationship.kytProfile.actualAccountActivity.transfersOut[$i] := NEW(CMN_KYTTransferActivity);
         $cmnBusinessRelationship.kytProfile.actualAccountActivity.transfersOut[$i].cashTransNumber := $silAccActivity.numberCashDebitTransaction;
         $cmnBusinessRelationship.kytProfile.actualAccountActivity.transfersOut[$i].cashTotalAmount := $silAccActivity.valueCashDebitTransaction;
         $cmnBusinessRelationship.kytProfile.actualAccountActivity.transfersOut[$i].wireTransfersTransNumber := $silAccActivity.numberIntWireDebitPayment;
         $cmnBusinessRelationship.kytProfile.actualAccountActivity.transfersOut[$i].wireTransfersTotalAmount := $silAccActivity.valueIntWireDebitPayment;
         $cmnBusinessRelationship.kytProfile.actualAccountActivity.transfersOut[$i].wireHrjTransfersTotalNumber := $silAccActivity.numberIntWireHrjDebitPayment;
         $cmnBusinessRelationship.kytProfile.actualAccountActivity.transfersOut[$i].wireHrjTransfersTotalAmount := $silAccActivity.valueIntWireHrjDebitPayment;
      End
   Else
      $cmnBusinessRelationship.kytProfile.actualAccountActivity := NEW(CMN_KYTActualAccountActivity);
      $cmnBusinessRelationship.kytProfile.actualAccountActivity.clearTwelveMonthsActivities();
      //$cmnBusinessRelationship.kytProfile.expectedAccountActivity.hasExpectedInflowsOrOutflows := false;
   End
   /********************************** RETURN ****************************************/
   Return $cmnBusinessRelationship;
End]]></definition>
        </method>
        <method name="createCMNBusinessRelationshipFromSILAccountFunding" userId="pezzi" uuid="ffffffff-cfe2-eafc-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNBusinessRelationshipFromSILAccountFunding(CMN_BusinessRelationship $cmnBusinessRelationship, SIL_ACCOUNTaccountFunding $silAccountFunding) : CMN_BusinessRelationship Begin
   If $cmnBusinessRelationship == null Then
      $cmnBusinessRelationship := CMN_BusinessRelationshipFactory__selector(NewObject(CMN_ClientLifecycleData));
   End
   /********************************** FIELDS from SIL_AccountFunding ****************************************/
   If $silAccountFunding != null Then
      /**************** PURPOSE OF ACCOUNT **********************/
      $cmnBusinessRelationship.kytProfile.initialFunding.fundsExplanation := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.initialFunding.fundsExplanation, $silAccountFunding.initialFundingExplanation);
      $cmnBusinessRelationship.kytProfile.purposeOfAccount.comments := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.purposeOfAccount.comments, $silAccountFunding.comments);
      $cmnBusinessRelationship.kytProfile.purposeOfAccount.expectedAccountSize := TOLONG(INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.purposeOfAccount.expectedAccountSize, $silAccountFunding.expectedAmount));
      $cmnBusinessRelationship.kytProfile.purposeOfAccount.deadlineToFundAccount := INT_SILMappingSILtoCMN._mapInteger($cmnBusinessRelationship.kytProfile.purposeOfAccount.deadlineToFundAccount, TOINTEGER(DATEFORMAT($silAccountFunding.expectedAmountDeadline, 'yyyy')));
   End
   /********************************** RETURN ****************************************/
   Return $cmnBusinessRelationship;
End]]></definition>
        </method>
        <method name="createCMNBusinessRelationshipFromSILAccountFundingTransfer" userId="pezzi" uuid="ffffffff-9ee9-4b07-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNBusinessRelationshipFromSILAccountFundingTransfer'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNBusinessRelationshipFromSILAccountFundingTransfer(CMN_BusinessRelationship $cmnBusinessRelationship, Indexed SIL_ORDERtransfer $silAccountFundingsTransfer) : CMN_BusinessRelationship Begin
   If $cmnBusinessRelationship == null Then
      $cmnBusinessRelationship := CMN_BusinessRelationshipFactory__selector(NewObject(CMN_ClientLifecycleData));
   End
   If not LIB_Validator.validateNotEmptyIndexed($silAccountFundingsTransfer) Then
      Return $cmnBusinessRelationship;
   End
   Indexed CMN_KYTSourceOfFund $previousCMNSourceOfFundCheques := NewIndexed(CMN_KYTSourceOfFund);
   Indexed CMN_KYTSourceOfFund $previousCMNSourceOfFundSecurities := NewIndexed(CMN_KYTSourceOfFund);
   Indexed CMN_KYTSourceOfFund $previousCMNSourceOfFundWireTransfers := NewIndexed(CMN_KYTSourceOfFund);
   /*****    Keep CMN Object without ID, copy one with ID to merge with SIL Objects *****/
   ForEach CMN_KYTSourceOfFund $previousCMNSourceOfFundCheque In $cmnBusinessRelationship.kytProfile.initialFunding.cheque Do
      If NotEmpty($previousCMNSourceOfFundCheque.getSILID()) Then
         $cmnBusinessRelationship.kytProfile.initialFunding.cheque.removeElement($previousCMNSourceOfFundCheque);
         $previousCMNSourceOfFundCheques.addElement($previousCMNSourceOfFundCheque);
      End
   End
   ForEach CMN_KYTSourceOfFund $previousCMNSourceOfFundSecuritiy In $cmnBusinessRelationship.kytProfile.initialFunding.securities Do
      If NotEmpty($previousCMNSourceOfFundSecuritiy.getSILID()) Then
         $cmnBusinessRelationship.kytProfile.initialFunding.securities.removeElement($previousCMNSourceOfFundSecuritiy);
         $previousCMNSourceOfFundSecurities.addElement($previousCMNSourceOfFundSecuritiy);
      End
   End
   ForEach CMN_KYTSourceOfFund $previousCMNSourceOfFundWireTransfer In $cmnBusinessRelationship.kytProfile.initialFunding.wireTransfers Do
      If NotEmpty($previousCMNSourceOfFundWireTransfer.getSILID()) Then
         $cmnBusinessRelationship.kytProfile.initialFunding.wireTransfers.removeElement($previousCMNSourceOfFundWireTransfer);
         $previousCMNSourceOfFundWireTransfers.addElement($previousCMNSourceOfFundWireTransfer);
      End
   End
   SIL_ORDERtransfer $silOrderTransfer;
   ForEach $silOrderTransfer In $silAccountFundingsTransfer Do
      If $silOrderTransfer != null Then
         /*************** EXPECTED ACCOUNT ACTIVITY ****************/
         If NotEmpty($silOrderTransfer.type) Then
            If EQUAL($silOrderTransfer.type, '6') Then
               $cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsCashAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsCashAmount, $silOrderTransfer.amount);
               $cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsCashAmountId := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsCashAmountId, $silOrderTransfer.id);
               /****************** physicalCash ******************/
            ElseIf EQUAL($silOrderTransfer.type, '8') Then
               $cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsPreciousMetalAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsPreciousMetalAmount, $silOrderTransfer.amount);
               $cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsPreciousMetalAmountId := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsPreciousMetalAmountId, $silOrderTransfer.id);
               /****************** physicalPreciousMetal ******************/
            ElseIf EQUAL($silOrderTransfer.type, '9') Then
               $cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsSecuritiesAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsSecuritiesAmount, $silOrderTransfer.amount);
               $cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsSecuritiesAmountId := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.initialFunding.phyAssetsSecuritiesAmountId, $silOrderTransfer.id);
               /****************** physicalSecurities ******************/
            Else
               CMN_KYTSourceOfFund $cmnSourceOfFund := NewObject(CMN_KYTSourceOfFund, '');
               If EQUAL($silOrderTransfer.type, '5') Then
                  /****************** CHEQUE ******************/
                  ForEach CMN_KYTSourceOfFund $otherCMNKycSourceOfFund In $previousCMNSourceOfFundCheques Do
                     If $otherCMNKycSourceOfFund.getSILID() == $silOrderTransfer.id Then
                        $cmnSourceOfFund := $otherCMNKycSourceOfFund;
                        Break;
                     End
                  End
                  $cmnBusinessRelationship.kytProfile.initialFunding.cheque.addElement($cmnSourceOfFund);
               ElseIf EQUAL($silOrderTransfer.type, '4') Then
                  /****************** SECURITY ******************/
                  ForEach CMN_KYTSourceOfFund $otherCMNKycSourceOfFund In $previousCMNSourceOfFundSecurities Do
                     If $otherCMNKycSourceOfFund.getSILID() == $silOrderTransfer.id Then
                        $cmnSourceOfFund := $otherCMNKycSourceOfFund;
                        Break;
                     End
                  End
                  $cmnBusinessRelationship.kytProfile.initialFunding.securities.addElement($cmnSourceOfFund);
               ElseIf EQUAL($silOrderTransfer.type, '3') Then
                  /****************** WIRE TRANSFER ******************/
                  ForEach CMN_KYTSourceOfFund $otherCMNKycSourceOfFund In $previousCMNSourceOfFundWireTransfers Do
                     If $otherCMNKycSourceOfFund.getSILID() == $silOrderTransfer.id Then
                        $cmnSourceOfFund := $otherCMNKycSourceOfFund;
                        Break;
                     End
                  End
                  $cmnBusinessRelationship.kytProfile.initialFunding.wireTransfers.addElement($cmnSourceOfFund);
               End
               $cmnSourceOfFund.setSILID(INT_SILMappingSILtoCMN._mapString($cmnSourceOfFund.getSILID(), TOSTRING($silOrderTransfer.id)));
               $cmnSourceOfFund.expectedAmount := INT_SILMappingSILtoCMN._mapDouble($cmnSourceOfFund.expectedAmount, $silOrderTransfer.amount);
               If $silOrderTransfer.debtorRole != null Then
                  $cmnSourceOfFund.orderingParty := INT_SILMatchingTools.matchSILDebtorRoleTypeToCMNDebtorRoleType($silOrderTransfer.debtorRole);
                  If $cmnSourceOfFund.orderingParty == 'thirdParty' and LIB_Validator.validateNotEmptyIndexed($silOrderTransfer.debtorRole.party.names) Then
                     $cmnSourceOfFund.thirdPartyName := INT_SILMappingSILtoCMN._mapString($cmnSourceOfFund.thirdPartyName, $silOrderTransfer.debtorRole.party.names[1].fullName);
                  End
               End
               If $silOrderTransfer.debtorBank != null Then
                  $cmnSourceOfFund.bank := INT_SILMappingSILtoCMN._mapString($cmnSourceOfFund.bank, LIST(TOSTRING($silOrderTransfer.debtorBank.type), 'SIL_KYTBank', 'id', 'sil_id'));
                  If LIB_Validator.validateNotEmptyIndexed($silOrderTransfer.debtorBank.names) && ISA($silOrderTransfer.debtorBank.names[1], SIL_INVOLVEDPARTYorganizationName) Then
                     $cmnSourceOfFund.bankName := CAST(SIL_INVOLVEDPARTYorganizationName, $silOrderTransfer.debtorBank.names[1]).businessName;
                  ElseIf LIB_Validator.validateNotEmptyIndexed($silOrderTransfer.debtorBank.names) Then
                     $cmnSourceOfFund.entity := LIST($silOrderTransfer.debtorBank.names[1].fullName, 'CMN_HSBCEntities__selector', 'id', 'description');
                  End
               End
               If $silOrderTransfer.subAccountSell != null Then
                  $cmnSourceOfFund.accountNumber := INT_SILMappingSILtoCMN._mapString($cmnSourceOfFund.accountNumber, $silOrderTransfer.subAccountSell.id);
               End
               If $silOrderTransfer.originOfFundsCountry != null Then
                  $cmnSourceOfFund.country := INT_SILMappingSILtoCMN._mapString($cmnSourceOfFund.country, $silOrderTransfer.originOfFundsCountry.code);
               End
               $cmnSourceOfFund.type := INT_SILMappingSILtoCMN._mapString($cmnSourceOfFund.type, $silOrderTransfer.type);
            End
         End
      End
   End
   Return $cmnBusinessRelationship;
End]]></definition>
        </method>
        <method name="createCMNBusinessRelationshipFromSILAccountInitialVisit" userId="43880320-CH01" uuid="ffffffff-aad4-efc8-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNBusinessRelationshipFromSILAccountInitialVisit'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNBusinessRelationshipFromSILAccountInitialVisit(CMN_BusinessRelationship $cmnBusinessRelationship, SIL_ACCOUNTaccount $silAccount) : CMN_BusinessRelationship Begin
   If $cmnBusinessRelationship == null Then
      $cmnBusinessRelationship := CMN_BusinessRelationshipFactory__selector(NewObject(CMN_ClientLifecycleData));
   End
   /********************************** FIELDS from SIL_Account Visitation****************************************/
   If $silAccount != null && $silAccount.initialVisit != null Then
      $cmnBusinessRelationship.kytProfile.visitation.reasonCustomerNotVisited := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.visitation.reasonCustomerNotVisited, $silAccount.initialVisit.nextVisitPlanDescription);
      $cmnBusinessRelationship.kytProfile.visitation.plannedFirstVisitDate := INT_SILMappingSILtoCMN._mapDate($cmnBusinessRelationship.kytProfile.visitation.plannedFirstVisitDate, $silAccount.initialVisit.nextVisitDate);
      $cmnBusinessRelationship.kytProfile.visitation.descriptionFirstVisitNewClient := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.visitation.descriptionFirstVisitNewClient, $silAccount.initialVisit.report);
      If LIB_Validator.validateNotEmptyIndexed($silAccount.initialVisit.initialVisitLocations) Then
         SIL_STATIClocation $location;
         ForEach $location In $silAccount.initialVisit.initialVisitLocations Do
            If NotEmpty($location.type) Then
               $cmnBusinessRelationship.kytProfile.visitation.placesFirstVisit.addElement(LIST($location.type, 'CMN_PlaceOfFirstVisit__selector', 'id', 'sil_id'));
            End
            If NotEmpty($location.name) Then
               $cmnBusinessRelationship.kytProfile.visitation.placesFirstVisit.addElement('others');
               $cmnBusinessRelationship.kytProfile.visitation.othersPlacesVisit := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.visitation.othersPlacesVisit, $location.name);
            End
         End
      End
      If $cmnBusinessRelationship.kytProfile.visitation.hasCustomerVisitedPremises and LIB_Validator.validateNotEmptyIndexed($silAccount.initialVisit.contactActivities) Then
         SIL_CONTACTACTIVITYcontactActivity $silCONTACTACTIVITYcontactActivity;
         ForEach $silCONTACTACTIVITYcontactActivity In $silAccount.initialVisit.contactActivities Do
            If ISA($silCONTACTACTIVITYcontactActivity, SIL_CONTACTACTIVITYvisitComplete) Then
               SIL_CONTACTACTIVITYvisitComplete $visit := CAST(SIL_CONTACTACTIVITYvisitComplete, $silCONTACTACTIVITYcontactActivity);
               CMN_Partner $cmnPartner := NEW(CMN_Partner);
               $cmnPartner.isVisited := true;
               If LIB_Validator.validateNotEmptyIndexed($visit.visitedRoles) Then
                  SIL_INVOLVEDPARTYinvolvedPartyRole $silRole := $visit.visitedRoles[1];
                  $cmnPartner.role := INT_SILMappingSILtoCMN._mapString($cmnPartner.role, $silRole.type);
                  If $silRole.party != null Then
                     $cmnPartner.id := INT_SILMappingSILtoCMN._mapString($cmnPartner.id, $silRole.party.id);
                     If LIB_Validator.validateNotEmptyIndexed($silRole.party.names) and ISA($silRole.party.names[1], SIL_INVOLVEDPARTYindividualName) Then
                        $cmnPartner.firstName := INT_SILMappingSILtoCMN._mapString($cmnPartner.firstName, CAST(SIL_INVOLVEDPARTYindividualName, $silRole.party.names[1]).firstName);
                        $cmnPartner.lastName := INT_SILMappingSILtoCMN._mapString($cmnPartner.lastName, CAST(SIL_INVOLVEDPARTYindividualName, $silRole.party.names[1]).lastName);
                        If EMPTY($cmnPartner.firstName) and EMPTY($cmnPartner.lastName) Then
                           Indexed String $names := SPLIT($silRole.party.names[1].fullName, ' ');
                           If LIB_Validator.validateNotEmptyIndexed($names) Then
                              If $names.size() > 0 Then
                                 $cmnPartner.firstName := $names[1];
                                 $names.removeElementAt(1);
                              End
                              IF($names.size() > 0, $cmnPartner.lastName := JOINLIST($names, ' '));
                           End
                        End
                     End
                  End
               End
               $cmnPartner.role := INT_SILMappingSILtoCMN._mapString($cmnPartner.role, $visit.type);
               If $visit.responsibleRole != null && $visit.responsibleRole.party != null && ISA($visit.responsibleRole.party, SIL_INVOLVEDPARTYindividual) and LIB_Validator.validateNotEmptyIndexed($visit.responsibleRole.party.names) Then
                  $cmnPartner.visitedbyFirstName := INT_SILMappingSILtoCMN._mapString($cmnPartner.visitedbyFirstName, CAST(SIL_INVOLVEDPARTYindividualName, CAST(SIL_INVOLVEDPARTYindividual, $visit.responsibleRole.party).names[1]).firstName);
                  $cmnPartner.visitedbyLastName := INT_SILMappingSILtoCMN._mapString($cmnPartner.visitedbyLastName, CAST(SIL_INVOLVEDPARTYindividualName, CAST(SIL_INVOLVEDPARTYindividual, $visit.responsibleRole.party).names[1]).lastName);
               End
               $cmnPartner.visitedDate := INT_SILMappingSILtoCMN._mapDate($cmnPartner.visitedDate, $visit.dateOfVisit);
               $cmnBusinessRelationship.kytProfile.partners.addElement($cmnPartner);
            End
         End
      Else
         $cmnBusinessRelationship.kytProfile.visitation.reasonCustomerNotVisited := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.visitation.reasonCustomerNotVisited, $silAccount.initialVisit.nextVisitPlanDescription);
         $cmnBusinessRelationship.kytProfile.visitation.plannedFirstVisitDate := INT_SILMappingSILtoCMN._mapDate($cmnBusinessRelationship.kytProfile.visitation.plannedFirstVisitDate, $silAccount.initialVisit.nextVisitDate);
      End
   End
   Return $cmnBusinessRelationship;
End]]></definition>
        </method>
        <method name="createCMNBusinessRelationshipFromSILAccountProfile" userId="pezzi" uuid="ffffffff-dbd1-b1a8-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNBusinessRelationshipFromSILAccountProfile'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNBusinessRelationshipFromSILAccountProfile(CMN_BusinessRelationship $cmnBusinessRelationship, SIL_ACCOUNTaccount $silAccount) : CMN_BusinessRelationship Begin
   If $cmnBusinessRelationship == null Then
      $cmnBusinessRelationship := CMN_BusinessRelationshipFactory__selector(NewObject(CMN_ClientLifecycleData));
   End
   /********************************** FIELDS from SIL_Account Profile****************************************/
   If $silAccount != null && $silAccount.accountProfile != null Then
      $cmnBusinessRelationship.kytProfile.referrals.isReferred := INT_SILMappingSILtoCMN._mapBoolean($cmnBusinessRelationship.kytProfile.referrals.isReferred, INT_SILMatchingTools.matchSILYesNoToCMNBoolean($silAccount.accountProfile.isReferred));
      $cmnBusinessRelationship.kytProfile.visitation.hasCustomerVisitedPremises := INT_SILMappingSILtoCMN._mapBoolean($cmnBusinessRelationship.kytProfile.visitation.hasCustomerVisitedPremises, $silAccount.accountProfile.hasClientBeenVisited);
      INT_SILMappingSILtoCMNVariationFactory__selector().createCMNBusinessRelationshipFromSILAccountProfile($cmnBusinessRelationship, $silAccount);
   End
   Return $cmnBusinessRelationship;
End]]></definition>
        </method>
        <method name="createCMNBusinessRelationshipFromSILAccountReferrals" userId="pezzi" uuid="00000000-32fa-1cb5-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNBusinessRelationshipFromSILAccountReferrals'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNBusinessRelationshipFromSILAccountReferrals(CMN_BusinessRelationship $cmnBusinessRelationship, SIL_ACCOUNTaccount $silAccount) : CMN_BusinessRelationship Begin
   If $cmnBusinessRelationship == null Then
      $cmnBusinessRelationship := CMN_BusinessRelationshipFactory__selector(NewObject(CMN_ClientLifecycleData));
   End
   /*************** Referral **************/
   If $silAccount != null && $silAccount.accountReferrals != null Then
      $cmnBusinessRelationship.kytProfile.referrals.isReferred := true;
      If LIB_Validator.validateNotEmptyIndexed($silAccount.accountReferrals.referredPartnerRoles) Then
         SIL_INVOLVEDPARTYinvolvedPartyRole $silRole := $silAccount.accountReferrals.referredPartnerRoles[1];
         CMN_Partner $cmnPartner := NEW(CMN_Partner);
         $cmnPartner.role := INT_SILMappingSILtoCMN._mapString($cmnPartner.role, $silRole.type);
         If $silRole.party != null Then
            $cmnPartner.id := INT_SILMappingSILtoCMN._mapString($cmnPartner.id, $silRole.party.id);
            $cmnPartner.referralSelected := $cmnPartner.getId();
            If LIB_Validator.validateNotEmptyIndexed($silRole.party.names) and ISA($silRole.party.names[1], SIL_INVOLVEDPARTYindividualName) Then
               $cmnPartner.firstName := INT_SILMappingSILtoCMN._mapString($cmnPartner.firstName, CAST(SIL_INVOLVEDPARTYindividualName, $silRole.party.names[1]).firstName);
               $cmnPartner.lastName := INT_SILMappingSILtoCMN._mapString($cmnPartner.lastName, CAST(SIL_INVOLVEDPARTYindividualName, $silRole.party.names[1]).lastName);
               If EMPTY($cmnPartner.firstName) and EMPTY($cmnPartner.lastName) Then
                  Indexed String $names := SPLIT($silRole.party.names[1].fullName, ' ');
                  If LIB_Validator.validateNotEmptyIndexed($names) Then
                     If $names.size() > 0 Then
                        $cmnPartner.firstName := $names[1];
                        $names.removeElementAt(1);
                     End
                     IF($names.size() > 0, $cmnPartner.lastName := JOINLIST($names, ' '));
                  End
               End
            End
         End
      End
      If $silAccount.accountReferrals.referrerRole != null Then
         If $silAccount.accountReferrals.referrerRole.party != null && $silAccount.accountReferrals.referrerRole.party.existingCustomerIndicator Then
            $cmnBusinessRelationship.kytProfile.referrals.isAnExistingPbrsClient6months := 'moreSixMonths';
         Else
            $cmnBusinessRelationship.kytProfile.referrals.isAnExistingPbrsClient6months := null;
            If EQUAL(TOSTRING($silAccount.accountReferrals.referrerRole.referredByType), '08') Then
               $cmnBusinessRelationship.kytProfile.referrals.isAnExistingPbrsClient6months := 'moreSixMonths';
            Else
               $cmnBusinessRelationship.kytProfile.referrals.referredType := INT_SILMatchingTools.matchSILRefferalNameToCMNRefferedBy(TOSTRING($silAccount.accountReferrals.referrerRole.referredByType));
            End
            $cmnBusinessRelationship.kytProfile.referrals.referredBy.type := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.referrals.referredBy.type, LIST($silAccount.accountReferrals.referrerRole.referredBySubType, 'CMN_ReferredTypeByReferralsReferredType', 'id', 'sil_Id'));
            If $silAccount.accountReferrals.referrerRole.party != null Then
               $cmnBusinessRelationship.kytProfile.referrals.referredBy.id := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.referrals.referredBy.id, $silAccount.accountReferrals.referrerRole.party.id);
               If ISA($silAccount.accountReferrals.referrerRole.party, SIL_INVOLVEDPARTYindividual) Then
                  $cmnBusinessRelationship.kytProfile.referrals.referredBy.firstName := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.referrals.referredBy.firstName, CAST(SIL_INVOLVEDPARTYindividualName, $silAccount.accountReferrals.referrerRole.party.names[1]).firstName);
                  $cmnBusinessRelationship.kytProfile.referrals.referredBy.surname := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.referrals.referredBy.surname, CAST(SIL_INVOLVEDPARTYindividualName, $silAccount.accountReferrals.referrerRole.party.names[1]).lastName);
                  If EMPTY($cmnBusinessRelationship.kytProfile.referrals.referredBy.firstName) and EMPTY($cmnBusinessRelationship.kytProfile.referrals.referredBy.surname) Then
                     Indexed String $names := SPLIT($silAccount.accountReferrals.referrerRole.party.names[1].fullName, '\\s');
                     If LIB_Validator.validateNotEmptyIndexed($names) Then
                        If $names.size() > 0 Then
                           $cmnBusinessRelationship.kytProfile.referrals.referredBy.firstName := $names[1];
                           $names.removeElementAt(1);
                        End
                        IF($names.size() > 0, $cmnBusinessRelationship.kytProfile.referrals.referredBy.surname := JOINLIST($names, ' '));
                     End
                  End
               End
               If ISA($silAccount.accountReferrals.referrerRole.party, SIL_INVOLVEDPARTYorganization) Then
                  SIL_INVOLVEDPARTYorganization $organization := CAST(SIL_INVOLVEDPARTYorganization, $silAccount.accountReferrals.referrerRole.party);
                  If LIB_Validator.validateNotEmptyIndexed($organization.documentationItems) and ISA($organization.documentationItems[1], SIL_INVOLVEDPARTYincorporation) Then
                     $cmnBusinessRelationship.kytProfile.referrals.referredBy.hsbcGroupCountry := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.referrals.referredBy.hsbcGroupCountry, LIST(CAST(SIL_INVOLVEDPARTYincorporation, $organization.documentationItems[1]).incorporateCountry.code, 'CMN_ReferralEntity__selector', 'id', 'countryCode'));
                  ElseIf NotEmpty($organization.id) Then
                     $cmnBusinessRelationship.kytProfile.referrals.referredBy.hsbcGroupCountry := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.referrals.referredBy.hsbcGroupCountry, LIST($organization.id, 'CMN_ReferralEntity__selector', 'id', 'sil_id'));
                  End
               End
               $cmnBusinessRelationship.kytProfile.referrals.referredBy.referredDate := INT_SILMappingSILtoCMN._mapDate($cmnBusinessRelationship.kytProfile.referrals.referredBy.referredDate, $silAccount.accountReferrals.referrerRole.knowsReferredPartnerSince);
               $cmnBusinessRelationship.kytProfile.referrals.referredBy.relationship := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.referrals.referredBy.relationship, $silAccount.accountReferrals.referrerRole.relationshipWithReferredPartner);
            End
         End
      End
   End
   Return $cmnBusinessRelationship;
End]]></definition>
        </method>
        <method name="createCMNBusinessRelationshipFromSILAccountTaxInformation" userId="pezzi" uuid="00000000-03a9-1fa2-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNBusinessRelationshipFromSILAccountTaxInformation'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNBusinessRelationshipFromSILAccountTaxInformation(CMN_BusinessRelationship $cmnBusinessRelationship, SIL_INVOLVEDPARTYtaxInformation $silTaxInformation) : CMN_BusinessRelationship Begin
   If $cmnBusinessRelationship == null Then
      $cmnBusinessRelationship := CMN_BusinessRelationshipFactory__selector(NewObject(CMN_ClientLifecycleData));
   End
   If $silTaxInformation != null Then
      If LIB_Validator.validateNotEmptyIndexed($silTaxInformation.taxDetails) Then
         ForEach SIL_INVOLVEDPARTYtaxDetail $silTD In $silTaxInformation.taxDetails Do
            /********** Tax Statements and for Tax Reclaim *********/
            INT_SILMappingSILtoCMNVariationFactory__selector().createCMNBusinessRelationshipFromSILTaxDetail($silTD, $cmnBusinessRelationship);
         End
      End
   End
   Return $cmnBusinessRelationship;
End]]></definition>
        </method>
        <method name="createCMNBusinessRelationshipFromSILAccountTransferActivity" userId="pezzi" uuid="00000000-0e2a-5afb-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNBusinessRelationshipFromSILAccountTransferActivity(CMN_BusinessRelationship $cmnBusinessRelationship, Indexed SIL_KYCaccountTransferActivity $silKycAccountActivity) : CMN_BusinessRelationship Begin
   If $cmnBusinessRelationship == null Then
      $cmnBusinessRelationship := CMN_BusinessRelationshipFactory__selector(NewObject(CMN_ClientLifecycleData));
   End
   /********************************** FIELDS from SIL_accountActivity ****************************************/
   If LIB_Validator.validateNotEmptyIndexed($silKycAccountActivity) Then
      SIL_KYCaccountTransferActivity $silAccActivity;
      ForEach $silAccActivity In $silKycAccountActivity Do
         If $silAccActivity.isAnyTransferExpected Then
            $cmnBusinessRelationship.kytProfile.expectedAccountActivity.hasExpectedInflowsOrOutflows := true;
         End
         $cmnBusinessRelationship.kytProfile.expectedAccountActivity.inflowsOrOutflowsReason := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.expectedAccountActivity.inflowsOrOutflowsReason, $silAccActivity.reason);
         $cmnBusinessRelationship.kytProfile.expectedAccountActivity.isHighRiskOrSensitive := INT_SILMappingSILtoCMN._mapBoolean($cmnBusinessRelationship.kytProfile.expectedAccountActivity.isHighRiskOrSensitive, $silAccActivity.transferHighRiskCountryIndicator);
         String $type := $silAccActivity.transferType;
         If ISA($silAccActivity, SIL_KYCaccountTransferInActivity) Then
            $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.silIds[$type] := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.silIds[$type], $silAccActivity.id);
         Else
            $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.silIds[$type] := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.silIds[$type], $silAccActivity.id);
         End
         If $type == 'PHYSICAL' Then
            If ISA($silAccActivity, SIL_KYCaccountTransferInActivity) Then
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.cashTransNumber := INT_SILMappingSILtoCMN._mapInteger($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.cashTransNumber, $silAccActivity.cashNumberOfTransactions);
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.cashTotalAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.cashTotalAmount, $silAccActivity.cashTotalAmountInUSD);
            ElseIf ISA($silAccActivity, SIL_KYCaccountTransferOutActivity) Then
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.cashTransNumber := INT_SILMappingSILtoCMN._mapInteger($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.cashTransNumber, $silAccActivity.cashNumberOfTransactions);
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.cashTotalAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.cashTotalAmount, $silAccActivity.cashTotalAmountInUSD);
            End
            If ISA($silAccActivity, SIL_KYCaccountTransferInActivity) Then
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.securitiesTransNumber := INT_SILMappingSILtoCMN._mapInteger($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.securitiesTransNumber, $silAccActivity.securitiesNumberOfTransactions);
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.securitiesTotalAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.securitiesTotalAmount, $silAccActivity.securitiesTotalAmountInUSD);
            ElseIf ISA($silAccActivity, SIL_KYCaccountTransferOutActivity) Then
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.securitiesTransNumber := INT_SILMappingSILtoCMN._mapInteger($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.securitiesTransNumber, $silAccActivity.securitiesNumberOfTransactions);
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.securitiesTotalAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.securitiesTotalAmount, $silAccActivity.securitiesTotalAmountInUSD);
            End
            If ISA($silAccActivity, SIL_KYCaccountTransferInActivity) Then
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.preciousMetalTransNumber := INT_SILMappingSILtoCMN._mapInteger($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.preciousMetalTransNumber, $silAccActivity.preciousMetalNumberOfTransactions);
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.preciousMetalTotalAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.preciousMetalTotalAmount, $silAccActivity.preciousMetalTotalAmountInUSD);
            ElseIf ISA($silAccActivity, SIL_KYCaccountTransferOutActivity) Then
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.preciousMetalTransNumber := INT_SILMappingSILtoCMN._mapInteger($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.preciousMetalTransNumber, $silAccActivity.preciousMetalNumberOfTransactions);
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.preciousMetalTotalAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.preciousMetalTotalAmount, $silAccActivity.preciousMetalTotalAmountInUSD);
            End
            $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.nonPhyPurposeDescription := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.purposeDescription, $silAccActivity.transactionPurpose);
         ElseIf $type == 'NONPHYSICAL' Then
            If ISA($silAccActivity, SIL_KYCaccountTransferInActivity) Then
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.chequeTransNumber := INT_SILMappingSILtoCMN._mapInteger($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.chequeTransNumber, $silAccActivity.chequeNumberOfTransactions);
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.chequeTotalAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.chequeTotalAmount, $silAccActivity.cashTotalAmountInUSD);
               If LIB_Validator.validateNotEmptyIndexed($silAccActivity.chequeCountries) and NotEmpty($silAccActivity.chequeCountries[1].code) Then
                  $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.chequeCountries := $silAccActivity.chequeCountries[1].code;
               End
            ElseIf ISA($silAccActivity, SIL_KYCaccountTransferOutActivity) Then
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.chequeTransNumber := INT_SILMappingSILtoCMN._mapInteger($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.chequeTransNumber, $silAccActivity.chequeNumberOfTransactions);
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.chequeTotalAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.chequeTotalAmount, $silAccActivity.cashTotalAmountInUSD);
               If LIB_Validator.validateNotEmptyIndexed($silAccActivity.chequeCountries) and NotEmpty($silAccActivity.chequeCountries[1].code) Then
                  $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.chequeCountries := $silAccActivity.chequeCountries[1].code;
               End
            End
            If ISA($silAccActivity, SIL_KYCaccountTransferInActivity) Then
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.nonPhySecuritiesTransNumber := INT_SILMappingSILtoCMN._mapInteger($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.nonPhySecuritiesTransNumber, $silAccActivity.securitiesNumberOfTransactions);
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.nonPhySecuritiesTotalAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.nonPhySecuritiesTotalAmount, $silAccActivity.securitiesTotalAmountInUSD);
               If LIB_Validator.validateNotEmptyIndexed($silAccActivity.securitiesCountries) and NotEmpty($silAccActivity.securitiesCountries[1].code) Then
                  $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.nonPhySecurietiesCountries := $silAccActivity.securitiesCountries[1].code;
               End
            ElseIf ISA($silAccActivity, SIL_KYCaccountTransferOutActivity) Then
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.nonPhySecuritiesTransNumber := INT_SILMappingSILtoCMN._mapInteger($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.nonPhySecuritiesTransNumber, $silAccActivity.securitiesNumberOfTransactions);
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.nonPhySecuritiesTotalAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.nonPhySecuritiesTotalAmount, $silAccActivity.securitiesTotalAmountInUSD);
               If LIB_Validator.validateNotEmptyIndexed($silAccActivity.securitiesCountries) and NotEmpty($silAccActivity.securitiesCountries[1].code) Then
                  $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.nonPhySecurietiesCountries := $silAccActivity.securitiesCountries[1].code;
               End
            End
            If ISA($silAccActivity, SIL_KYCaccountTransferInActivity) Then
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.wireTransfersTransNumber := INT_SILMappingSILtoCMN._mapInteger($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.wireTransfersTransNumber, $silAccActivity.wireTransferNumberOfTransactions);
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.wireTransfersTotalAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.wireTransfersTotalAmount, $silAccActivity.wireTransferTotalAmountInUSD);
               If LIB_Validator.validateNotEmptyIndexed($silAccActivity.wireTransferCountries) and NotEmpty($silAccActivity.wireTransferCountries[1].code) Then
                  $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.wireTransferCountries := $silAccActivity.wireTransferCountries[1].code;
               End
            ElseIf ISA($silAccActivity, SIL_KYCaccountTransferOutActivity) Then
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.wireTransfersTransNumber := INT_SILMappingSILtoCMN._mapInteger($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.wireTransfersTransNumber, $silAccActivity.wireTransferNumberOfTransactions);
               $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.wireTransfersTotalAmount := INT_SILMappingSILtoCMN._mapDouble($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.wireTransfersTotalAmount, $silAccActivity.wireTransferTotalAmountInUSD);
               If LIB_Validator.validateNotEmptyIndexed($silAccActivity.wireTransferCountries) and NotEmpty($silAccActivity.wireTransferCountries[1].code) Then
                  $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferOut.wireTransferCountries := $silAccActivity.wireTransferCountries[1].code;
               End
            End
            $cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.nonPhyPurposeDescription := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.expectedAccountActivity.transferIn.purposeDescription, $silAccActivity.transactionPurpose);
         End
      End
   End
   If $cmnBusinessRelationship.kytProfile.expectedAccountActivity.hasExpectedInflowsOrOutflows == null Then
      $cmnBusinessRelationship.kytProfile.expectedAccountActivity.hasExpectedInflowsOrOutflows := false;
   End
   /********************************** RETURN ****************************************/
   Return $cmnBusinessRelationship;
End]]></definition>
        </method>
        <method name="createCMNBusinessRelationshipFromSILEmployeeRole" userId="43880320-CH01" uuid="00000000-07bc-1630-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNBusinessRelationshipFromSILEmployeeRole(CMN_BusinessRelationship $cmnBusinessRelationship, Indexed SIL_INVOLVEDPARTYemployeeRole $silEmployeesDetails) : CMN_BusinessRelationship Begin
   If $cmnBusinessRelationship == null Then
      $cmnBusinessRelationship := CMN_BusinessRelationshipFactory__selector(NewObject(CMN_ClientLifecycleData));
   End
   /********************************** FIELDS from SIL_EmployeeRole ****************************************/
   If $silEmployeesDetails != null and LIB_Validator.validateNotEmptyIndexed($silEmployeesDetails) Then
      SIL_INVOLVEDPARTYemployeeRole $silEmployeeDetails := $silEmployeesDetails[1];
      If EMPTY($cmnBusinessRelationship.bookingCenter) Then
         If $silEmployeeDetails.inContext != null and ISA($silEmployeeDetails.inContext, SIL_INVOLVEDPARTYDepartment) and CAST(SIL_INVOLVEDPARTYDepartment, $silEmployeeDetails.inContext).country != null Then
            String $bookingCenter := LIST(CAST(SIL_INVOLVEDPARTYDepartment, $silEmployeeDetails.inContext).country.code, 'CMN_BookingCenter__selector', 'id', 'country');
            $cmnBusinessRelationship.bookingCenter := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.bookingCenter, $bookingCenter);
         End
      End
      /************** KYT General Information *******************/
      //  -HSBC Entity Name
      If $silEmployeeDetails.inContext != null and ISA($silEmployeeDetails.inContext, SIL_INVOLVEDPARTYDepartment) Then
         SIL_INVOLVEDPARTYinvolvedPartyName $iterator;
         Indexed SIL_INVOLVEDPARTYinvolvedPartyName $names := FILTER($silEmployeeDetails.inContext.names, ISA($iterator, SIL_INVOLVEDPARTYorganizationName), $iterator);
         If LIB_Validator.validateNotEmptyIndexed($names) Then
            $cmnBusinessRelationship.kytProfile.generalInformation.hsbcEntityName := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.hsbcEntityName, CAST(SIL_INVOLVEDPARTYorganizationName, $names[1]).businessName);
            $cmnBusinessRelationship.kytProfile.generalInformation.hsbcEntityCountry := LIST($cmnBusinessRelationship.kytProfile.generalInformation.hsbcEntityName, 'CMN_ReferralEntity__selector', 'id', 'description');
         End
      End
      /* TAKEN DIRECTLY FROM LDAP
      If $silEmployeeDetails.party != null and ISA($silEmployeeDetails.party, SIL_Individual) Then
         SIL_Individual $individual := CAST(SIL_Individual, $silEmployeeDetails.party);
         If LIB_Validator.validateNotEmptyIndexed($individual.names) Then
            SIL_InvolvedPartyName $iterator;
            ForEach $iterator In $individual.names Do
               If ISA($iterator, SIL_IndividualName) Then
               SIL_IndividualName $silIndividualName := CAST(SIL_IndividualName,$iterator);
               $cmnBusinessRelationship.kytProfile.generalInformation.lastName := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.lastName,$silIndividualName.lastName);
               $cmnBusinessRelationship.kytProfile.generalInformation.firstName := INT_SILMappingSILtoCMN._mapString($cmnBusinessRelationship.kytProfile.generalInformation.firstName,$silIndividualName.firstName);
               End
            End
         End
      End*/
   End
   /********************************** RETURN ****************************************/
   Return $cmnBusinessRelationship;
End]]></definition>
        </method>
        <method name="createCMNBusinessRelationshipFromSILService" userId="43880320-CH01" uuid="ffffffff-c924-0149-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNBusinessRelationshipFromSILService(CMN_BusinessRelationship $cmnBusinessRelationship, SIL_RELATIONService $silService) : CMN_BusinessRelationship Begin
   If $cmnBusinessRelationship == null Then
      $cmnBusinessRelationship := CMN_BusinessRelationshipFactory__selector(NewObject(CMN_ClientLifecycleData));
   End
   /********************* MAP SIL SERVICE ***********************/
   Return $cmnBusinessRelationship;
End]]></definition>
        </method>
        <method name="createCMNBusinessRelationshipFromSILSubAccount" userId="43880320-CH01" uuid="ffffffff-bd44-a8b9-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNBusinessRelationshipFromSILSubAccount(CMN_BusinessRelationship $cmnBusinessRelationship, Indexed SIL_ACCOUNTsubAccount $silSubAccountList) : CMN_BusinessRelationship Begin
   If $cmnBusinessRelationship == null Then
      $cmnBusinessRelationship := CMN_BusinessRelationshipFactory__selector(NewObject(CMN_ClientLifecycleData));
   End
   /********************************** FIELDS from SIL_SubAccount ****************************************/
   If LIB_Validator.validateNotEmptyIndexed($silSubAccountList) Then
      SIL_ACCOUNTsubAccount $silSubAccount;
      ForEach $silSubAccount In $silSubAccountList Do
      End
   End
   /********************************** RETURN ****************************************/
   Return $cmnBusinessRelationship;
End]]></definition>
        </method>
        <method name="createCMNBusinessRelationshipRoles" userId="pezzi" uuid="00000000-5c9a-7dbd-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNBusinessRelationshipRoles'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNBusinessRelationshipRoles(INT_SILReadAccountResponse $response, Named INT_SILReadPartyResponse $readPartyResponses) : Nothing Begin
   If $response == null Then
      Return null;
   End
   CMN_ClientLifecycleData $clientLifeCycleData := $response.pedrClientLifeCycleData;
   CMN_BusinessRelationship $businessRelationship := $response.businessRelationship;
   CMN_Party $cmnParty;
   Record $cmnPartyRecord;
   String $cmnRole;
   String $partyId;
   CMN_ApplicableRole $role;
   String $useCase;
   If EMPTY($businessRelationship.useCase) Then
      Return null;
   Else
      $useCase := LIST($businessRelationship.useCase, 'COB_UseCases', 'description');
   End
   /******************************** Sort PARTIES ****************************/
   Indexed Record $clonedSilParties := CLONE($response.silParties);
   $response.silParties.clear();
   ForEach $cmnPartyRecord In $clonedSilParties Do
      $partyId := TOSTRING($cmnPartyRecord.getValue('id'));
      If EQUAL($clientLifeCycleData.mainCustomerId, $partyId) Then
         $response.silParties.addElement(1, $cmnPartyRecord);
      Else
         $response.silParties.addElement($cmnPartyRecord);
      End
   End
   /******************************* ADD Roles ************************************************************/
   Indexed String $missingMappingList := NewIndexed(String);
   Indexed String $incorrectMappingList := NewIndexed(String);
   ForEach $cmnPartyRecord In $response.silParties Do
      Try
         $partyId := TOSTRING($cmnPartyRecord.getValue('id'));
         If NotEmpty($partyId) and $readPartyResponses[$partyId] != null and $readPartyResponses[$partyId].party != null Then
            $cmnParty := $readPartyResponses[$partyId].party;
            String $silPartyType := CAST(String, $cmnPartyRecord.getValue('relationshipRole'));
            $cmnRole := LIST($silPartyType, 'CMN_BRRoles', 'id', 'sil_Id');
            If EMPTY($cmnRole) Then
               $missingMappingList.addElement('The mapping for the role ' & $silPartyType & ' was not found for the Customer Type ' & $useCase);
               Continue;
            End
            String $partyType := LIST($cmnParty.type.getTypeId(), 'CMN_PartyTypes', 'description', 'id');
            $role := INT_SILMappingSILtoCMN._createCMNRole($businessRelationship, $cmnRole, $cmnParty.type.getTypeId());
            If $role == null Then
               //$incorrectMappingList.addElement('The Role \"' & $silPartyType & '\" is not valid for a ' & $partyType & ' type (' & $cmnParty.getSILID() & ') for Account ' & $businessRelationship.getSILID());
               Continue;
            End
            //TO BE CHECKED
            $clientLifeCycleData.addParty($cmnParty);
            $cmnParty := $clientLifeCycleData.getPartyById($cmnParty.getSILID());
            // Need to confirm the number is valid since it comes from SIL
            $cmnParty.numberCheckedFromAppway := true;
            //$role := INT_SILMappingSILtoCMN._createCMNRole($businessRelationship, $partyType);
            $businessRelationship.getRoleManager().addRoleForParty($cmnParty, $role);
            $readPartyResponses[$cmnParty.getSILID()].party := $cmnParty;
         End
      Catch
         $response.addServiceStatusFromException($exception);
      End
   End
   If $businessRelationship.useCase == 'individual' && SIZE($businessRelationship.getCustomers()) > 1 Then
      $businessRelationship.useCase := 'joint';
   End
   ForEach String $role In $missingMappingList Do
      $response.addServiceStatusFromMessage($role);
   End
   ForEach String $role In $incorrectMappingList Do
      $response.addServiceStatusFromMessage($role);
   End
   /********************* Check Mandatory Role Missing **************************************************/
   Indexed Action $actions := EVALUATERULE('CMN_ApplicableBRRoles__selector');
   ForEach Action $action In $actions Do
      If $action.params['minParties'] == '1' and not LIB_Validator.validateNotEmptyIndexed($businessRelationship.getRoleManager().getPartiesInRole($action.params['roleID'])) Then
         $response.addServiceStatusFromMessage('Missing mandatory Role \"' & LIST($action.params['roleID'], 'CMN_BRRoles', 'description') & '\" for Account ' & $businessRelationship.getSILID() & ' of type ' & $useCase);
      End
   End
End]]></definition>
        </method>
        <method name="createCMNConnectedPartyNegativeNews" userId="pezzi" uuid="00000000-638c-db6d-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNConnectedPartyNegativeNews'.
  @param $value SIL_INVOLVEDPARTYSCREENINGnegativeMediaScreening.
  @return       CMN_ConnectedPartyNegativeNews.
*/
StaticFunction createCMNConnectedPartyNegativeNews(SIL_INVOLVEDPARTYSCREENINGfinding $silScreeningNegativeMediaScreening) : CMN_ConnectedPartyNegativeNews Begin
   CMN_ConnectedPartyNegativeNews $cmnConnectedPartyNegativeNews := NewObject(CMN_ConnectedPartyNegativeNews);
   $cmnConnectedPartyNegativeNews.eventType := INT_SILMappingSILtoCMN._mapString($cmnConnectedPartyNegativeNews.eventType, LIST($silScreeningNegativeMediaScreening.type, 'CMN_ComplianceEventType', 'id', 'sil_Id'));
   $cmnConnectedPartyNegativeNews.year := INT_SILMappingSILtoCMN._mapInteger($cmnConnectedPartyNegativeNews.year, TOINTEGER($silScreeningNegativeMediaScreening.year));
   $cmnConnectedPartyNegativeNews.comment := INT_SILMappingSILtoCMN._mapString($cmnConnectedPartyNegativeNews.comment, $silScreeningNegativeMediaScreening.description);
   $cmnConnectedPartyNegativeNews.reason := INT_SILMappingSILtoCMN._mapString($cmnConnectedPartyNegativeNews.reason, LIST($silScreeningNegativeMediaScreening.subType, 'CMN_ComplianceReasons', 'id', 'sil_Id'));
   $cmnConnectedPartyNegativeNews.setSILID(INT_SILMappingSILtoCMN._mapString($cmnConnectedPartyNegativeNews.getSILID(), $silScreeningNegativeMediaScreening.id));
   Return $cmnConnectedPartyNegativeNews;
End]]></definition>
        </method>
        <method name="createCMNContact" userId="pezzi" uuid="ffffffff-c056-fc58-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNContact(Indexed SIL_INVOLVEDPARTYaddress $silAddresses, CMN_Party $cmnParty) : CMN_Contact Begin
   CMN_Contact $cmnContact := NewObject(CMN_Contact);
   If (null != $cmnParty.contact) Then
      $cmnContact := $cmnParty.contact;
   End
   Indexed CMN_MailAddress $previousCMNGenericAddresses := NewIndexed(CMN_MailAddress);
   Indexed CMN_MailAddress $previousCMNPreviousAddresses := NewIndexed(CMN_MailAddress);
   Indexed CMN_MailAddress $previousCMNBusinessAddresses := NewIndexed(CMN_MailAddress);
   Indexed CMN_MailAddress $previousCMNMailingAddresses := NewIndexed(CMN_MailAddress);
   Indexed CMN_Email $previousCMNEmailAddresses := NewIndexed(CMN_Email);
   Indexed CMN_Phone $previousCMNTelephone := NewIndexed(CMN_Phone);
   ForEach CMN_MailAddress $cmnMailAddress In $cmnContact.genericAddresses Do
      If NotEmpty($cmnMailAddress.getSILID()) Then
         $previousCMNGenericAddresses.addElement($cmnMailAddress);
         $cmnContact.genericAddresses.removeElement($cmnMailAddress);
      End
   End
   ForEach CMN_MailAddress $cmnMailAddress In $cmnContact.genericAddresses Do
      If NotEmpty($cmnMailAddress.getSILID()) Then
         $previousCMNPreviousAddresses.addElement($cmnMailAddress);
         $cmnContact.genericAddresses.removeElement($cmnMailAddress);
      End
   End
   ForEach CMN_MailAddress $cmnMailAddress In $cmnContact.previousAddresses Do
      If NotEmpty($cmnMailAddress.getSILID()) Then
         $previousCMNBusinessAddresses.addElement($cmnMailAddress);
         $cmnContact.previousAddresses.removeElement($cmnMailAddress);
      End
   End
   ForEach CMN_MailAddress $cmnMailAddress In $cmnContact.businessAddress Do
      If NotEmpty($cmnMailAddress.getSILID()) Then
         $previousCMNMailingAddresses.addElement($cmnMailAddress);
         $cmnContact.businessAddress.removeElement($cmnMailAddress);
      End
   End
   ForEach CMN_MailAddress $cmnMailAddress In $cmnContact.mailingAddresses Do
      If NotEmpty($cmnMailAddress.getSILID()) Then
         $previousCMNMailingAddresses.addElement($cmnMailAddress);
         $cmnContact.mailingAddresses.removeElement($cmnMailAddress);
      End
   End
   ForEach CMN_Email $cmnMailAddress In $cmnContact.email Do
      If NotEmpty($cmnMailAddress.getSILID()) Then
         $previousCMNEmailAddresses.addElement($cmnMailAddress);
         $cmnContact.mailingAddresses.removeElement($cmnMailAddress);
      End
   End
   ForEach CMN_Phone $cmnPhone In $cmnContact.phone Do
      If NotEmpty($cmnPhone.getSILID()) Then
         $previousCMNTelephone.addElement($cmnPhone);
         $cmnContact.phone.removeElement($cmnPhone);
      End
   End
   Try
      If LIB_Validator.validateNotEmptyIndexed($silAddresses) Then
         ForEach SIL_INVOLVEDPARTYaddress $address In $silAddresses Do
            If ISA($address, SIL_INVOLVEDPARTYpostalAddress) Then
               // POSTAL ADDRESS
               SIL_INVOLVEDPARTYpostalAddress $silPostalAddress := CAST(SIL_INVOLVEDPARTYpostalAddress, $address);
               CMN_MailAddress $cmnMailAddress;
               If ($silPostalAddress.validTo != null && DATECOMPARE($silPostalAddress.validTo, NOW()) < 0) or EQUAL($silPostalAddress.type, LIST('previous', 'CMN_AddressTypes__selector', 'code', 'id')) Then
                  ForEach CMN_MailAddress $othercmnMailAddress In $previousCMNPreviousAddresses Do
                     If $othercmnMailAddress.getSILID() == $address.addressId Then
                        $cmnMailAddress := $othercmnMailAddress;
                        Break;
                     End
                  End
               ElseIf EQUAL($silPostalAddress.type, LIST('generic', 'CMN_AddressTypes__selector', 'code', 'id')) Then
                  ForEach CMN_MailAddress $othercmnMailAddress In $previousCMNGenericAddresses Do
                     If $othercmnMailAddress.getSILID() == $address.addressId Then
                        $cmnMailAddress := $othercmnMailAddress;
                        Break;
                     End
                  End
               ElseIf EQUAL($silPostalAddress.type, LIST('business', 'CMN_AddressTypes__selector', 'code', 'id')) Then
                  ForEach CMN_MailAddress $othercmnMailAddress In $previousCMNBusinessAddresses Do
                     If $othercmnMailAddress.getSILID() == $address.addressId Then
                        $cmnMailAddress := $othercmnMailAddress;
                        Break;
                     End
                  End
               ElseIf EQUAL($silPostalAddress.type, LIST('administrative', 'CMN_AddressTypes__selector', 'code', 'id')) Then
                  ForEach CMN_MailAddress $othercmnMailAddress In $previousCMNBusinessAddresses Do
                     If $othercmnMailAddress.getSILID() == $address.addressId Then
                        $cmnMailAddress := $othercmnMailAddress;
                        Break;
                     End
                  End
               ElseIf EQUAL($silPostalAddress.type, LIST('mailing', 'CMN_AddressTypes__selector', 'code', 'id')) Then
                  ForEach CMN_MailAddress $othercmnMailAddress In $previousCMNMailingAddresses Do
                     If $othercmnMailAddress.getSILID() == $address.addressId Then
                        $cmnMailAddress := $othercmnMailAddress;
                        Break;
                     End
                  End
               End
               $cmnMailAddress := INT_SILMappingSILtoCMN.createCMNMailAddressFromSILPostalAddress($cmnMailAddress, $silPostalAddress);
               If ($silPostalAddress.validTo != null && DATECOMPARE($silPostalAddress.validTo, NOW()) < 0) or EQUAL($silPostalAddress.type, LIST('previous', 'CMN_AddressTypes__selector', 'code', 'id')) Then
                  $cmnContact.hasLivedAtCurrMoreThreeYears := true;
                  $cmnContact.previousAddresses.addElement($cmnMailAddress);
               ElseIf EQUAL($silPostalAddress.type, LIST('generic', 'CMN_AddressTypes__selector', 'code', 'id')) Then
                  $cmnContact.genericAddresses.addElement($cmnMailAddress);
               ElseIf EQUAL($silPostalAddress.type, LIST('business', 'CMN_AddressTypes__selector', 'code', 'id')) Then
                  $cmnContact.businessAddress.addElement($cmnMailAddress);
               ElseIf EQUAL($silPostalAddress.type, LIST('administrative', 'CMN_AddressTypes__selector', 'code', 'id')) Then
                  $cmnContact.businessAddress.addElement($cmnMailAddress);
               ElseIf EQUAL($silPostalAddress.type, LIST('mailing', 'CMN_AddressTypes__selector', 'code', 'id')) Then
                  $cmnContact.mailingAddresses.addElement($cmnMailAddress);
               End
               $cmnMailAddress.partyPointer := $cmnParty;
            ElseIf ISA($address, SIL_INVOLVEDPARTYtelephoneNumber) Then
               //descoped
               // PHONE ADDRESS
               SIL_INVOLVEDPARTYtelephoneNumber $silTelephoneNumber := CAST(SIL_INVOLVEDPARTYtelephoneNumber, $address);
               CMN_Phone $cmnPhone := NewObject(CMN_Phone);
               ForEach CMN_Phone $othercmnPhone In $previousCMNTelephone Do
                  If $othercmnPhone.getSILID() == $silTelephoneNumber.addressId Then
                     $cmnPhone := $othercmnPhone;
                     Break;
                  End
               End
               $cmnPhone.setSILID($silTelephoneNumber.addressId);
               If $silTelephoneNumber.country != null && $silTelephoneNumber.country.code != null Then
                  $cmnPhone.country := INT_SILMappingSILtoCMN._mapString($cmnPhone.country, LIST($cmnPhone.country, 'CMN_Countries__selector', 'id', 'sil_Id'));
               End
               $cmnPhone.type := INT_SILMappingSILtoCMN._mapString($cmnPhone.type, LIST($silTelephoneNumber.type, 'CMN_PhoneTypes__selector', 'id', 'sil_Id'));
               $cmnPhone.description := INT_SILMappingSILtoCMN._mapString($cmnPhone.description, $silTelephoneNumber.comment);
               $cmnPhone.extensionNumber := INT_SILMappingSILtoCMN._mapString($cmnPhone.extensionNumber, $silTelephoneNumber.extension);
               $cmnPhone.prefix := INT_SILMappingSILtoCMN._mapString($cmnPhone.prefix, $silTelephoneNumber.prefix);
               $cmnPhone.number := INT_SILMappingSILtoCMN._mapString($cmnPhone.number, $silTelephoneNumber.number);
               $cmnPhone.preferredCallBack := INT_SILMappingSILtoCMN._mapBoolean($cmnPhone.preferredCallBack, $silTelephoneNumber.preferredCallBackIndicator);
               $cmnPhone.isMain := INT_SILMappingSILtoCMN._mapBoolean($cmnPhone.isMain, $silTelephoneNumber.isPrimary);
               $cmnPhone.internationalNumber := INT_SILMappingSILtoCMN._mapString($cmnPhone.internationalNumber, $silTelephoneNumber.internationalNumber);
               $cmnPhone.validFrom := INT_SILMappingSILtoCMN._mapDate($cmnPhone.validFrom, $silTelephoneNumber.validFrom);
               $cmnPhone.validTo := INT_SILMappingSILtoCMN._mapDate($cmnPhone.validTo, $silTelephoneNumber.validTo);
               $cmnContact.phone.addElement($cmnPhone);
            ElseIf ISA($address, SIL_INVOLVEDPARTYemailAddress) Then
               // EMAIL ADDRESS
               SIL_INVOLVEDPARTYemailAddress $silEmailAddress := CAST(SIL_INVOLVEDPARTYemailAddress, $address);
               CMN_Email $cmnEmailAddress := CAST(CMN_Email, NEW(CMN_EmailItemFactory).createNewItemForAddition());
               ForEach CMN_Email $othercmnEmail In $previousCMNEmailAddresses Do
                  If $cmnEmailAddress.getSILID() == $silEmailAddress.addressId Then
                     $cmnEmailAddress := $othercmnEmail;
                     Break;
                  End
               End
               $cmnEmailAddress.setSILID($silEmailAddress.addressId);
               $cmnEmailAddress.address := INT_SILMappingSILtoCMN._mapString($cmnEmailAddress.address, $silEmailAddress.email);
               $cmnEmailAddress.validFrom := INT_SILMappingSILtoCMN._mapDate($cmnEmailAddress.validFrom, $silEmailAddress.validFrom);
               $cmnEmailAddress.validTo := INT_SILMappingSILtoCMN._mapDate($cmnEmailAddress.validTo, $silEmailAddress.validTo);
               $cmnEmailAddress.isMain := INT_SILMappingSILtoCMN._mapBoolean($cmnEmailAddress.isMain, $silEmailAddress.isPrimary);
               INT_SILMappingSILtoCMNVariationFactory__selector().createCMNContactEmail($cmnEmailAddress, $silEmailAddress);
               $cmnContact.email.addElement($cmnEmailAddress);
            ElseIf ISA($address, SIL_INVOLVEDPARTYwebsiteAddress) && ISA($cmnParty, CMN_LegalEntity) Then
               /********************* WebSite *******************/
               CAST(CMN_LegalEntity, $cmnParty).internetWebsiteURL := INT_SILMappingSILtoCMN._mapString(CAST(CMN_LegalEntity, $cmnParty).internetWebsiteURL, CAST(SIL_INVOLVEDPARTYwebsiteAddress, $address).link);
            ElseIf ISA($address, SIL_INVOLVEDPARTYcountryAddress) Then
               SIL_INVOLVEDPARTYcountryAddress $countryAddres := CAST(SIL_INVOLVEDPARTYcountryAddress, $address);
               If $countryAddres.country != null && NotEmpty($countryAddres.country.code) Then
                  If TOSTRING($countryAddres.countryType) == INT_SILEnumerations.getCountryTypeJuridiction() Then
                     If ISA($cmnParty, CMN_LegalEntityTrustFoundation) Then
                        CMN_LegalEntityTrustFoundation $cmnTrust := CAST(CMN_LegalEntityTrustFoundation, $cmnParty);
                        $cmnTrust.applicableLawCountry := $countryAddres.country.code;
                     End
                  End
               End
            End
         End
      Else
         LIB_Logger.integrationError('[INT_SILMapping]: Missing addresses Collection' & $cmnParty.getSILID());
      End
      If (ISA($cmnParty, CMN_LegalEntity) && $cmnParty.contact.genericAddresses.size() == 0) Then
         $cmnParty.contact.genericAddresses[1] := NEW(CMN_MailAddress);
      End
   Catch
      LIB_Logger.integrationError('[INT_SILMapping]: ' & $exception.getMessage());
   End
   Return $cmnContact;
End]]></definition>
        </method>
        <method name="createCMNEstimatedAnnualIncome" userId="pezzi" uuid="ffffffff-8f45-ccfc-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNEstimatedAnnualIncome'.
  @param $amount Amount of this income
  @return      CMN_EstimatedAnnualIncome.
*/
StaticFunction createCMNEstimatedAnnualIncome(SIL_KYCestimatedNetWorthDetails $silOtherWealthDetails) : CMN_EstimatedAnnualIncome Begin
   CMN_EstimatedAnnualIncome $cmnEstimatedAnnualIncome := NewObject(CMN_EstimatedAnnualIncome);
   If $silOtherWealthDetails != null Then
      $cmnEstimatedAnnualIncome.amount := INT_SILMappingSILtoCMN._mapLong($cmnEstimatedAnnualIncome.amount, TOLONG($silOtherWealthDetails.amount / 1000.));
      $cmnEstimatedAnnualIncome.comment := INT_SILMappingSILtoCMN._mapString($cmnEstimatedAnnualIncome.comment, $silOtherWealthDetails.comment);
      $cmnEstimatedAnnualIncome.otherType := INT_SILMappingSILtoCMN._mapString($cmnEstimatedAnnualIncome.otherType, $silOtherWealthDetails.name);
      $cmnEstimatedAnnualIncome.type := INT_SILMappingSILtoCMN._mapString($cmnEstimatedAnnualIncome.type, LIST($silOtherWealthDetails.type, 'CMN_EstimatedAnnualIncome__selector', 'id', 'sil_Id'));
   End
   Return $cmnEstimatedAnnualIncome;
End]]></definition>
        </method>
        <method name="createCMNGreenCardIdentificationDocument" userId="pezzi" uuid="00000000-7eca-3274-0000-000000000000">
            <definition><![CDATA[/**
  Creates an identification document to represent a green card. The object has not all mandatory fields filled.
  @return       Identification Document Object with greencard set to true.
*/
StaticFunction createCMNGreenCardIdentificationDocument() : CMN_IdentificationDocument Begin
   CMN_IdentificationDocument $id := NewObject(CMN_IdentificationDocument);
   $id.greenCard := 'true';
   Return $id;
End]]></definition>
        </method>
        <method name="createCMNHyperLink" userId="pezzi" uuid="00000000-4bc3-f6be-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNHyperLink'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNHyperLink(String $link, String $comment, Date $date := null) : CMN_hyperlink Begin
   CMN_hyperlink $cmnHyperLink := NEW(CMN_hyperlink);
   $cmnHyperLink.hyperlink := $link;
   $cmnHyperLink.description := $comment;
   $cmnHyperLink.inputDate := $date;
   Return $cmnHyperLink;
End]]></definition>
        </method>
        <method name="createCMNIdentificationDocument" userId="pezzi" uuid="ffffffff-ae57-da71-0000-000000000000">
            <definition><![CDATA[/**
  Creates an identification document to represent Identification Document. The object has not all mandatory fields filled.
  @value		SIL_INVOLVEDPARTYdocumentationItem reference
  @return       Identification Document Object .
*/
StaticFunction createCMNIdentificationDocument(SIL_INVOLVEDPARTYdocumentationItem $silDocumentationItem) : CMN_IdentificationDocument Begin
   CMN_IdentificationDocument $id := NewObject(CMN_IdentificationDocument);
   If $silDocumentationItem != null Then
      $id.SILID := $silDocumentationItem.documentId;
      $id.idNumber := INT_SILMappingSILtoCMN._mapString($id.idNumber, $silDocumentationItem.documentNumber);
      $id.isMain := INT_SILMappingSILtoCMN._mapBoolean($id.isMain, $silDocumentationItem.isPrimary);
      $id.idIssuanceDate := INT_SILMappingSILtoCMN._mapDate($id.idIssuanceDate, $silDocumentationItem.issueDate);
      $id.idExpirationDate := INT_SILMappingSILtoCMN._mapDate($id.idExpirationDate, $silDocumentationItem.expiryDate);
      If ISA($silDocumentationItem, SIL_INVOLVEDPARTYidentityAndAddressDocument) Then
         SIL_INVOLVEDPARTYidentityAndAddressDocument $document := CAST(SIL_INVOLVEDPARTYidentityAndAddressDocument, $silDocumentationItem);
         $id.idType := INT_SILMappingSILtoCMN._mapString($id.idType, LIST($silDocumentationItem.documentType, 'CMN_IdentificationTypes__selector', 'id', 'sil_Id'));
         If $document.countryOfIssue != null && $document.countryOfIssue.code != null Then
            $id.idIssuanceCountry := INT_SILMappingSILtoCMN._mapString($id.idIssuanceCountry, $document.countryOfIssue.code);
         End
         If $silDocumentationItem.documentType == '05' Then
            //$id.otherIdentificationType := INT_SILMappingSILtoCMN._mapString($id.otherIdentificationType, $silDocumentationItem.documentName);
         End
         $id.idIssuedBy := INT_SILMappingSILtoCMN._mapString($id.idIssuedBy, $document.issuingAuthorityName);
         $id.idIssuancePlace := INT_SILMappingSILtoCMN._mapString($id.idIssuancePlace, $document.placeOfIssue);
         $id.idIssuanceState := INT_SILMappingSILtoCMN._mapString($id.idIssuanceState, $document.stateOfIssue);
      End
   End
   Return $id;
End]]></definition>
        </method>
        <method name="createCMNKYCLegalAffiliate" userId="cucumazzo" uuid="ffffffff-8ca5-bce1-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNKYCLegalAffiliate'.
  @param $silOrganization SIL_Organization 
  @return       Description of return value.
*/
StaticFunction createCMNKYCLegalAffiliate(SIL_INVOLVEDPARTYorganization $silAffiliate, CMN_KYCLegalAffiliate $cmnKYCLegalAffiliate := null) : CMN_KYCLegalAffiliate Begin
   If $cmnKYCLegalAffiliate == null Then
      $cmnKYCLegalAffiliate := NEW(CMN_KYCLegalAffiliate);
   End
   $cmnKYCLegalAffiliate.businessExposure.clear();
   $cmnKYCLegalAffiliate.countryOfJuridiction.clear();
   $cmnKYCLegalAffiliate.countryOfOperation.clear();
   $cmnKYCLegalAffiliate.setSILID(INT_SILMappingSILtoCMN._mapString($cmnKYCLegalAffiliate.getSILID(), $silAffiliate.id));
   $cmnKYCLegalAffiliate.ownershipRate := INT_SILMappingSILtoCMN._mapInteger($cmnKYCLegalAffiliate.ownershipRate, TOINTEGER($silAffiliate.parentOwnshipRatio));
   $cmnKYCLegalAffiliate.noEmployeeDetails := INT_SILMappingSILtoCMN._mapString($cmnKYCLegalAffiliate.noEmployeeDetails, $silAffiliate.noEmployeeReason);
   If LIB_Validator.validateNotEmptyIndexed($silAffiliate.isParentOrganizationOf) Then
      SIL_INVOLVEDPARTYorganization $silOrganization := $silAffiliate.isParentOrganizationOf[1];
      If LIB_Validator.validateNotEmptyIndexed($silOrganization.businessNatureDetails) Then
         $cmnKYCLegalAffiliate.hasGovernmentContractDeal := INT_SILMappingSILtoCMN._mapBoolean($cmnKYCLegalAffiliate.hasGovernmentContractDeal, $silOrganization.businessNatureDetails[1].isInvolvedInGovernmentContract);
         SIL_INVOLVEDPARTYbusinessCustomer $silBusinessCustomer;
         ForEach $silBusinessCustomer In $silOrganization.businessNatureDetails[1].businessCustomers Do
            If $silBusinessCustomer.isGovernmental Then
               CMN_KycSowJuridictionCountry $cmnKycSowJuridictionCountry := INT_SILMappingSILtoCMN.createCMNKycSowJuridictionCountry($silBusinessCustomer);
               If $cmnKycSowJuridictionCountry != null Then
                  $cmnKYCLegalAffiliate.countryOfJuridiction.addElement($cmnKycSowJuridictionCountry);
               End
            End
         End
      End
      $cmnKYCLegalAffiliate.companyDescription := INT_SILMappingSILtoCMN._mapString($cmnKYCLegalAffiliate.companyDescription, $silOrganization.businessDescription);
      $cmnKYCLegalAffiliate.numberOfEmployees := INT_SILMappingSILtoCMN._mapInteger($cmnKYCLegalAffiliate.numberOfEmployees, $silOrganization.numberOfEmployees);
      INT_SILMatchingTools.matchSILOrganizationToCMNMainBusiness($silOrganization, $cmnKYCLegalAffiliate.mainBusinessActivity);
      SIL_INVOLVEDPARTYinvolvedPartyName $iterate;
      ForEach $iterate In $silOrganization.names Do
         If ISA($iterate, SIL_INVOLVEDPARTYorganizationName) Then
            $cmnKYCLegalAffiliate.name := INT_SILMappingSILtoCMN._mapString($cmnKYCLegalAffiliate.name, CAST(SIL_INVOLVEDPARTYorganizationName, $iterate).businessName);
            Break;
         End
      End
      If LIB_Validator.validateNotEmptyIndexed($silOrganization.addresses) Then
         SIL_INVOLVEDPARTYaddress $silAddress;
         ForEach $silAddress In $silOrganization.addresses Do
            If ISA($silAddress, SIL_INVOLVEDPARTYcountryAddress) Then
               SIL_INVOLVEDPARTYcountryAddress $silCountryAddress := CAST(SIL_INVOLVEDPARTYcountryAddress, $silAddress);
               If $silAddress.type == INT_SILEnumerations.getCountryTypeOperation() Then
                  If $silCountryAddress.country != null && $silCountryAddress.country.code != null Then
                     $cmnKYCLegalAffiliate.countryOfOperation.addElement($silCountryAddress.country.code);
                  End
               ElseIf $silAddress.type == INT_SILEnumerations.getCountryTypeExposure() Then
                  CMN_KycBusinessExposure $businessExposure := NEW(CMN_KycBusinessExposure);
                  $cmnKYCLegalAffiliate.businessExposure.addElement($businessExposure);
                  If $silCountryAddress.country != null && $silCountryAddress.country.code != null Then
                     $businessExposure.businessExposure := $silCountryAddress.country.code;
                  End
               End
            End
         End
      End
   End
   Return $cmnKYCLegalAffiliate;
End]]></definition>
        </method>
        <method name="createCMNKycSowBusinessOwner" userId="cucumazzo" uuid="00000000-46f4-e005-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNKycSowBusinessOwner'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNKycSowBusinessOwner(SIL_SOWbusinessWealthDetails $silBusinessWealthDetail, CMN_KycSowBusinessOwner $cmnKycSowBusinessOwner := null) : CMN_KycSowBusinessOwner Begin
   If $cmnKycSowBusinessOwner == null Then
      $cmnKycSowBusinessOwner := NewObject(CMN_KycSowBusinessOwner);
   End
   $cmnKycSowBusinessOwner.setSILID(INT_SILMappingSILtoCMN._mapString($cmnKycSowBusinessOwner.getSILID(), $silBusinessWealthDetail.id));
   SIL_SOWsowCountry $sowCountry;
   ForEach $sowCountry In $silBusinessWealthDetail.countriesContribution Do
      IF(LIB_Validator.validateNotEmptyIndexed($cmnKycSowBusinessOwner.countriesBusinessExposure), $cmnKycSowBusinessOwner.countriesBusinessExposure := NewIndexed(CMN_KycBusinessExposure));
      If ERROR($sowCountry.country.code != null, false) Then
         CMN_KycBusinessExposure $cmnKycBusinessExposure := NewObject(CMN_KycBusinessExposure);
         $cmnKycBusinessExposure.businessExposure := INT_SILMappingSILtoCMN._mapString($cmnKycBusinessExposure.businessExposure, $sowCountry.country.code);
         $cmnKycSowBusinessOwner.countriesBusinessExposure.addElement($cmnKycBusinessExposure);
      End
   End
   SIL_INVOLVEDPARTYbusinessOwner $silBusinessOwner;
   If $silBusinessWealthDetail.party != null && LIB_Validator.validateNotEmptyIndexed($silBusinessWealthDetail.party.roles) Then
      ForEach SIL_INVOLVEDPARTYinvolvedPartyRole $silRole In $silBusinessWealthDetail.party.roles Do
         If ISA($silRole, SIL_INVOLVEDPARTYbusinessOwner) Then
            $silBusinessOwner := CAST(SIL_INVOLVEDPARTYbusinessOwner, $silRole);
            Break;
         End
      End
   End
   If $silBusinessOwner.percentageOwnership != null Then
      $cmnKycSowBusinessOwner.customerOwnershipInterestRate := INT_SILMappingSILtoCMN._mapInteger($cmnKycSowBusinessOwner.customerOwnershipInterestRate, TOINTEGER($silBusinessOwner.percentageOwnership));
   End
   /*$cmnKycSowBusinessOwner.isEmployeeOfBusiness := INT_SILMappingSILtoCMN._mapBoolean($cmnKycSowBusinessOwner.isEmployeeOfBusiness, $silBusinessOwner.employeeIndicator);
   $cmnKycSowBusinessOwner.positionSince := INT_SILMappingSILtoCMN._mapInteger($cmnKycSowBusinessOwner.positionSince, DATEFIELD($silBusinessOwner.validFrom, 'y'));
   If $silBusinessOwner.validTo != null and $silBusinessOwner.validTo.before(NOW()) Then
      $cmnKycSowBusinessOwner.positionUntil := INT_SILMappingSILtoCMN._mapInteger($cmnKycSowBusinessOwner.positionUntil, DATEFIELD($silBusinessOwner.validTo, 'yyyy'));
   Else
      $cmnKycSowBusinessOwner.isCurrentEmployment := true;
   End*/
   If NotEmpty($silBusinessOwner.ownershipRole) Then
      $cmnKycSowBusinessOwner.professionalTitle := INT_SILMappingSILtoCMN._mapString($cmnKycSowBusinessOwner.professionalTitle, LIST(TOSTRING($silBusinessOwner.ownershipRole), 'SIL_EmploymentRoles', 'cmn_id', 'id'));
   End
   If LIB_Validator.validateNotEmptyIndexed($silBusinessOwner.involvedPartyRelationships) Then
      ForEach SIL_INVOLVEDPARTYinvolvedPartyRelationship $silRelation In $silBusinessOwner.involvedPartyRelationships Do
         If $silRelation.relationshipType == 'TradingPartner' Then
            If ISA($silRelation.party, SIL_INVOLVEDPARTYorganization) Then
               If LIB_Validator.validateNotEmptyIndexed($silRelation.party.addresses) Then
                  ForEach SIL_INVOLVEDPARTYaddress $silAddress In $silRelation.party.addresses Do
                     If ISA($silAddress, SIL_INVOLVEDPARTYcountryAddress) Then
                        SIL_INVOLVEDPARTYcountryAddress $silCountryAddress := CAST(SIL_INVOLVEDPARTYcountryAddress, $silAddress);
                        If TOSTRING($silCountryAddress.countryType) == INT_SILEnumerations.getCountryTypeOperation() && $silCountryAddress.country != null Then
                           $cmnKycSowBusinessOwner.tradingLocation := INT_SILMappingSILtoCMN._mapString($cmnKycSowBusinessOwner.tradingLocation, $silCountryAddress.country.code);
                        End
                     End
                  End
               End
               If LIB_Validator.validateNotEmptyIndexed($silRelation.party.names) Then
                  ForEach SIL_INVOLVEDPARTYinvolvedPartyName $silInvolvedPartyName In $silRelation.party.names Do
                     If ISA($silInvolvedPartyName, SIL_INVOLVEDPARTYorganizationName) Then
                        $cmnKycSowBusinessOwner.tradingPartners := INT_SILMappingSILtoCMN._mapString($cmnKycSowBusinessOwner.tradingPartners, CAST(SIL_INVOLVEDPARTYorganizationName, $silInvolvedPartyName).fullName);
                        Break;
                     End
                  End
               End
            End
         End
      End
   End
   If $silBusinessOwner.inContext != null && ISA($silBusinessOwner.inContext, SIL_INVOLVEDPARTYorganization) Then
      SIL_INVOLVEDPARTYorganization $silOrganization := CAST(SIL_INVOLVEDPARTYorganization, $silBusinessOwner.inContext);
      $cmnKycSowBusinessOwner.companyDescription := INT_SILMappingSILtoCMN._mapString($cmnKycSowBusinessOwner.companyDescription, $silOrganization.businessDescription);
      $cmnKycSowBusinessOwner.employeeNumber := INT_SILMappingSILtoCMN._mapInteger($cmnKycSowBusinessOwner.employeeNumber, $silOrganization.numberOfEmployees);
      $cmnKycSowBusinessOwner.branchesNumber := INT_SILMappingSILtoCMN._mapInteger($cmnKycSowBusinessOwner.branchesNumber, $silOrganization.numberOfBranches);
      $cmnKycSowBusinessOwner.localOfficesNumber := INT_SILMappingSILtoCMN._mapInteger($cmnKycSowBusinessOwner.localOfficesNumber, $silOrganization.numberOfOffices);
      If LIB_Validator.validateNotEmptyIndexed($silOrganization.isParentOrganizationOf) Then
         ForEach SIL_INVOLVEDPARTYorganization $subSilOrganization In $silOrganization.isParentOrganizationOf Do
            $cmnKycSowBusinessOwner.branchesNumber := INT_SILMappingSILtoCMN._sumInteger($cmnKycSowBusinessOwner.branchesNumber, $subSilOrganization.numberOfBranches);
         End
      End
      $cmnKycSowBusinessOwner.totalAnnualGrossRevenues := INT_SILMappingSILtoCMN._mapLong($cmnKycSowBusinessOwner.totalAnnualGrossRevenues, TOLONG($silOrganization.annualTurnOverInUSD));
      $cmnKycSowBusinessOwner.annualAverageProfit := INT_SILMappingSILtoCMN._mapLong($cmnKycSowBusinessOwner.annualAverageProfit, TOLONG($silOrganization.annualProfitInUSD));
      $cmnKycSowBusinessOwner.isPubliclyTradedCompany := INT_SILMappingSILtoCMN._mapBoolean($cmnKycSowBusinessOwner.isPubliclyTradedCompany, $silOrganization.listedStockExchangeIndicator);
      If LIB_Validator.validateNotEmptyIndexed($silOrganization.businessNatureDetails) Then
         SIL_INVOLVEDPARTYbusinessNatureDetails $silBusinessNatureDetails := $silOrganization.businessNatureDetails[1];
         If $silBusinessNatureDetails != null Then
            $cmnKycSowBusinessOwner.isGovernmentContract := INT_SILMappingSILtoCMN._mapBoolean($cmnKycSowBusinessOwner.isGovernmentContract, $silBusinessNatureDetails.isInvolvedInGovernmentContract);
            If LIB_Validator.validateNotEmptyIndexed($silBusinessNatureDetails.businessCustomers) Then
               SIL_INVOLVEDPARTYbusinessCustomer $silBusinessCustomer;
               ForEach $silBusinessCustomer In $silBusinessNatureDetails.businessCustomers Do
                  If ERROR($silBusinessCustomer.country.code != null, false) Then
                     $cmnKycSowBusinessOwner.governmentContractCountry.addElement($silBusinessCustomer.country.code);
                  End
               End
            End
         End
      End
      INT_SILMatchingTools.matchSILOrganizationToCMNMainBusiness($silOrganization, $cmnKycSowBusinessOwner.mainBusiness);
      If LIB_Validator.validateNotEmptyIndexed($silOrganization.names) Then
         ForEach SIL_INVOLVEDPARTYinvolvedPartyName $silInvolvedPartyName In $silOrganization.names Do
            If ISA($silInvolvedPartyName, SIL_INVOLVEDPARTYorganizationName) Then
               $cmnKycSowBusinessOwner.companyName := INT_SILMappingSILtoCMN._mapString($cmnKycSowBusinessOwner.companyName, CAST(SIL_INVOLVEDPARTYorganizationName, $silInvolvedPartyName).businessName);
               Break;
            End
         End
      End
      If LIB_Validator.validateNotEmptyIndexed($silOrganization.addresses) Then
         SIL_INVOLVEDPARTYaddress $silAddress;
         SIL_INVOLVEDPARTYpostalAddress $silPostalAddress;
         SIL_INVOLVEDPARTYcountryAddress $silCountryAddress;
         CMN_KycBusinessExposure $cmnKycBusinessExposure;
         ForEach $silAddress In $silOrganization.addresses Do
            If ISA($silAddress, SIL_INVOLVEDPARTYpostalAddress) Then
               $silPostalAddress := CAST(SIL_INVOLVEDPARTYpostalAddress, $silAddress);
               $cmnKycSowBusinessOwner.companyStreet := INT_SILMappingSILtoCMN._mapString($cmnKycSowBusinessOwner.companyStreet, $silPostalAddress.street);
               $cmnKycSowBusinessOwner.companyCity := INT_SILMappingSILtoCMN._mapString($cmnKycSowBusinessOwner.companyCity, $silPostalAddress.city);
               If $silPostalAddress.country != null Then
                  $cmnKycSowBusinessOwner.companyCountry := INT_SILMappingSILtoCMN._mapString($cmnKycSowBusinessOwner.companyCountry, $silPostalAddress.country.code);
               End
            ElseIf ISA($silAddress, SIL_INVOLVEDPARTYcountryAddress) Then
               $silCountryAddress := CAST(SIL_INVOLVEDPARTYcountryAddress, $silAddress);
               If EQUAL(CAST(String, $silCountryAddress.countryType), INT_SILEnumerations.getCountryTypeExposure()) Then
                  If $silCountryAddress.country != null && $silCountryAddress.country.code != null Then
                     $cmnKycBusinessExposure := NewObject(CMN_KycBusinessExposure);
                     $cmnKycBusinessExposure.businessExposure := $silCountryAddress.country.code;
                     $cmnKycSowBusinessOwner.countriesBusinessExposure.addElement($cmnKycBusinessExposure);
                  End
               End
            End
         End
      End
      If LIB_Validator.validateNotEmptyIndexed($silOrganization.documentationItems) and ISA($silOrganization.documentationItems[1], SIL_INVOLVEDPARTYincorporation) Then
         SIL_INVOLVEDPARTYincorporation $incorporation := CAST(SIL_INVOLVEDPARTYincorporation, $silOrganization.documentationItems[1]);
         $cmnKycSowBusinessOwner.businessStartDate := INT_SILMappingSILtoCMN._mapDate($cmnKycSowBusinessOwner.businessStartDate, $incorporation.incorporateDate);
         $cmnKycSowBusinessOwner.businessEndDate := INT_SILMappingSILtoCMN._mapDate($cmnKycSowBusinessOwner.businessEndDate, $incorporation.incorporateClosedDate);
         If $incorporation.incorporateDate != null and $incorporation.incorporateClosedDate.before(NOW()) Then
            $cmnKycSowBusinessOwner.businessEndDate := INT_SILMappingSILtoCMN._mapDate($cmnKycSowBusinessOwner.businessEndDate, $incorporation.incorporateClosedDate);
         Else
            $cmnKycSowBusinessOwner.businessEndDate := null;
            $cmnKycSowBusinessOwner.isCurrentEmployment := true;
         End
      End
   End
   Return $cmnKycSowBusinessOwner;
End]]></definition>
        </method>
        <method name="createCMNKycSowCountries" userId="cucumazzo" uuid="ffffffff-966c-c8e6-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNKycSowCountries'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNKycSowCountries(SIL_STATICcountry $silCountry, Double $rate, String $comment) : CMN_KycSowCountries Begin
   CMN_KycSowCountries $cmnKycSowCountries := NewObject(CMN_KycSowCountries);
   If $silCountry != null Then
      $cmnKycSowCountries.country := INT_SILMappingSILtoCMN._mapString($cmnKycSowCountries.country, $silCountry.code);
   End
   /*
   If $rate != null Then
      $cmnKycSowCountries.rate := INT_SILMappingSILtoCMN._mapInteger($cmnKycSowCountries.rate, $rate.intValue());
   End
   */
   $cmnKycSowCountries.comment := INT_SILMappingSILtoCMN._mapString($cmnKycSowCountries.comment, $comment);
   Return $cmnKycSowCountries;
End]]></definition>
        </method>
        <method name="createCMNKycSowEmployment" userId="pezzi" uuid="00000000-7de0-3bfa-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNKycSowEmployment'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNKycSowEmployment(SIL_SOWincomeWealthDetails $silIncomeWealthDetail, CMN_KycSowEmployment $cmnKycSowEmployment := null) : CMN_KycSowEmployment Begin
   If $cmnKycSowEmployment == null Then
      $cmnKycSowEmployment := NewObject(CMN_KycSowEmployment);
   End
   $cmnKycSowEmployment.setSILID(INT_SILMappingSILtoCMN._mapString($cmnKycSowEmployment.getSILID(), $silIncomeWealthDetail.id));
   $cmnKycSowEmployment.approximateAverage := INT_SILMappingSILtoCMN._mapLong($cmnKycSowEmployment.approximateAverage, TOINTEGER($silIncomeWealthDetail.netWorthEstimatedAmount));
   SIL_SOWsowCountry $sowCountry;
   ForEach $sowCountry In $silIncomeWealthDetail.countriesContribution Do
      IF(LIB_Validator.validateNotEmptyIndexed($cmnKycSowEmployment.countriesBusinessExposure), $cmnKycSowEmployment.countriesBusinessExposure := NewIndexed(CMN_KycBusinessExposure));
      If ERROR($sowCountry.country.code != null, false) Then
         CMN_KycBusinessExposure $cmnKycBusinessExposure := NewObject(CMN_KycBusinessExposure);
         $cmnKycBusinessExposure.businessExposure := INT_SILMappingSILtoCMN._mapString($cmnKycBusinessExposure.businessExposure, $sowCountry.country.code);
         $cmnKycSowEmployment.countriesBusinessExposure.addElement($cmnKycBusinessExposure);
      End
   End
   //tODO
   SIL_INVOLVEDPARTYemployeeRole $silEmployeeRole;
   If $silIncomeWealthDetail.party != null && LIB_Validator.validateNotEmptyIndexed($silIncomeWealthDetail.party.roles) Then
      ForEach SIL_INVOLVEDPARTYinvolvedPartyRole $silRole In $silIncomeWealthDetail.party.roles Do
         If ISA($silRole, SIL_INVOLVEDPARTYemployeeRole) Then
            $silEmployeeRole := CAST(SIL_INVOLVEDPARTYemployeeRole, $silRole);
            Break;
         End
      End
   End
   If $silEmployeeRole != null Then
      $cmnKycSowEmployment.employmentStatus := INT_SILMappingSILtoCMN._mapString($cmnKycSowEmployment.employmentStatus, LIST(TOSTRING($silEmployeeRole.employmentStatus), 'SIL_EmploymentStatus', 'cmn_id', 'id'));
      If NotEmpty(TOSTRING($silEmployeeRole.employmentRole)) Then
         $cmnKycSowEmployment.professionalTitle := INT_SILMappingSILtoCMN._mapString($cmnKycSowEmployment.professionalTitle, LIST(TOSTRING($silEmployeeRole.employmentRole), 'SIL_EmploymentRoles', 'cmn_id', 'id'));
      End
      $cmnKycSowEmployment.position := INT_SILMappingSILtoCMN_v2._mapString($cmnKycSowEmployment.position, LIST($silEmployeeRole.positionTitle, 'COB_KycEmploymentPositionTitle', 'id', 'sil_Id'));
      $cmnKycSowEmployment.positionSince := INT_SILMappingSILtoCMN._mapDate($cmnKycSowEmployment.positionSince, $silEmployeeRole.validFrom);
      If $silEmployeeRole.validTo != null and $silEmployeeRole.validTo.before(NOW()) Then
         $cmnKycSowEmployment.positionUntil := INT_SILMappingSILtoCMN._mapDate($cmnKycSowEmployment.positionUntil, $silEmployeeRole.validTo);
      Else
         $cmnKycSowEmployment.positionUntil := null;
         $cmnKycSowEmployment.isCurrentEmployment := true;
      End
      /******************** Employed By**************************/
      If $silEmployeeRole.inContext != null && ISA($silEmployeeRole.inContext, SIL_INVOLVEDPARTYorganization) Then
         SIL_INVOLVEDPARTYorganization $silOrganization := CAST(SIL_INVOLVEDPARTYorganization, $silEmployeeRole.inContext);
         INT_SILMatchingTools.matchSILOrganizationToCMNMainBusiness($silOrganization, $cmnKycSowEmployment.mainBusiness);
         $cmnKycSowEmployment.employerBusinessDescription := INT_SILMappingSILtoCMN._mapString($cmnKycSowEmployment.employerBusinessDescription, $silOrganization.businessDescription);
         If LIB_Validator.validateNotEmptyIndexed($silOrganization.businessNatureDetails) Then
            SIL_INVOLVEDPARTYbusinessNatureDetails $businessNatureDetails := $silOrganization.businessNatureDetails[1];
            If $businessNatureDetails != null Then
               $cmnKycSowEmployment.isGovContractLicense := INT_SILMappingSILtoCMN._mapBoolean($cmnKycSowEmployment.isGovContractLicense, $businessNatureDetails.isInvolvedInGovernmentContract);
               If LIB_Validator.validateNotEmptyIndexed($businessNatureDetails.businessCustomers) Then
                  SIL_INVOLVEDPARTYbusinessCustomer $customer;
                  ForEach $customer In $businessNatureDetails.businessCustomers Do
                     If $customer.isGovernmental && ERROR($customer.country.code != null, false) Then
                        $cmnKycSowEmployment.revenuesCountries.addElement($customer.country.code);
                     End
                  End
               End
            End
         End
         /***** Employer Name ******/
         If LIB_Validator.validateNotEmptyIndexed($silOrganization.names) and ISA($silOrganization.names[1], SIL_INVOLVEDPARTYorganizationName) Then
            $cmnKycSowEmployment.employerName := INT_SILMappingSILtoCMN._mapString($cmnKycSowEmployment.employerName, CAST(SIL_INVOLVEDPARTYorganizationName, $silOrganization.names[1]).businessName);
         End
         /***** Employer addresses******/
         If LIB_Validator.validateNotEmptyIndexed($silOrganization.addresses) Then
            SIL_INVOLVEDPARTYaddress $silAddress;
            ForEach $silAddress In $silOrganization.addresses Do
               If ISA($silAddress, SIL_INVOLVEDPARTYpostalAddress) Then
                  SIL_INVOLVEDPARTYpostalAddress $postalAddress := CAST(SIL_INVOLVEDPARTYpostalAddress, $silAddress);
                  $cmnKycSowEmployment.employerStreet := INT_SILMappingSILtoCMN._mapString($cmnKycSowEmployment.employerStreet, $postalAddress.street);
                  $cmnKycSowEmployment.employerCity := INT_SILMappingSILtoCMN._mapString($cmnKycSowEmployment.employerCity, $postalAddress.city);
                  If $postalAddress.country != null && $postalAddress.country.code != null Then
                     $cmnKycSowEmployment.employerCountry := INT_SILMappingSILtoCMN._mapString($cmnKycSowEmployment.employerCountry, $postalAddress.country.code);
                  End
               End
            End
         End
      End
   End
   Return $cmnKycSowEmployment;
End]]></definition>
        </method>
        <method name="createCMNKycSOWFamilyRelationsRoyalty" userId="cucumazzo" uuid="ffffffff-d58a-6c67-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNKycSOWFamilyRelationsRoyalty'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNKycSOWFamilyRelationsRoyalty(SIL_SOWfamilyWealthDetails $silFamilyWealthDetails, CMN_KycSowFamilyRelationsRoyalty $cmnSowFamilyRelationsRoyalty := null) : CMN_KycSowFamilyRelationsRoyalty Begin
   If $cmnSowFamilyRelationsRoyalty == null Then
      $cmnSowFamilyRelationsRoyalty := NewObject(CMN_KycSowFamilyRelationsRoyalty);
   End
   $cmnSowFamilyRelationsRoyalty.setSILID(INT_SILMappingSILtoCMN._mapString($cmnSowFamilyRelationsRoyalty.getSILID(), $silFamilyWealthDetails.id));
   $cmnSowFamilyRelationsRoyalty.originalWealthDescription := INT_SILMappingSILtoCMN._mapString($cmnSowFamilyRelationsRoyalty.originalWealthDescription, $silFamilyWealthDetails.originalWealthDescription);
   $cmnSowFamilyRelationsRoyalty.estimatedValue := INT_SILMappingSILtoCMN._mapLong($cmnSowFamilyRelationsRoyalty.estimatedValue, TOLONG($silFamilyWealthDetails.netWorthEstimatedAmount));
   $cmnSowFamilyRelationsRoyalty.originAndProvenanceSow := INT_SILMappingSILtoCMN._mapString($cmnSowFamilyRelationsRoyalty.originAndProvenanceSow, $silFamilyWealthDetails.originAndProvenance);
   $cmnSowFamilyRelationsRoyalty.countriesBusinessExposure.clear();
   If LIB_Validator.validateNotEmptyIndexed($silFamilyWealthDetails.countriesContribution) Then
      SIL_SOWsowCountry $silCountry;
      ForEach $silCountry In $silFamilyWealthDetails.countriesContribution Do
         CMN_KycBusinessExposure $cmnKycBusinessExposure := NEW(CMN_KycBusinessExposure);
         If $silCountry.country != null && NotEmpty($silCountry.country.code) Then
            $cmnKycBusinessExposure.businessExposure := $silCountry.country.code;
         End
         If $cmnKycBusinessExposure.comments != null Then
            $cmnKycBusinessExposure.comments := $silCountry.comment;
         End
         $cmnSowFamilyRelationsRoyalty.countriesBusinessExposure.addElement($cmnKycBusinessExposure);
      End
   End
   If LIB_Validator.validateNotEmptyIndexed($silFamilyWealthDetails.verificationDocuments) Then
      ForEach SIL_CMSdocument $silDocument In $silFamilyWealthDetails.verificationDocuments Do
         CMN_hyperlink $cmnLink := INT_SILMappingSILtoCMN.createCMNHyperLink($silDocument.link, $silDocument.comment);
         $cmnSowFamilyRelationsRoyalty.evidences.addElement($cmnLink);
      End
   End
   Return $cmnSowFamilyRelationsRoyalty;
End]]></definition>
        </method>
        <method name="createCMNKycSOWInheritanceDonation" userId="cucumazzo" uuid="00000000-4409-fa2e-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNKycSOWInheritanceDonation'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNKycSOWInheritanceDonation(SIL_SOWinheritanceWealthDetails $silInheritanceWealthDetails, CMN_KycSowInheritanceDonation $cmnkycSowInheritanceDonation := null) : CMN_KycSowInheritanceDonation Begin
   If $cmnkycSowInheritanceDonation == null Then
      $cmnkycSowInheritanceDonation := NewObject(CMN_KycSowInheritanceDonation);
   End
   $cmnkycSowInheritanceDonation.setSILID(INT_SILMappingSILtoCMN._mapString($cmnkycSowInheritanceDonation.getSILID(), $silInheritanceWealthDetails.id));
   If LIB_Validator.validateNotEmptyIndexed($silInheritanceWealthDetails.contributors) Then
   End
   SIL_SOWsowContributor $silSOWContributor := $silInheritanceWealthDetails.contributors[1];
   If $silInheritanceWealthDetails.contributors[1].contributor != null && LIB_Validator.validateNotEmptyIndexed($silInheritanceWealthDetails.contributors[1].contributor.names) Then
      If ISA($silInheritanceWealthDetails.contributors[1].contributor.names[1], SIL_INVOLVEDPARTYindividualName) Then
         SIL_INVOLVEDPARTYindividualName $silContributorIndividualName := CAST(SIL_INVOLVEDPARTYindividualName, $silInheritanceWealthDetails.contributors[1].contributor.names[1]);
         $cmnkycSowInheritanceDonation.lastName := INT_SILMappingSILtoCMN._mapString($cmnkycSowInheritanceDonation.lastName, $silContributorIndividualName.lastName);
         $cmnkycSowInheritanceDonation.firstName := INT_SILMappingSILtoCMN._mapString($cmnkycSowInheritanceDonation.firstName, $silContributorIndividualName.firstName);
      End
   End
   $cmnkycSowInheritanceDonation.relationshipType := INT_SILMappingSILtoCMN._mapString($cmnkycSowInheritanceDonation.relationshipType, $silInheritanceWealthDetails.relationshipWithDonator);
   $cmnkycSowInheritanceDonation.originalWealthDescription := INT_SILMappingSILtoCMN._mapString($cmnkycSowInheritanceDonation.originalWealthDescription, $silInheritanceWealthDetails.originalWealthDescription);
   $cmnkycSowInheritanceDonation.receivedDate := INT_SILMappingSILtoCMN._mapDate($cmnkycSowInheritanceDonation.receivedDate, $silInheritanceWealthDetails.dateOfInheritance);
   $cmnkycSowInheritanceDonation.totalValue := INT_SILMappingSILtoCMN._mapLong($cmnkycSowInheritanceDonation.totalValue, TOLONG($silInheritanceWealthDetails.netWorthEstimatedAmount));
   $cmnkycSowInheritanceDonation.assetType := INT_SILMappingSILtoCMN._mapString($cmnkycSowInheritanceDonation.assetType, $silInheritanceWealthDetails.typeOfAssetDonated);
   $cmnkycSowInheritanceDonation.countriesBusinessExposure.clear();
   If LIB_Validator.validateNotEmptyIndexed($silInheritanceWealthDetails.countriesContribution) Then
      SIL_SOWsowCountry $silCountry;
      ForEach $silCountry In $silInheritanceWealthDetails.countriesContribution Do
         CMN_KycBusinessExposure $cmnKycBusinessExposure := NEW(CMN_KycBusinessExposure);
         If $silCountry.country != null && NotEmpty($silCountry.country.code) Then
            $cmnKycBusinessExposure.businessExposure := $silCountry.country.code;
         End
         If $cmnKycBusinessExposure.comments != null Then
            $cmnKycBusinessExposure.comments := $silCountry.comment;
         End
         $cmnkycSowInheritanceDonation.countriesBusinessExposure.addElement($cmnKycBusinessExposure);
      End
   End
   If LIB_Validator.validateNotEmptyIndexed($silInheritanceWealthDetails.verificationDocuments) Then
      ForEach SIL_CMSdocument $silDocument In $silInheritanceWealthDetails.verificationDocuments Do
         CMN_hyperlink $cmnLink := INT_SILMappingSILtoCMN.createCMNHyperLink($silDocument.link, $silDocument.comment);
         $cmnkycSowInheritanceDonation.evidences.addElement($cmnLink);
      End
   End
   Return $cmnkycSowInheritanceDonation;
End]]></definition>
        </method>
        <method name="createCMNKycSowJuridictionCountry" userId="cucumazzo" uuid="ffffffff-a40d-41f4-0000-000000000000">
            <definition><![CDATA[/**
Description of function 'createCMNKycSowJuridictionCountry'.
@param $value Description of parameter '$value'.
@return       Description of return value.
*/
StaticFunction createCMNKycSowJuridictionCountry(SIL_INVOLVEDPARTYbusinessCustomer $silBusinessCustomer) : CMN_KycSowJuridictionCountry Begin
   CMN_KycSowJuridictionCountry $cmnKycSowJuridictionCountry := NEW(CMN_KycSowJuridictionCountry);
   If $silBusinessCustomer.country != null and $silBusinessCustomer.country.code != null Then
      $cmnKycSowJuridictionCountry.countryOfJuridiction := INT_SILMappingSILtoCMN._mapString($cmnKycSowJuridictionCountry.countryOfJuridiction, $silBusinessCustomer.country.code);
   End
   $cmnKycSowJuridictionCountry.comments := INT_SILMappingSILtoCMN._mapString($cmnKycSowJuridictionCountry.comments, $silBusinessCustomer.relationshipDescription);
   Return $cmnKycSowJuridictionCountry;
End]]></definition>
        </method>
        <method name="createCMNKycSOWOthers" userId="cucumazzo" uuid="00000000-1223-2e71-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNKycSOWOthers'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNKycSOWOthers(SIL_SOWotherWealthDetails $silOtherWealthDetails, CMN_KycSowOthers $cmnSowOthers := null) : CMN_KycSowOthers Begin
   If $cmnSowOthers == null Then
      $cmnSowOthers := NewObject(CMN_KycSowOthers);
   End
   $cmnSowOthers.setSILID(INT_SILMappingSILtoCMN._mapString($cmnSowOthers.getSILID(), $silOtherWealthDetails.id));
   $cmnSowOthers.dateReceived := INT_SILMappingSILtoCMN._mapDate($cmnSowOthers.dateReceived, $silOtherWealthDetails.dateReceived);
   $cmnSowOthers.originalWealthDescription := INT_SILMappingSILtoCMN._mapString($cmnSowOthers.originalWealthDescription, $silOtherWealthDetails.originalWealthDescription);
   $cmnSowOthers.originAndProvenanceSow := INT_SILMappingSILtoCMN._mapString($cmnSowOthers.originAndProvenanceSow, $silOtherWealthDetails.originAndProvenance);
   $cmnSowOthers.estimatedValue := INT_SILMappingSILtoCMN._mapLong($cmnSowOthers.estimatedValue, TOLONG($silOtherWealthDetails.netWorthEstimatedAmount));
   $cmnSowOthers.originAndProvenanceSow := INT_SILMappingSILtoCMN._mapString($cmnSowOthers.originAndProvenanceSow, $silOtherWealthDetails.originAndProvenance);
   $cmnSowOthers.countriesBusinessExposure.clear();
   If LIB_Validator.validateNotEmptyIndexed($silOtherWealthDetails.countriesContribution) Then
      SIL_SOWsowCountry $silCountry;
      ForEach $silCountry In $silOtherWealthDetails.countriesContribution Do
         CMN_KycBusinessExposure $cmnKycBusinessExposure := NEW(CMN_KycBusinessExposure);
         If $silCountry.country != null && NotEmpty($silCountry.country.code) Then
            $cmnKycBusinessExposure.businessExposure := $silCountry.country.code;
         End
         If $cmnKycBusinessExposure.comments != null Then
            $cmnKycBusinessExposure.comments := $silCountry.comment;
         End
         $cmnSowOthers.countriesBusinessExposure.addElement($cmnKycBusinessExposure);
      End
   End
   If LIB_Validator.validateNotEmptyIndexed($silOtherWealthDetails.verificationDocuments) Then
      ForEach SIL_CMSdocument $silDocument In $silOtherWealthDetails.verificationDocuments Do
         CMN_hyperlink $cmnLink := INT_SILMappingSILtoCMN.createCMNHyperLink($silDocument.link, $silDocument.comment);
         $cmnSowOthers.evidences.addElement($cmnLink);
      End
   End
   Return $cmnSowOthers;
End]]></definition>
        </method>
        <method name="createCMNKYTSourceOfFund" userId="pezzi" uuid="00000000-4e52-8d55-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNKYTSourceOfFund'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNKYTSourceOfFund(SIL_ORDERtransfer $silOrderTransfer, CMN_KYTSourceOfFund $cmnSourceOfFund) : CMN_KYTSourceOfFund Begin
   If $cmnSourceOfFund == null Then
      $cmnSourceOfFund := NewObject(CMN_KYTSourceOfFund, '');
   End
   $cmnSourceOfFund.setSILID(INT_SILMappingSILtoCMN._mapString($cmnSourceOfFund.getSILID(), TOSTRING($silOrderTransfer.id)));
   $cmnSourceOfFund.expectedAmount := INT_SILMappingSILtoCMN._mapDouble($cmnSourceOfFund.expectedAmount, $silOrderTransfer.amount);
   If $silOrderTransfer.debtorRole != null Then
      $cmnSourceOfFund.orderingParty := INT_SILMatchingTools.matchSILDebtorRoleTypeToCMNDebtorRoleType($silOrderTransfer.debtorRole);
      If $cmnSourceOfFund.orderingParty == 'thirdParty' and LIB_Validator.validateNotEmptyIndexed($silOrderTransfer.debtorRole.party.names) Then
         $cmnSourceOfFund.thirdPartyName := INT_SILMappingSILtoCMN._mapString($cmnSourceOfFund.thirdPartyName, $silOrderTransfer.debtorRole.party.names[1].fullName);
      End
   End
   If $silOrderTransfer.debtorBank != null Then
      $cmnSourceOfFund.bank := INT_SILMappingSILtoCMN._mapString($cmnSourceOfFund.bank, LIST(TOSTRING($silOrderTransfer.debtorBank.type), 'SIL_KYTBank', 'id', 'sil_id'));
      If LIB_Validator.validateNotEmptyIndexed($silOrderTransfer.debtorBank.names) && ISA($silOrderTransfer.debtorBank.names[1], SIL_INVOLVEDPARTYorganizationName) Then
         $cmnSourceOfFund.bankName := CAST(SIL_INVOLVEDPARTYorganizationName, $silOrderTransfer.debtorBank.names[1]).businessName;
      ElseIf LIB_Validator.validateNotEmptyIndexed($silOrderTransfer.debtorBank.names) Then
         $cmnSourceOfFund.entity := LIST($silOrderTransfer.debtorBank.names[1].fullName, 'CMN_HSBCEntities__selector', 'id', 'description');
      End
   End
   If $silOrderTransfer.subAccountSell != null Then
      $cmnSourceOfFund.accountNumber := INT_SILMappingSILtoCMN._mapString($cmnSourceOfFund.accountNumber, $silOrderTransfer.subAccountSell.id);
   End
   If $silOrderTransfer.originOfFundsCountry != null Then
      $cmnSourceOfFund.country := INT_SILMappingSILtoCMN._mapString($cmnSourceOfFund.country, $silOrderTransfer.originOfFundsCountry.code);
   End
   $cmnSourceOfFund.type := INT_SILMappingSILtoCMN._mapString($cmnSourceOfFund.type, $silOrderTransfer.type);
   Return $cmnSourceOfFund;
End]]></definition>
        </method>
        <method name="createCMNLegalEntity" userId="pezzi" uuid="ffffffff-897c-8034-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNLegalEntity'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNLegalEntity(CMN_Party $cmnParty, SIL_INVOLVEDPARTYorganization $silOrganization) : CMN_LegalEntity Begin
   CMN_LegalEntity $cmnLegalEntity;
   /******************** SELECT USE CASE **********************/
   If $cmnParty == null or not $cmnParty.type.isLegalEntity() Then
      If $silOrganization != null && (EQUAL($silOrganization.entityType, 'PRIVATE_HOLDING_TRUST') or ISA($silOrganization, SIL_INVOLVEDPARTYtrust)) Then
         $cmnLegalEntity := CAST(CMN_LegalEntityTrustFoundation, CMN_Party.createPartyOfType(CMN_PartyType.typeTrust()));
      ElseIf $silOrganization != null && EQUAL($silOrganization.entityType, 'PRIVATE_INVESTMENT_COMPANY') or (LIB_Validator.validateNotEmptyIndexed($silOrganization.businessTypes) and EQUAL($silOrganization.businessTypes[1], '2')) Then
         $cmnLegalEntity := CAST(CMN_LegalEntity, CMN_Party.createPartyOfType(CMN_PartyType.typePrivateInvestmentCompany()));
      ElseIf $silOrganization != null && EQUAL($silOrganization.entityType, 'COMMERCIAL_BUSINESS') or (LIB_Validator.validateNotEmptyIndexed($silOrganization.businessTypes) and EQUAL($silOrganization.businessTypes[1], '1')) Then
         $cmnLegalEntity := CAST(CMN_LegalEntity, CMN_Party.createPartyOfType(CMN_PartyType.typeCommercialOperatingBusiness()));
      ElseIf $silOrganization != null && LIB_Validator.validateNotEmptyIndexed($silOrganization.businessTypes) and EQUAL($silOrganization.businessTypes[1], 'BANK') Then
         $cmnLegalEntity := CAST(CMN_LegalEntity, CMN_Party.createPartyOfType(CMN_PartyType.typeHSBCEntity()));
      Else
         LIB_Logger.integrationError('[INT_SILMappingSILtoCMN]: SilOrganization is null');
         Return null;
      End
   Else
      $cmnLegalEntity := CAST(CMN_LegalEntity, $cmnParty);
   End
   /********************* MAP NAMES *************************/
   If LIB_Validator.validateNotEmptyIndexed($silOrganization.names) Then
      ForEach SIL_INVOLVEDPARTYinvolvedPartyName $name In $silOrganization.names Do
         Try
            If not ISA($name, SIL_INVOLVEDPARTYorganizationName) and not ISA($name, SIL_INVOLVEDPARTYtrustName) Then
               LIB_Logger.integrationError('Wrong name type for Organization: ' & TOSTRING($name));
            End
            $cmnLegalEntity.companyName := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.companyName, IF(ISA($silOrganization, SIL_INVOLVEDPARTYtrust), CAST(SIL_INVOLVEDPARTYtrustName, $name).name, CAST(SIL_INVOLVEDPARTYorganizationName, $name).businessName));
            $cmnLegalEntity.tradingName := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.tradingName, IF(ISA($silOrganization, SIL_INVOLVEDPARTYtrust), CAST(SIL_INVOLVEDPARTYtrustName, $name).name, CAST(SIL_INVOLVEDPARTYorganizationName, $name).tradingName));
         Catch
            LIB_Logger.integrationError('[INT_SILMapping]: ' & $exception.getMessage());
         End
      End
   End
   /********************* GENERAL FIELDS *******************/
   $cmnLegalEntity.SILID := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.SILID, $silOrganization.id);
   If LIB_Validator.validateNotEmptyIndexed($silOrganization.documentationItems) and ISA($silOrganization.documentationItems[1], SIL_INVOLVEDPARTYIncorporation) Then
      SIL_INVOLVEDPARTYIncorporation $incorporation := CAST(SIL_INVOLVEDPARTYIncorporation, $silOrganization.documentationItems[1]);
      IF($incorporation.incorporateDate != null, $cmnLegalEntity.dateOfRegistration := INT_SILMappingSILtoCMN._mapDate($cmnLegalEntity.dateOfRegistration, $incorporation.incorporateDate));
      IF($incorporation.documentNumber != null, $cmnLegalEntity.registrationNumber := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.registrationNumber, $incorporation.documentNumber));
      IF($incorporation.issuingAuthorityName != null, $cmnLegalEntity.incorporationIssuingAuthority := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.incorporationIssuingAuthority, $incorporation.issuingAuthorityName));
   End
   If LIB_Validator.validateNotEmptyIndexed($silOrganization.businessNatureDetails) Then
      $cmnLegalEntity.kycProfile.screening.hasInfluence := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.kycProfile.screening.hasInfluence, $silOrganization.businessNatureDetails[1].isInvolvedInGovernmentContract);
   End
   If ISA($silOrganization, SIL_INVOLVEDPARTYtrust) && ISA($cmnLegalEntity, CMN_LegalEntityTrustFoundation) Then
      CMN_LegalEntityTrustFoundation $cmnTrust := CAST(CMN_LegalEntityTrustFoundation, $cmnLegalEntity);
      $cmnTrust.revocability := INT_SILMappingSILtoCMN._mapString($cmnTrust.revocability, LIST(TOSTRING(CAST(SIL_INVOLVEDPARTYtrust, $silOrganization).revocableIndicator), 'CMN_TrustFoundationRevocability', 'id', 'sil_Id'));
      $cmnTrust.irrevocabilityType := INT_SILMappingSILtoCMN._mapString($cmnTrust.irrevocabilityType, LIST(CAST(SIL_INVOLVEDPARTYtrust, $silOrganization).irrevocableType, 'CMN_TrustFoundationIrrevocabilityType', 'id', 'sil_Id'));
      $cmnTrust.futureDateTrustDissolution := INT_SILMappingSILtoCMN._mapDate($cmnTrust.futureDateTrustDissolution, CAST(SIL_INVOLVEDPARTYtrust, $silOrganization).dissolutionDate);
      $cmnTrust.classOfBeneficiary := INT_SILMappingSILtoCMN._mapString($cmnTrust.classOfBeneficiary, CAST(SIL_INVOLVEDPARTYtrust, $silOrganization).classOfBeneficiaries);
   End
   $cmnLegalEntity.dateOfBoardOfDirectors := INT_SILMappingSILtoCMN._mapDate($cmnLegalEntity.dateOfBoardOfDirectors, $silOrganization.boardOfDirectorsDate);
   /**** COMMERCIAL BASIC KYC ****/
   $cmnLegalEntity.structureDetails.financialInstitution.isPartyListedStockExchange := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.financialInstitution.isPartyListedStockExchange, $silOrganization.listedStockExchangeIndicator);
   $cmnLegalEntity.structureDetails.financialInstitution.nameStockExchange := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.financialInstitution.nameStockExchange, $silOrganization.stockExchangeCode);
   $cmnLegalEntity.structureDetails.financialInstitution.hasApprovedEquityExchange := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.financialInstitution.hasApprovedEquityExchange, $silOrganization.stockExchangeApprovalIndicator);
   $cmnLegalEntity.structureDetails.nameExchangeParent := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.nameExchangeParent, $silOrganization.stockExchangeCode);
   $cmnLegalEntity.kycProfile.screening.hasComplexUnusualStructure := INT_SILMappingSILtoCMN._mapBoolean($cmnParty.kycProfile.screening.hasComplexUnusualStructure, $silOrganization.isComplexStructure);
   INT_SILMatchingTools.matchSILOrganizationToCMNMainBusiness($silOrganization, $cmnLegalEntity.getKYCProfile().sourceOfWealth.mainBusiness);
   /********** NBCE ***************/
   INT_SILMappingSILtoCMNVariationFactory__selector().createCMNLegalEntity($silOrganization, $cmnLegalEntity);
   /********************* RETURN ****************************/
   Return $cmnLegalEntity;
End]]></definition>
        </method>
        <method name="createCMNMailAddressFromSILPostalAddress" userId="pezzi" uuid="00000000-192d-1d52-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNMailAddressFromSILPostalAddress'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNMailAddressFromSILPostalAddress(CMN_MailAddress $cmnMailAddress, SIL_INVOLVEDPARTYpostalAddress $silPostalAddress) : CMN_MailAddress Begin
   If $cmnMailAddress == null Then
      $cmnMailAddress := NEW(CMN_MailAddress);
   End
   $cmnMailAddress.setSILID($silPostalAddress.addressId);
   $cmnMailAddress.co := INT_SILMappingSILtoCMN._mapString($cmnMailAddress.co, $silPostalAddress.co);
   $cmnMailAddress.street := INT_SILMappingSILtoCMN._mapString($cmnMailAddress.street, $silPostalAddress.street);
   $cmnMailAddress.streetNumber := INT_SILMappingSILtoCMN._mapString($cmnMailAddress.streetNumber, $silPostalAddress.streetNumber);
   $cmnMailAddress.zip := INT_SILMappingSILtoCMN._mapString($cmnMailAddress.zip, $silPostalAddress.zipcode);
   $cmnMailAddress.city := INT_SILMappingSILtoCMN._mapString($cmnMailAddress.city, $silPostalAddress.city);
   $cmnMailAddress.district := INT_SILMappingSILtoCMN._mapString($cmnMailAddress.district, $silPostalAddress.district);
   $cmnMailAddress.building := INT_SILMappingSILtoCMN._mapString($cmnMailAddress.building, $silPostalAddress.building);
   $cmnMailAddress.complementCity := INT_SILMappingSILtoCMN._mapString($cmnMailAddress.complementCity, $silPostalAddress.state);
   If $silPostalAddress.country != null && $silPostalAddress.country.code != null Then
      $cmnMailAddress.country := INT_SILMappingSILtoCMN._mapString($cmnMailAddress.country, $silPostalAddress.country.code);
   End
   $cmnMailAddress.validFrom := INT_SILMappingSILtoCMN._mapDate($cmnMailAddress.validFrom, $silPostalAddress.validFrom);
   $cmnMailAddress.validTo := INT_SILMappingSILtoCMN._mapDate($cmnMailAddress.validTo, $silPostalAddress.validTo);
   $cmnMailAddress.poBox := INT_SILMappingSILtoCMN._mapString($cmnMailAddress.poBox, $silPostalAddress.poBox);
   $cmnMailAddress.isMain := INT_SILMappingSILtoCMN._mapBoolean($cmnMailAddress.isMain, $silPostalAddress.isPrimary);
   Return $cmnMailAddress;
End]]></definition>
        </method>
        <method name="createCMNNetWorthItem" userId="pezzi" uuid="ffffffff-e026-966c-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNNetWorthItem'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNNetWorthItem(SIL_SOWindividualSourceOfWealth $silIndividualSourceOfWealth) : CMN_NetWorthItem Begin
   CMN_NetWorthItem $cmnNetWorthItem := NewObject(CMN_NetWorthItem);
   Double $amount;
   If ISA($silIndividualSourceOfWealth, SIL_SOWbusinessWealthDetails) Then
      $amount := CAST(SIL_SOWbusinessWealthDetails, $silIndividualSourceOfWealth).businessInterests;
   ElseIf ISA($silIndividualSourceOfWealth, SIL_SOWinvestmentsWealthDetails) Then
      $amount := CAST(SIL_SOWinvestmentsWealthDetails, $silIndividualSourceOfWealth).netWorthEstimatedAmount;
   ElseIf ISA($silIndividualSourceOfWealth, SIL_SOWrealEstateWealthDetails) Then
      $amount := CAST(SIL_SOWrealEstateWealthDetails, $silIndividualSourceOfWealth).netWorthEstimatedAmount;
   ElseIf ISA($silIndividualSourceOfWealth, SIL_SOWotherWealthDetails) Then
      $amount := CAST(SIL_SOWotherWealthDetails, $silIndividualSourceOfWealth).netWorthEstimatedAmount;
   End
   $cmnNetWorthItem.amount := INT_Mapping._mapLong($cmnNetWorthItem.amount, $amount.longValue());
   Return $cmnNetWorthItem;
End]]></definition>
        </method>
        <method name="createCMNPartyFromCMNBusinessRelationship" userId="pezzi" uuid="ffffffff-fc35-9674-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNPartyFromCMNBusinessRelationship'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNPartyFromCMNBusinessRelationship(CMN_Party $cmnparty, CMN_BusinessRelationship $cmnBusinessRelations) : CMN_Party Begin
   If $cmnparty == null or $cmnBusinessRelations == null Then
      Return $cmnparty;
   End
   If $cmnBusinessRelations.kytProfile.actualAccountActivity != null && $cmnparty.hasCustomerOtherAccounts Then
      ForEach CMN_LinkedAccount $linkedAccount In $cmnparty.linkedAccounts Do
         If EQUAL($linkedAccount.accountNumber, $cmnBusinessRelations.getSILID()) Then
            $linkedAccount.accountActivity := $cmnBusinessRelations.kytProfile.actualAccountActivity;
            $linkedAccount.activityRetrieved := true;
         End
      End
   End
End]]></definition>
        </method>
        <method name="createCMNPartyFromSILAccounts" userId="pezzi" uuid="ffffffff-e5b7-9bd4-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNPartyFromSILAccounts'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNPartyFromSILAccounts(CMN_Party $party, Indexed SIL_ACCOUNTaccount $silSubAccountList) : CMN_Party Begin
   /********************************** FIELDS from SIL_SubAccount ****************************************/
   $party.linkedAccounts.clear();
   If LIB_Validator.validateNotEmptyIndexed($silSubAccountList) Then
      SIL_ACCOUNTaccount $silSubAccount;
      ForEach $silSubAccount In $silSubAccountList Do
         CMN_LinkedAccount $cmnLinkedAccount := NEW(CMN_LinkedAccount);
         Boolean $validLinkedAccount := false;
         $cmnLinkedAccount.accountNumber := INT_SILMappingSILtoCMN._mapString($cmnLinkedAccount.accountNumber, $silSubAccount.accountId);
         $cmnLinkedAccount.type := INT_SILMappingSILtoCMN._mapString($cmnLinkedAccount.type, $silSubAccount.accountType);
         $cmnLinkedAccount.status := INT_SILMappingSILtoCMN._mapString($cmnLinkedAccount.status, $silSubAccount.status);
         $cmnLinkedAccount.openingDate := INT_SILMappingSILtoCMN._mapDate($cmnLinkedAccount.openingDate, $silSubAccount.openingDate);
         If LIB_Validator.validateNotEmptyIndexed($silSubAccount.accountHolders) Then
            If LIB_Validator.validateNotEmptyIndexed($silSubAccount.accountHolders[1].accountHolderRelations) Then
               ForEach SIL_INVOLVEDPARTYRELATIONaccountHolderRelation $silRelationship In $silSubAccount.accountHolders[1].accountHolderRelations Do
                  String $useCase := LIST($party.type.getTypeId(), 'SIL_UseCaseDefinition', 'useCase', 'entityType');
                  String $roleId := LIST($silRelationship.relationType, 'CMN_BRRoles', 'id', 'sil_Id');
                  If EQUAL($roleId, 'ah') Then
                     $validLinkedAccount := true;
                     String $role := LIST($roleId, 'CMN_BRRoles', 'description', 'id');
                     If NotEmpty($role) and NotEmpty($cmnLinkedAccount.roles) and not $cmnLinkedAccount.roles.contains($role) Then
                        $cmnLinkedAccount.roles := INT_SILMappingSILtoCMN._mapString($cmnLinkedAccount.roles, JOIN($cmnLinkedAccount.roles, $role, ', '));
                     ElseIf NotEmpty($role) Then
                        $cmnLinkedAccount.roles := $role & ', ';
                     End
                  End
               End
            End
            If $validLinkedAccount Then
               $party.hasCustomerOtherAccounts := true;
               $party.linkedAccounts.addElement($cmnLinkedAccount);
            End
            If NotEmpty($cmnLinkedAccount.roles) Then
               $cmnLinkedAccount.roles := SUBSTRING($cmnLinkedAccount.roles, 0, $cmnLinkedAccount.roles.lastIndexOf(','));
            End
         End
      End
   Else
      $party.hasCustomerOtherAccounts := false;
   End
   /********************************** RETURN ****************************************/
   Return $party;
End]]></definition>
        </method>
        <method name="createCMNPartyFromSILAffiliates" userId="pezzi" uuid="ffffffff-fda0-c134-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNPartyFromSILAffiliates(CMN_Party $cmnParty, Indexed SIL_INVOLVEDPARTYorganization $silOrganizations) : CMN_Party Begin
   If ISA($cmnParty, CMN_LegalEntity) Then
      CMN_LegalEntity $cmnLegalEntity := CAST(CMN_LegalEntity, $cmnParty);
      If $silOrganizations != null Then
         Indexed CMN_KYCLegalAffiliate $previousCMNAffiliates := NewIndexed(CMN_KYCLegalAffiliate);
         ForEach CMN_KYCLegalAffiliate $cmnAffiliate In $cmnLegalEntity.getKYCProfile().sourceOfWealth.affiliate Do
            If NotEmpty($cmnAffiliate.getSILID()) Then
               $previousCMNAffiliates.addElement($cmnAffiliate);
               $cmnLegalEntity.getKYCProfile().sourceOfWealth.affiliate.removeElement($cmnAffiliate);
            End
         End
         SIL_INVOLVEDPARTYorganization $silOrganization;
         CMN_KYCLegalAffiliate $cmnLegalAffiliate;
         ForEach $silOrganization In $silOrganizations Do
            ForEach CMN_KYCLegalAffiliate $otherCMNLegalAffiliate In $previousCMNAffiliates Do
               If $otherCMNLegalAffiliate.getSILID() == $silOrganization.id Then
                  $cmnLegalAffiliate := $otherCMNLegalAffiliate;
                  Break;
               End
            End
            $cmnLegalEntity.getKYCProfile().sourceOfWealth.affiliate.addElement(INT_SILMappingSILtoCMN.createCMNKYCLegalAffiliate($silOrganization, $cmnLegalAffiliate));
         End
      End
      Return $cmnLegalEntity;
   End
   Return $cmnParty;
End]]></definition>
        </method>
        <method name="createCMNPartyFromSILBusinessOrganization" userId="pezzi" uuid="ffffffff-c1e6-cc01-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNPartyFromSILBusinessOrganization(CMN_Party $cmnParty, SIL_INVOLVEDPARTYorganization $silOrganization) : CMN_Party Begin
   If ISA($cmnParty, CMN_LegalEntity) Then
      CMN_LegalEntity $cmnLegalEntity := CAST(CMN_LegalEntity, $cmnParty);
      If $silOrganization != null Then
         If $cmnLegalEntity.getKYCProfile().sourceOfWealth != null Then
            $cmnLegalEntity.getKYCProfile().sourceOfWealth.businessExposure.clear();
            //$cmnLegalEntity.getKYCProfile().sourceOfWealth.setSILID(INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().sourceOfWealth.getSILID(), $silOrganization.id));
            $cmnLegalEntity.getKYCProfile().sourceOfWealth.companyDescription := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().sourceOfWealth.companyDescription, $silOrganization.businessDescription);
            $cmnLegalEntity.getKYCProfile().sourceOfWealth.numberOfEmployees := INT_SILMappingSILtoCMN._mapInteger($cmnLegalEntity.getKYCProfile().sourceOfWealth.numberOfEmployees, $silOrganization.numberOfEmployees);
            $cmnLegalEntity.getKYCProfile().sourceOfWealth.noEmployeeDetails := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().sourceOfWealth.noEmployeeDetails, $silOrganization.noEmployeeReason);
            $cmnLegalEntity.getKYCProfile().sourceOfWealth.hasAffiliate := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.getKYCProfile().sourceOfWealth.hasAffiliate, $silOrganization.hasSubOrganizationIndicator);
            $cmnLegalEntity.getKYCProfile().sourceOfWealth.originOfSow := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().sourceOfWealth.originOfSow, $silOrganization.originalWealthDescription);
            INT_SILMatchingTools.matchSILOrganizationToCMNMainBusiness($silOrganization, $cmnLegalEntity.getKYCProfile().sourceOfWealth.mainBusiness);
            $cmnLegalEntity.getKYCProfile().sourceOfWealth.isHighRiskJuridictionCountry := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.getKYCProfile().sourceOfWealth.isHighRiskJuridictionCountry, $silOrganization.highRiskCountryExposureNoHSBCPresenceIndicator);
            $cmnLegalEntity.getKYCProfile().sourceOfWealth.hasBusActivitiesGreather50 := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.getKYCProfile().sourceOfWealth.hasBusActivitiesGreather50, $silOrganization.isReliantOnKeyCustomerIndicator);
            If LIB_Validator.validateNotEmptyIndexed($silOrganization.roles) Then
               ForEach SIL_INVOLVEDPARTYinvolvedPartyRole $silRole In $silOrganization.roles Do
                  If ISA($silRole, SIL_INVOLVEDPARTYcustomerRole) Then
                     If LIB_Validator.validateNotEmptyIndexed($silRole.involvedPartyRelationships) Then
                        ForEach SIL_INVOLVEDPARTYinvolvedPartyRelationship $silRelation In $silRole.involvedPartyRelationships Do
                           If $silRelation.relationshipType == 'Key Customer' Then
                              If $silRelation.party != null && ISA($silRelation.party, SIL_INVOLVEDPARTYorganization) Then
                                 SIL_INVOLVEDPARTYorganization $silRelationOrganization := CAST(SIL_INVOLVEDPARTYorganization, $silRelation.party);
                                 If LIB_Validator.validateNotEmptyIndexed($silRelationOrganization.names) && ISA($silRelationOrganization.names[1], SIL_INVOLVEDPARTYorganizationName) Then
                                    $cmnLegalEntity.getKYCProfile().sourceOfWealth.keyCustomerName := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().sourceOfWealth.keyCustomerName, CAST(SIL_INVOLVEDPARTYorganizationName, $silRelationOrganization.names[1]).businessName);
                                 End
                                 INT_SILMatchingTools.matchSILOrganizationToCMNMainBusiness($silRelationOrganization, $cmnLegalEntity.getKYCProfile().sourceOfWealth.industryName);
                                 //$cmnLegalEntity.getKYCProfile().sourceOfWealth.industryName.category := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().sourceOfWealth.industryName.category, $silRelationOrganization.activitySectorCategory);
                                 //$cmnLegalEntity.getKYCProfile().sourceOfWealth.industryName.activity := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().sourceOfWealth.industryName.activity, $silRelationOrganization.activitySector);
                                 $cmnLegalEntity.getKYCProfile().sourceOfWealth.customerKeyType := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().sourceOfWealth.customerKeyType, $silRelationOrganization.entityType);
                              End
                           End
                        End
                     End
                  End
               End
            End
            //$cmnLegalEntity.getKYCProfile().screening.hasInfluence := INT_SILMappingSILtoCMN._mapString$cmnLegalEntity.getKYCProfile().screening.hasInfluence,$silOrganization.businessDescription);
            If LIB_Validator.validateNotEmptyIndexed($silOrganization.addresses) Then
               SIL_INVOLVEDPARTYaddress $silAddress;
               ForEach $silAddress In $silOrganization.addresses Do
                  If ISA($silAddress, SIL_INVOLVEDPARTYcountryAddress) Then
                     SIL_INVOLVEDPARTYcountryAddress $silCountryAddress := CAST(SIL_INVOLVEDPARTYcountryAddress, $silAddress);
                     //@TODO why this hardcoding ?
                     If $silAddress.type == INT_SILEnumerations.getCountryTypeOperation() Then
                        If $silCountryAddress.country != null && $silCountryAddress.country.code != null Then
                           $cmnLegalEntity.getKYCProfile().sourceOfWealth.countryOfOperation.addElement($silCountryAddress.country.code);
                        End
                     ElseIf $silAddress.type == INT_SILEnumerations.getCountryTypeExposure() Then
                        CMN_KycBusinessExposure $cmnKycBusinessExposure := NEW(CMN_KycBusinessExposure);
                        $cmnKycBusinessExposure.businessExposure := $silCountryAddress.country.code;
                        $cmnLegalEntity.getKYCProfile().sourceOfWealth.businessExposure.addElement($cmnKycBusinessExposure);
                     End
                  End
               End
            End
            If LIB_Validator.validateNotEmptyIndexed($silOrganization.businessNatureDetails) Then
               $cmnLegalEntity.getKYCProfile().sourceOfWealth.hasGovernmentContractDeal := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.getKYCProfile().sourceOfWealth.hasGovernmentContractDeal, $silOrganization.businessNatureDetails[1].isInvolvedInGovernmentContract);
               If LIB_Validator.validateNotEmptyIndexed($silOrganization.businessNatureDetails[1].businessCustomers) Then
                  //and $silOrganization.businessNatureDetails[1].isInvolvedInGovernmentContract Then
                  SIL_INVOLVEDPARTYbusinessCustomer $silBusinessCustomer;
                  ForEach $silBusinessCustomer In $silOrganization.businessNatureDetails[1].businessCustomers Do
                     CMN_KycSowJuridictionCountry $cmnCountry := INT_SILMappingSILtoCMN.createCMNKycSowJuridictionCountry($silBusinessCustomer);
                     If $cmnCountry != null Then
                        $cmnLegalEntity.getKYCProfile().sourceOfWealth.countryOfJuridiction.addElement($cmnCountry);
                     End
                  End
               End
            End
            $cmnLegalEntity.getKYCProfile().sourceOfWealth.customerType := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().sourceOfWealth.customerType, LIST($silOrganization.legalForm, 'CMN_KycLegalCustomerType', 'id', 'sil_Id'));
            $cmnLegalEntity.getKYCProfile().sourceOfWealth.otherCustomerTypeDetail := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().sourceOfWealth.otherCustomerTypeDetail, $silOrganization.entityNature);
         End
         If $cmnLegalEntity.getKYCProfile().businessNature != null Then
            $cmnLegalEntity.getKYCProfile().businessNature.naturePurposeOfEntity := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().businessNature.naturePurposeOfEntity, $silOrganization.entityNature);
            $cmnLegalEntity.getKYCProfile().businessNature.reasonsUseEntityStructure := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().businessNature.reasonsUseEntityStructure, $silOrganization.reasonForEntityStructure);
         End
         /******************************** Bearer Shares ****************************************************/
         If $cmnLegalEntity.type.isCommercialOperatingBusiness() or $cmnLegalEntity.type.isPrivateInvestmentCompany() Then
            $cmnLegalEntity.getKYCProfile().bearerShares.isBearerSharesCapableCompany := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.getKYCProfile().bearerShares.isBearerSharesCapableCompany, $silOrganization.hasIssuedBearerShares);
            If LIB_Validator.validateNotEmptyIndexed($silOrganization.bearShares) Then
               SIL_INVOLVEDPARTYbearShareInformation $silBearShare := $silOrganization.bearShares[1];
               $cmnLegalEntity.getKYCProfile().bearerShares.hasIBSCApprovedAtRRCSC := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.getKYCProfile().bearerShares.hasIBSCApprovedAtRRCSC, $silBearShare.bearerSharesIBSCApprovalIndicator);
               If LIB_Validator.validateNotEmptyIndexed($silBearShare.custodians) Then
                  SIL_INVOLVEDPARTYorganization $silCustodian := $silBearShare.custodians[1];
                  If LIB_Validator.validateNotEmptyIndexed($silCustodian.names) and ISA($silCustodian.names[1], SIL_INVOLVEDPARTYorganizationName) Then
                     SIL_INVOLVEDPARTYorganizationName $silCustodianName := CAST(SIL_INVOLVEDPARTYorganizationName, $silCustodian.names[1]);
                     $cmnLegalEntity.getKYCProfile().bearerShares.approvedCustodianName := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().bearerShares.approvedCustodianName, $silCustodianName.businessName);
                  End
               End
               $cmnLegalEntity.getKYCProfile().bearerShares.RRCSCReferallOutcome := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().bearerShares.RRCSCReferallOutcome, LIST($silBearShare.RRCSCApprovalType, 'CMN_KYCRRCSCReferralOutcome', 'id', 'sil_Id'));
            End
            //$cmnLegalEntityKycProfile.bearerShares.hyperlinkPBTCs
            $cmnLegalEntity.getKYCProfile().bearerShares.isIBSCCompany := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.getKYCProfile().bearerShares.isIBSCCompany, $silOrganization.isCapableOfIssuingBearerShares);
            If LIB_Validator.validateNotEmptyIndexed($silOrganization.roles) Then
               SIL_INVOLVEDPARTYcustomerRole $silCustomerRole;
               ForEach SIL_INVOLVEDPARTYinvolvedPartyRole $silRole In $silOrganization.roles Do
                  If ISA($silRole, SIL_INVOLVEDPARTYcustomerRole) Then
                     $silCustomerRole := CAST(SIL_INVOLVEDPARTYcustomerRole, $silRole);
                     If LIB_Validator.validateNotEmptyIndexed($silCustomerRole.documents) Then
                        ForEach SIL_CMSdocument $silDocument In $silCustomerRole.documents Do
                           If $silDocument.type == 'Bearer Share Document' Then
                              $cmnLegalEntity.getKYCProfile().bearerShares.hyperlinkPBTCs := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().bearerShares.hyperlinkPBTCs, $silDocument.link);
                              Break;
                           End
                        End
                     End
                  End
               End
            End
         End
         If $cmnLegalEntity.getKYCProfile().financialInformation != null Then
            $cmnLegalEntity.getKYCProfile().financialInformation.hasChangesToBusiness := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.getKYCProfile().financialInformation.hasChangesToBusiness, $silOrganization.businessMaterialChangeIndicator);
            $cmnLegalEntity.getKYCProfile().financialInformation.changesToBusinessComment := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().financialInformation.changesToBusinessComment, $silOrganization.businessMaterialChangeDescription);
         End
      End
   End
   Return $cmnParty;
End]]></definition>
        </method>
        <method name="createCMNPartyFromSILConnectedParties" userId="pezzi" uuid="00000000-0148-b4a9-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNPartyFromSILConnectedParties(CMN_Party $cmnParty, Indexed SIL_INVOLVEDPARTYinvolvedPartyRelationship $silConnectedParties, CMN_BusinessRelationship $br, Named INT_SILReadPartyResponse $readPartyResponses) : CMN_Party Begin
   /* If $readPartyResponses == null Then
      $readPartyResponses := NewNamed(INT_SILReadPartyResponse);
   End
   If LIB_Validator.validateNotEmptyIndexed($silConnectedParties) Then
      $cmnParty.kycProfile.connectedParties.hasOtherConnectedParty := true;
      SIL_INVOLVEDPARTYinvolvedPartyRelationship $silPartyStructure;
      ForEach $silPartyStructure In $silConnectedParties Do
         CMN_ConnectedParty $cmnConnectedParty;
         SIL_INVOLVEDPARTYinvolvedPartyRelationship $silInvolvedPartyRole;
         ForEach $silInvolvedPartyRole In $silConnectedParties Do
            String $cmnRole := LIST($silInvolvedPartyRole.relationshipRole, 'SIL_PartyRoles__selector', 'id', 'sil_id');
            If $silInvolvedPartyRole.party != null and EMPTY($cmnRole) Then
               String $connectedRole := LIST($silInvolvedPartyRole.relationshipRole, 'CMN_KYCPartyRelationType', 'id', 'sil_id');
               If NotEmpty($connectedRole) Then
                  $cmnConnectedParty := NewObject(CMN_ConnectedParty);
                  $cmnConnectedParty.typeRelationship := INT_SILMappingSILtoCMN._mapString($cmnConnectedParty.typeRelationship, $connectedRole);
                  $cmnConnectedParty.idCRM := INT_SILMappingSILtoCMN._mapString($cmnConnectedParty.idCRM, $silInvolvedPartyRole.party.id);
                  If ISA($silInvolvedPartyRole.party, SIL_INVOLVEDPARTYorganization) Then
                     If LIB_Validator.validateNotEmptyIndexed($silInvolvedPartyRole.party.names) && ISA($silInvolvedPartyRole.party.names[1], SIL_INVOLVEDPARTYorganizationName) Then
                        $cmnConnectedParty.businessName := CAST(SIL_INVOLVEDPARTYorganizationName, $silInvolvedPartyRole.party.names[1]).businessName;
                        $cmnConnectedParty._type := 'Organization';
                     End
                  ElseIf ISA($silInvolvedPartyRole.party, SIL_INVOLVEDPARTYindividual) Then
                     If LIB_Validator.validateNotEmptyIndexed($silInvolvedPartyRole.party.names) && ISA($silInvolvedPartyRole.party.names[1], SIL_INVOLVEDPARTYindividualName) Then
                        $cmnConnectedParty.lastName := CAST(SIL_INVOLVEDPARTYindividualName, $silInvolvedPartyRole.party.names[1]).lastName;
                        $cmnConnectedParty.firstName := CAST(SIL_INVOLVEDPARTYindividualName, $silInvolvedPartyRole.party.names[1]).firstName;
                     End
                  Else
                  End
                  If LIB_Validator.validateNotEmptyIndexed($silInvolvedPartyRole.party.names) Then
                     /*&& ISA($silInvolvedPartyRole.party.names[1], SIL_IndividualName) Then
                  $cmnConnectedParty.lastName := CAST(SIL_IndividualName, $silInvolvedPartyRole.party.names[1]).lastName;
                  $cmnConnectedParty.firstName := CAST(SIL_IndividualName, $silInvolvedPartyRole.party.names[1]).firstName;
               $cmnConnectedParty.lastName := $silInvolvedPartyRole.party.names[1].fullName;
                  End
                  $cmnParty.kycProfile.connectedParties.connectedParty.addElement($cmnConnectedParty);
               End
            Else
            If $silInvolvedPartyRole.party != null and NotEmpty($silInvolvedPartyRole.party.id) Then
               INT_SILReadPartyResponse $partyResponse;
               If $readPartyResponses[$silInvolvedPartyRole.party.id] != null and $readPartyResponses[$silInvolvedPartyRole.party.id].party != null Then
                  $partyResponse := $readPartyResponses[$silInvolvedPartyRole.party.id];
               ElseIf $readPartyResponses[$silInvolvedPartyRole.party.id] != null Then
                  Continue;
               Else
                  $partyResponse := INT_SILProxyClient.readPerson($silInvolvedPartyRole.party.id);
                  $readPartyResponses[$silInvolvedPartyRole.party.id] := $partyResponse;
               End
               If $partyResponse.exists() Then
                  //Add role to party
                  CMN_PartyRoleManager $cmnPartyRoleManager := $cmnParty.getRoleManager($br);
                  CMN_ApplicablePartyRole $role := INT_SILMappingSILtoCMN._createCMNPartyRole($cmnPartyRoleManager, $cmnRole);
                  $cmnPartyRoleManager.addRoleForParty($partyResponse.party, $role);
               End
            End
         End
      End
   Else
      $cmnParty.kycProfile.connectedParties.hasOtherConnectedParty := false;
   End*/
   Return $cmnParty;
End]]></definition>
        </method>
        <method name="createCMNPartyFromSILContactActivities" userId="NM" uuid="00000000-1375-bfff-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNPartyFromSILContactActivities(CMN_Party $cmnParty, Indexed SIL_CONTACTACTIVITYcontactActivity $silContactActivities) : CMN_Party Begin
   Return $cmnParty;
End]]></definition>
        </method>
        <method name="createCMNPartyFromSILCorporateStructure" userId="pezzi" uuid="00000000-67af-34fc-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNPartyFromSILCorporateStructure'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNPartyFromSILCorporateStructure(SIL_INVOLVEDPARTYorganization $silOrganization, CMN_Party $cmnParty) : CMN_Party Begin
   If $silOrganization == null or not $cmnParty.type.isCommercialOperatingBusiness() Then
      Return $cmnParty;
   End
   CMN_LegalEntity $cmnLegalEntity := CAST(CMN_LegalEntity, $cmnParty);
   /**************** Structure Details **********************/
   If $silOrganization.numberOfBranches != null Then
      $cmnLegalEntity.structureDetails.numberBranches := INT_SILMappingSILtoCMN._mapInteger($cmnLegalEntity.structureDetails.numberBranches, $silOrganization.numberOfBranches);
   End
   If LIB_Validator.validateNotEmptyIndexed($silOrganization.structures) Then
      If $silOrganization.structures[1].operationCompanyIndicator Then
         $cmnLegalEntity.structureDetails.isOperatingOrHoldingCompany := 'operatingCompany';
      Else
         $cmnLegalEntity.structureDetails.isOperatingOrHoldingCompany := 'holdingCompany';
      End
      $cmnLegalEntity.structureDetails.isCustomerPartOfMastergroup := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.isCustomerPartOfMastergroup, $silOrganization.structures[1].masterGroupCustomerIndicator);
      $cmnLegalEntity.structureDetails.nameMastergroup := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.nameMastergroup, $silOrganization.structures[1].masterGroupName);
   End
   If LIB_Validator.validateNotEmptyIndexed($silOrganization.addresses) Then
      ForEach SIL_INVOLVEDPARTYaddress $silAddress In $silOrganization.addresses Do
         If ISA($silAddress, SIL_INVOLVEDPARTYcountryAddress) Then
            SIL_INVOLVEDPARTYcountryAddress $countryAddress := CAST(SIL_INVOLVEDPARTYcountryAddress, $silAddress);
            If $countryAddress.country != null Then
               $cmnLegalEntity.structureDetails.countryOfOperationsAssets.addElement($countryAddress.country.code);
            End
         End
      End
   End
   $cmnLegalEntity.structureDetails.isCustControlledByParentComp := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.isCustControlledByParentComp, $silOrganization.controlledByParentIndicator);
   $cmnLegalEntity.structureDetails.percParentCompanyOwnership := TOINTEGER(INT_SILMappingSILtoCMN._mapDouble($cmnLegalEntity.structureDetails.percParentCompanyOwnership, $silOrganization.parentOwnshipRatio));
   $cmnLegalEntity.structureDetails.hasEquityListingHSBCExchange := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.hasEquityListingHSBCExchange, $silOrganization.stockExchangeApprovalIndicator);
   $cmnLegalEntity.structureDetails.hasShareCapital := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.hasShareCapital, $silOrganization.hasShareCapitalIndicator);
   $cmnLegalEntity.structureDetails.clarificationShareCapital := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.clarificationShareCapital, $silOrganization.hasShareCapitalDescription);
   If $silOrganization.isSubOrganizationOf != null Then
      $cmnLegalEntity.structureDetails.isExistingClient := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.isExistingClient, $silOrganization.isSubOrganizationOf.existingCustomerIndicator);
      $cmnLegalEntity.structureDetails.uniqueIdentifier := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.uniqueIdentifier, $silOrganization.isSubOrganizationOf.id);
      If $silOrganization.isSubOrganizationOf.names != null Then
         If ISA($silOrganization.isSubOrganizationOf.names[1], SIL_INVOLVEDPARTYorganizationName) Then
            $cmnLegalEntity.structureDetails.nameCustomerParent := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.nameCustomerParent, CAST(SIL_INVOLVEDPARTYorganizationName, $silOrganization.isSubOrganizationOf.names[1]).businessName);
         End
      End
      If LIB_Validator.validateNotEmptyIndexed($silOrganization.isSubOrganizationOf.documentationItems) Then
         ForEach SIL_INVOLVEDPARTYdocumentationItem $document In $silOrganization.isSubOrganizationOf.documentationItems Do
            If ISA($document, SIL_INVOLVEDPARTYincorporation) Then
               SIL_INVOLVEDPARTYincorporation $silIncorporation := CAST(SIL_INVOLVEDPARTYincorporation, $document);
               If $silIncorporation.incorporateCountry != null Then
                  $cmnLegalEntity.structureDetails.countryIncorporation := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.countryIncorporation, $silIncorporation.incorporateCountry.code);
               End
            End
         End
      End
      If LIB_Validator.validateNotEmptyIndexed($silOrganization.isSubOrganizationOf.regulatedBy) Then
         SIL_INVOLVEDPARTYregulatoryBody $silRegulatoryBody := $silOrganization.isSubOrganizationOf.regulatedBy[1];
         If LIB_Validator.validateNotEmptyIndexed($silRegulatoryBody.names) Then
            ForEach SIL_INVOLVEDPARTYinvolvedPartyName $name In $silRegulatoryBody.names Do
               If ISA($name, SIL_INVOLVEDPARTYorganizationName) Then
                  SIL_INVOLVEDPARTYorganizationName $silOganizationName := CAST(SIL_INVOLVEDPARTYorganizationName, $name);
                  If $silOganizationName != null Then
                     $cmnLegalEntity.structureDetails.nameRegulatoryBodyParent := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.nameRegulatoryBodyParent, $silOganizationName.businessName);
                     Break;
                  End
               End
            End
         End
      End
      If LIB_Validator.validateNotEmptyIndexed($silOrganization.isSubOrganizationOf.addresses) Then
         ForEach SIL_INVOLVEDPARTYaddress $silAddress In $silOrganization.isSubOrganizationOf.addresses Do
            If ISA($silAddress, SIL_INVOLVEDPARTYcountryAddress) Then
               SIL_INVOLVEDPARTYcountryAddress $silCountryAddress := CAST(SIL_INVOLVEDPARTYcountryAddress, $silAddress);
               If $silCountryAddress != null && $silCountryAddress.country != null Then
                  $cmnLegalEntity.structureDetails.countryRegulatoryBody := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.countryRegulatoryBody, $silCountryAddress.country.code);
               End
            End
         End
      End
      $cmnLegalEntity.structureDetails.isFinancialInstitution := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.isFinancialInstitution, $silOrganization.isSubOrganizationOf.regulatedFinancialInstitutionIndicator);
      $cmnLegalEntity.structureDetails.isParentListInStockExchange := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.isParentListInStockExchange, $silOrganization.isSubOrganizationOf.listedStockExchangeIndicator);
      $cmnLegalEntity.structureDetails.nameExchangeParent := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.nameExchangeParent, $silOrganization.isSubOrganizationOf.stockExchangeCode);
      INT_SILMatchingTools.matchSILOrganizationToCMNMainBusiness($silOrganization.isSubOrganizationOf, $cmnLegalEntity.structureDetails.mainBusinessActivity);
   End
   /*** FINANCIAL INFORMATION ***/
   $cmnLegalEntity.structureDetails.financialInstitution.isRegFinancialInstitution := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.financialInstitution.isRegFinancialInstitution, $silOrganization.regulatedFinancialInstitutionIndicator);
   If LIB_Validator.validateNotEmptyIndexed($silOrganization.regulatedBy) Then
      SIL_INVOLVEDPARTYregulatoryBody $silRegulatoryBody := $silOrganization.regulatedBy[1];
      If LIB_Validator.validateNotEmptyIndexed($silRegulatoryBody.names) Then
         ForEach SIL_INVOLVEDPARTYinvolvedPartyName $name In $silRegulatoryBody.names Do
            If ISA($name, SIL_INVOLVEDPARTYorganizationName) Then
               SIL_INVOLVEDPARTYorganizationName $silOganizationName := CAST(SIL_INVOLVEDPARTYorganizationName, $name);
               If $silOganizationName != null Then
                  $cmnLegalEntity.structureDetails.financialInstitution.nameRegulatoryBody := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.financialInstitution.nameRegulatoryBody, $silOganizationName.businessName);
                  Break;
               End
            End
         End
      End
      If LIB_Validator.validateNotEmptyIndexed($silRegulatoryBody.addresses) Then
         ForEach SIL_INVOLVEDPARTYaddress $silAddress In $silRegulatoryBody.addresses Do
            If ISA($silAddress, SIL_INVOLVEDPARTYcountryAddress) Then
               SIL_INVOLVEDPARTYcountryAddress $silCountryAddress := CAST(SIL_INVOLVEDPARTYcountryAddress, $silAddress);
               If $silCountryAddress != null && $silCountryAddress.country != null Then
                  $cmnLegalEntity.structureDetails.financialInstitution.countryRegulatoryBody := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.financialInstitution.countryRegulatoryBody, $silCountryAddress.country.code);
                  $cmnLegalEntity.structureDetails.financialInstitution.isCountryNonHighRisk := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.financialInstitution.isCountryNonHighRisk, $silCountryAddress.country.highRiskJuridictionIndicator);
               End
            End
         End
      End
      $cmnLegalEntity.structureDetails.financialInstitution.isCountryMemberOfFATF := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.financialInstitution.isCountryMemberOfFATF, $silRegulatoryBody.strategicDeficiencyFATFIndicator);
      $cmnLegalEntity.structureDetails.financialInstitution.hasCountryMeetingEUCriteria := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.financialInstitution.hasCountryMeetingEUCriteria, $silRegulatoryBody.meetEUJurisdictionEquivalentIndicator);
   End
   $cmnLegalEntity.structureDetails.financialInstitution.isPartyListedStockExchange := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.financialInstitution.isPartyListedStockExchange, $silOrganization.listedStockExchangeIndicator);
   $cmnLegalEntity.structureDetails.financialInstitution.nameStockExchange := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.financialInstitution.nameStockExchange, $silOrganization.stockExchangeCode);
   $cmnLegalEntity.structureDetails.financialInstitution.hasApprovedEquityExchange := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.financialInstitution.hasApprovedEquityExchange, $silOrganization.stockExchangeApprovalIndicator);
   $cmnLegalEntity.structureDetails.financialInstitution.regulatoryReferenceNumber := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.financialInstitution.regulatoryReferenceNumber, $silOrganization.regulatoryReferenceNumber);
   $cmnLegalEntity.structureDetails.financialInstitution.hasInternationalFirm := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.financialInstitution.hasInternationalFirm, $silOrganization.auditByInternationalAccountantIndicator);
   If LIB_Validator.validateNotEmptyIndexed($silOrganization.financialCriteriaSatisfaction) Then
      ForEach String $financialCriteria In $silOrganization.financialCriteriaSatisfaction Do
         $cmnLegalEntity.structureDetails.hasMeetFinancialCriteria.addElement($financialCriteria);
      End
   End
   If LIB_Validator.validateNotEmptyIndexed($silOrganization.nonFinancialCriteriaSatisfaction) Then
      ForEach String $financialCriteria In $silOrganization.nonFinancialCriteriaSatisfaction Do
         $cmnLegalEntity.structureDetails.hasMeetNonFinancialCriteria.addElement($financialCriteria);
      End
   End
   If LIB_Validator.validateNotEmptyIndexed($silOrganization.roles) Then
      ForEach SIL_INVOLVEDPARTYinvolvedPartyRole $silRole In $silOrganization.roles Do
         If ISA($silRole, SIL_INVOLVEDPARTYcustomerRole) Then
            SIL_INVOLVEDPARTYcustomerRole $customerRole := CAST(SIL_INVOLVEDPARTYcustomerRole, $silRole);
            If LIB_Validator.validateNotEmptyIndexed($customerRole.involvedPartyRelationships) Then
               ForEach SIL_INVOLVEDPARTYinvolvedPartyRelationship $silRelation In $customerRole.involvedPartyRelationships Do
                  If $silRelation.relationshipType == 'AccountingAuditFirm' Then
                     If $customerRole.involvedPartyRelationships[1].party != null && ISA($customerRole.involvedPartyRelationships[1].party, SIL_INVOLVEDPARTYorganization) Then
                        SIL_INVOLVEDPARTYorganization $silParty := CAST(SIL_INVOLVEDPARTYorganization, $silRelation.party);
                        If LIB_Validator.validateNotEmptyIndexed($silParty.names) Then
                           SIL_INVOLVEDPARTYorganizationName $silOrganizationName := CAST(SIL_INVOLVEDPARTYorganizationName, $silParty.names[1]);
                           $cmnLegalEntity.structureDetails.financialInstitution.nameAuditAccountingFirm := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.financialInstitution.nameAuditAccountingFirm, $silOrganizationName.businessName);
                        End
                     End
                  End
               End
            End
         End
      End
   End
   /*
$cmnLegalEntity.structureDetails.financialInstitution.nameStockExchange := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.financialInstitution.nameStockExchange
$cmnLegalEntity.structureDetails.financialInstitution.hasInternationalFirm := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.financialInstitution.hasInternationalFirm
$cmnLegalEntity.structureDetails.financialInstitution.nameAuditAccountingFirm := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.financialInstitution.nameAuditAccountingFirm
$cmnLegalEntity.structureDetails.financialInstitution.hasMeetFinancialCriteria := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.financialInstitution.hasMeetFinancialCriteria
$cmnLegalEntity.structureDetails.financialInstitution.hasMeetNonFinancialCriteria := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.financialInstitution.hasMeetNonFinancialCriteria,
//$cmnLegalEntity.structureDetails.financialInstitution.calculateCustomerTypeCategorization()
*/
   $cmnLegalEntity.structureDetails.financialInstitution.nameRegulatoryBody := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.financialInstitution.nameRegulatoryBody, $silOrganization.regulatoryBody);
   $cmnLegalEntity.structureDetails.financialInstitution.isPartyListedStockExchange := INT_SILMappingSILtoCMN._mapBoolean($cmnLegalEntity.structureDetails.financialInstitution.isPartyListedStockExchange, INT_SILMatchingTools.matchSILYesNoToCMNBoolean($silOrganization.stockAvailabilityType));
   $cmnLegalEntity.structureDetails.financialInstitution.nameStockExchange := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.financialInstitution.nameStockExchange, $silOrganization.stockExchangeCode);
   $cmnLegalEntity.structureDetails.financialInstitution.nameAuditAccountingFirm := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.structureDetails.financialInstitution.nameAuditAccountingFirm, $silOrganization.auditingFirm);
End]]></definition>
        </method>
        <method name="createCMNPartyFromSILEstimatedNetWorth" userId="pezzi" uuid="00000000-6b98-111f-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNPartyFromSILEstimatedNetWorth(CMN_Party $cmnParty, Indexed SIL_KYCestimatedNetWorth $silEstimatedNetWorthes) : CMN_Party Begin
   If $cmnParty != null and $cmnParty.type.isLegalEntity() and LIB_Validator.validateNotEmptyIndexed($silEstimatedNetWorthes) Then
      CMN_LegalEntity $cmnLegalEntity := CAST(CMN_LegalEntity, $cmnParty);
      If LIB_Validator.validateNotEmptyIndexed($silEstimatedNetWorthes) Then
         SIL_KYCestimatedNetWorth $silEstimatedNetWorth := $silEstimatedNetWorthes[1];
         //ForEach $silEstimatedNetWorth In $silEstimatedNetWorthes Do
         $cmnLegalEntity.getKYCProfile().financialInformation.setSILID(INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().financialInformation.getSILID(), $silEstimatedNetWorth.id));
         $cmnLegalEntity.getKYCProfile().financialInformation.financialAssets := INT_SILMappingSILtoCMN._mapDouble($cmnLegalEntity.getKYCProfile().financialInformation.financialAssets, $silEstimatedNetWorth.financialAssetsAmount);
         $cmnLegalEntity.getKYCProfile().financialInformation.fixedAssets := INT_SILMappingSILtoCMN._mapDouble($cmnLegalEntity.getKYCProfile().financialInformation.fixedAssets, $silEstimatedNetWorth.fixedAssetsAmount);
         $cmnLegalEntity.getKYCProfile().financialInformation.otherAssets := INT_SILMappingSILtoCMN._mapDouble($cmnLegalEntity.getKYCProfile().financialInformation.otherAssets, $silEstimatedNetWorth.otherAssetsAmount);
         $cmnLegalEntity.getKYCProfile().financialInformation.debts := INT_SILMappingSILtoCMN._mapDouble($cmnLegalEntity.getKYCProfile().financialInformation.debts, $silEstimatedNetWorth.debtsAssetsAmount);
         $cmnLegalEntity.getKYCProfile().financialInformation.estimatedAnnualNetIncome := INT_SILMappingSILtoCMN._mapDouble($cmnLegalEntity.getKYCProfile().financialInformation.estimatedAnnualNetIncome, ERROR(TODOUBLE($silEstimatedNetWorth.netWealthAmount), 0.0));
         $cmnLegalEntity.getKYCProfile().financialInformation.estimatedAnnualRevenues := INT_SILMappingSILtoCMN._mapDouble($cmnLegalEntity.getKYCProfile().financialInformation.estimatedAnnualRevenues, ERROR(TODOUBLE($silEstimatedNetWorth.estimatedAnnualIncome), 0.0));
         $cmnLegalEntity.getKYCProfile().financialInformation.customerKeyFinancialData := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().financialInformation.customerKeyFinancialData, LIST($silEstimatedNetWorth.customerRelevantKeyFinancialDataType, 'CMN_kycCustomerKeyFinancialData', 'id', 'sil_Id'));
         $cmnLegalEntity.getKYCProfile().financialInformation.customerKeyFinancialDataAmount := INT_SILMappingSILtoCMN._mapDouble($cmnLegalEntity.getKYCProfile().financialInformation.customerKeyFinancialDataAmount, $silEstimatedNetWorth.annualTurnoverTotalAmount);
         $cmnLegalEntity.getKYCProfile().financialInformation.customerKeyFinancialDataInfo := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().financialInformation.customerKeyFinancialDataInfo, $silEstimatedNetWorth.incomeComment);
         $cmnLegalEntity.getKYCProfile().financialInformation.customerKeyFinancialOther := INT_SILMappingSILtoCMN._mapString($cmnLegalEntity.getKYCProfile().financialInformation.customerKeyFinancialOther, $silEstimatedNetWorth.customerRelevantKeyFinancialDescription);
      End
      Return $cmnLegalEntity;
   End
   Return $cmnParty;
End]]></definition>
        </method>
        <method name="createCMNPartyFromSILFindings" userId="pezzi" uuid="00000000-3ca7-b5f8-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNPartyFromSILFindings'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNPartyFromSILFindings(CMN_Party $cmnParty, Indexed SIL_INVOLVEDPARTYSCREENINGfinding $silScreeningFindings) : CMN_Party Begin
   If $cmnParty == null Then
      Return null;
   End
   If $silScreeningFindings == null Then
      Return $cmnParty;
   End
   ForEach SIL_INVOLVEDPARTYSCREENINGfinding $silScreeningFinding In $silScreeningFindings Do
      //If ISA($silScreeningFinding, SIL_INVOLVEDPARTYSCREENINGnegativeMediaFinding) Then
      //SIL_INVOLVEDPARTYSCREENINGnegativeMediaFinding $silNegativeMediaFinding := CAST(SIL_INVOLVEDPARTYSCREENINGnegativeMediaFinding, $silFindings);
      $cmnParty.kycProfile.screening.connectedPartyNegativeNews.addElement(INT_SILMappingSILtoCMN.createCMNConnectedPartyNegativeNews($silScreeningFinding));
      //End
   End
   Return $cmnParty;
End]]></definition>
        </method>
        <method name="createCMNPartyFromSILIncomeWealthDetails" userId="pezzi" uuid="00000000-6bb9-91fe-0000-000000000000">
            <definition><![CDATA[/**
  Description of function 'createCMNPartyFromSILIncomeWealthDetails'.
  @param $value Description of parameter '$value'.
  @return       Description of return value.
*/
StaticFunction createCMNPartyFromSILIncomeWealthDetails(String $value) : Nothing Begin
   PRINTLN('Running Function createCMNPartyFromSILIncomeWealthDetails');
End]]></definition>
        </method>
        <method name="createCMNPartyFromSILInvolvedParty" userId="pezzi" uuid="ffffffff-ad68-bcb1-0000-000000000000">
            <definition><![CDATA[StaticFunction createCMNPartyFromSILInvolvedParty(CMN_Party $cmnParty, SIL_INVOLVEDPARTYinvolvedParty $silInvolvedParty) : CMN_Party Begin
   /****************** CREATE PARTY ************************************/
   If $cmnParty == null and $silInvolvedParty != null Then
      If ISA($silInvolvedParty, 'SIL_INVOLVEDPARTYindividual') Then
         $cmnParty := INT_SILMappingSILtoCMN.createCMNPhysicalPerson($cmnParty, CAST(SIL_INVOLVEDPARTYindividual, $silInvolvedParty));
      ElseIf ISA($silInvolvedParty, 'SIL_INVOLVEDPARTYorganization') Then
         $cmnParty := INT_SILMappingSILtoCMN.createCMNLegalEntity($cmnParty, CAST(SIL_INVOLVEDPARTYorganization, $silInvolvedParty));
      Else
         FAIL('Unknow Data Type 1: ' & TOSTRING($silInvolvedParty));
      End
   Else
      If (ISA($silInvolvedParty, 'SIL_INVOLVEDPARTYindividual') && $cmnParty.type.isLegalEntity()) or (ISA($silInvolvedParty, 'SIL_INVOLVEDPARTYorganization') && $cmnParty.type.isPhysicalPerson()) Then
         FAIL('Data Type do not correspond: ' & TypeOf($silInvolvedParty, true).getType() & ' vs ' & TypeOf($cmnParty, true).getType());
      End
   End
   If $cmnParty != null Then
      /****************** MAPPING GENERAL FIELDS **************************/
      $cmnParty.contact := INT_SILMappingSILtoCMN.createCMNContact($silInvolvedParty.addresses, $cmnParty);
      $cmnParty.setSILID($silInvolvedParty.id);
      $cmnParty._status := INT_SILMappingSILtoCMN._mapString($cmnParty._status, $silInvolvedParty.state);
      $cmnParty.fiscalDomicile := INT_SILMappingSILtoCMN._mapString($cmnParty.fiscalDomicile, $silInvolvedParty.domicile);
      $cmnParty.tin := INT_SILMappingSILtoCMN._mapString($cmnParty.tin, $silInvolvedParty.taxId);
      /****************** MAPPING Documents FIELDS **************************/
      SIL_INVOLVEDPARTYdocumentationItem $silDocumentationItem;
      If LIB_Validator.validateNotEmptyIndexed($silInvolvedParty.documentationItems) Then
         ForEach $silDocumentationItem In $silInvolvedParty.documentationItems Do
            CMN_IdentificationDocument $cmnIdentificationDocument := INT_SILMappingSILtoCMN.createCMNIdentificationDocument($silDocumentationItem);
            $cmnParty.identifications.addElement($cmnIdentificationDocument);
         End
      End
      /******************************** Customer Role ************************************/
      SIL_INVOLVEDPARTYcustomerRole $silCustomerRole := INT_SILUtils.getFirstSilCustomerRole($silInvolvedParty.roles);
      If $silCustomerRole != null Then
         $cmnParty.clientStatus := INT_SILMappingSILtoCMN._mapString($cmnParty.clientStatus, $silCustomerRole.clientStatus);
         /*If LIB_Validator.validateNotEmptyIndexed($silCustomerRole.legalFormFCCRAMCode) Then
            $cmnParty.legalForm := INT_SILMappingSILtoCMN._mapString($cmnParty.legalForm, LIST(TOSTRING($silCustomerRole.legalFormFCCRAMCode[1]), 'SIL_LegalEntityStructures', 'id', 'description'));
            //$cmnParty.legalForm := INT_SILMappingSILtoCMN._mapString($cmnParty.legalForm, TOSTRING($silCustomerRole.legalFormFCCRAMCode[1]));
         End*/
         ForEach $customerClassification In $silC